(function(t,i){var e=function(e,s){this.settings=i.extend({tripIndex:0,tripTheme:"black",backToTopWhenEnded:false,overlayZindex:99999,delay:1e3,enableKeyBinding:true,showCloseBox:false,skipUndefinedTrip:false,showNavigation:false,canGoNext:true,canGoPrev:true,nextLabel:"Next",prevLabel:"Back",finishLabel:"Dismiss",closeBoxLabel:"&#215;",onTripStart:i.noop,onTripStop:i.noop,onTripChange:i.noop},s);this.tripData=e;this.$tripBlock=null;this.$overlay=null;this.$bar=null;this.$root=i("body, html");this.tripIndex=this.settings.tripIndex;this.tripDirection="next";this.timer=null;this.progressing=false;this.hasExpose=false;this.CONSTANTS={LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ESC:27,SPACE:32};this.console=t.console||{}};e.prototype={preInit:function(){},showExpose:function(t){this.hasExpose=true;var i={position:t.css("position"),zIndex:t.css("z-Index")};var e={position:"relative",zIndex:this.settings.overlayZindex+1};t.data("trip-old-css",i).css(e).addClass("trip-exposed");this.$overlay.show()},hideExpose:function(){this.hasExpose=false;var t=i(".trip-exposed"),e=t.data("trip-old-css");t.css(e).removeClass("trip-exposed");this.$overlay.hide()},bindResizeEvents:function(){var e=this;i(t).on("resize.Trip",function(t){e.resizeEvent.call(e,t)})},bindKeyEvents:function(){var t=this;i(document).on("keydown.Trip",function(i){t.keyEvent.call(t,i)})},unbindResizeEvents:function(){i(t).off("resize.Trip")},unbindKeyEvents:function(){i(document).off("keydown.Trip")},resizeEvent:function(t){this.run()},keyEvent:function(t){switch(t.which){case this.CONSTANTS["ESC"]:this.stop();break;case this.CONSTANTS["SPACE"]:t.preventDefault();this.pause();break;case this.CONSTANTS["LEFT_ARROW"]:case this.CONSTANTS["UP_ARROW"]:this.prev();break;case this.CONSTANTS["RIGHT_ARROW"]:case this.CONSTANTS["DOWN_ARROW"]:this.next();break}},stop:function(){if(this.timer){this.timer.stop()}if(this.settings.enableKeyBinding){this.unbindKeyEvents()}this.unbindResizeEvents();if(this.hasExpose){this.hideExpose()}this.hideTripBlock();this.tripIndex=this.settings.tripIndex;this.settings.onTripStop();if(this.settings.backToTopWhenEnded){this.$root.animate({scrollTop:0},"slow")}},pauseAndResume:function(){if(this.progressing){this.timer.pause();this.pauseProgressBar()}else{var t=this.timer.resume();this.resumeProgressBar(t)}this.progressing=!this.progressing},pause:function(){this.pauseAndResume()},resume:function(){this.pauseAndResume()},next:function(){this.tripDirection="next";if(this.isLast()){this.stop()}else{if(this.canGoNext()){this.increaseIndex();this.run();this.callCallback()}}},prev:function(){this.tripDirection="prev";if(this.isFirst()){}else{if(this.canGoPrev()){this.decreaseIndex();this.run();this.callCallback()}}},showCurrentTrip:function(t){if(typeof t.sel==="string"){t.sel=i(t.sel)}if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}if(this.progressing){this.hideProgressBar();this.progressing=false}this.setTripBlock(t);this.showTripBlock(t);if(t.expose){this.showExpose(t.sel)}},showProgressBar:function(t){var i=this;this.$bar.animate({width:"100%"},t,"linear",function(){i.$bar.width(0)})},hideProgressBar:function(){this.$bar.width(0);this.$bar.stop(true)},pauseProgressBar:function(){this.$bar.stop(true)},resumeProgressBar:function(t){this.showProgressBar(t)},run:function(){var t=this,i=this.getCurrentTripObject(),e=i.delay||this.settings.delay;if(!this.isTripDataValid(i)){if(this.settings.skipUndefinedTrip===false){this.console.error("Your tripData is not valid at index : "+this.tripIndex);this.stop();return false}else{return this[this.tripDirection]()}}this.showCurrentTrip(i);this.showProgressBar(e);this.progressing=true;if(e>=0){this.timer=new s(t.next.bind(t),e)}this.settings.onTripChange(this.tripIndex,i)},isFirst:function(){return this.tripIndex===0?true:false},isLast:function(){return this.tripIndex===this.tripData.length-1?true:false},isTripDataValid:function(t){if(typeof t.content==="undefined"||typeof t.sel==="undefined"||t.sel===null||t.sel.length===0||i(t.sel).length===0){return false}return true},callCallback:function(){var t=this.tripData[this.tripIndex].callback;if(typeof t!=="undefined"){t(this.tripIndex)}},canGoPrev:function(){var t=this.tripData[this.tripIndex],i=t.canGoPrev||this.settings.canGoPrev;if(typeof i==="function"){i=i.call(t)}return i},canGoNext:function(){var t=this.tripData[this.tripIndex],i=t.canGoNext||this.settings.canGoNext;if(typeof i==="function"){i=i.call(t)}return i},increaseIndex:function(){if(this.tripIndex>=this.tripData.length-1){}else{this.tripIndex+=1}},decreaseIndex:function(){if(this.tripIndex<=0){}else{this.tripIndex-=1}},getCurrentTripObject:function(){return this.tripData[this.tripIndex]},setTripBlock:function(t){var i=this.$tripBlock,e=t.showCloseBox||this.settings.showCloseBox,s=t.showNavigation||this.settings.showNavigation,n=t.closeBoxLabel||this.settings.closeBoxLabel,r=t.prevLabel||this.settings.prevLabel,o=t.nextLabel||this.settings.nextLabel,a=t.finishLabel||this.settings.finishLabel;i.find(".trip-content").html(t.content);i.find(".trip-prev").html(r).toggle(s&&!this.isFirst());i.find(".trip-next").html(this.isLast()?a:o).toggle(s);i.find(".trip-close").html(n).toggle(e);i.removeClass("e s w n");i.addClass(t.position);this.setTripBlockPosition(t,"left");this.setTripBlockPosition(t,"top")},setTripBlockPosition:function(t,i){var e=this.$tripBlock,s=t.sel,n=s.outerWidth(),r=s.outerHeight(),o=e.outerWidth(),a=e.outerHeight(),h=10,p=10;switch(t.position){case"e":cssLeft=s.offset().left+n+p;cssTop=s.offset().top-(a-r)/2;break;case"s":cssLeft=s.offset().left+(n-o)/2;cssTop=s.offset().top+r+h;break;case"w":cssLeft=s.offset().left-(p+o);cssTop=s.offset().top-(a-r)/2;break;case"n":default:cssLeft=s.offset().left+(n-o)/2;cssTop=s.offset().top-h-a;break}if(i==="left"){e.css({left:cssLeft})}else{e.css({top:cssTop})}},showTripBlock:function(e){this.$tripBlock.css({display:"inline-block",zIndex:this.settings.overlayZindex+1});var s=i(t).height(),n=i(t).scrollTop(),r=this.$tripBlock.offset().top,o=100;if(r<n+s&&r>=n){}else{this.$root.animate({scrollTop:r-o},"slow")}},hideTripBlock:function(){this.$tripBlock.fadeOut("slow")},create:function(){this.createTripBlock();this.createOverlay()},createTripBlock:function(){if(typeof i(".trip-block").get(0)==="undefined"){var t=['<div class="trip-block">','<a href="#" class="trip-close"></a>','<div class="trip-content"></div>','<div class="trip-progress-wrapper">','<div class="trip-progress-bar"></div>','<a href="#" class="trip-prev"></a>','<a href="#" class="trip-next"></a>',"</div>","</div>"].join("");var e=this,s=i(t).addClass(this.settings.tripTheme);i("body").append(s);s.find(".trip-close").on("click",function(t){t.preventDefault();e.stop()});s.find(".trip-prev").on("click",function(t){t.preventDefault();e.prev()});s.find(".trip-next").on("click",function(t){t.preventDefault();e.next()})}},createOverlay:function(){if(typeof i(".trip-overlay").get(0)==="undefined"){var e=['<div class="trip-overlay">',"</div>"].join("");var s=i(e);s.height(i(t).height()).css({zIndex:this.settings.overlayZindex});i("body").append(s)}},cleanup:function(){i(".trip-overlay, .trip-block").remove()},init:function(){this.preInit();if(this.settings.enableKeyBinding){this.bindKeyEvents()}this.bindResizeEvents();this.$tripBlock=i(".trip-block");this.$bar=i(".trip-progress-bar");this.$overlay=i(".trip-overlay")},start:function(){this.cleanup();this.settings.onTripStart();this.create();this.init();this.run()}};t.Trip=e;function s(i,e){var s,n,r=e;this.pause=function(){t.clearTimeout(s);r-=new Date-n};this.resume=function(){n=new Date;s=t.setTimeout(i,r);return r};this.stop=function(){t.clearTimeout(s)};this.resume()}})(window,jQuery);