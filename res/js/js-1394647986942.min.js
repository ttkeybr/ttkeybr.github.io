"use strict";function polyfill(){polyfill=function(){throw new Error},function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.CustomEvent.prototype,window.CustomEvent=a}(),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.indexOf(a,b)===b}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){b=b||this.length,b-=a.length;var c=this.lastIndexOf(a);return-1!==c&&c===b}}),String.prototype.trim||Object.defineProperty(String.prototype,"trim",{enumerable:!1,configurable:!1,writable:!1,value:function(){return this.replace(/^\s+|\s+$/g,"")}}),Storage.prototype.getObject=function(a){try{return JSON.parse(this.getItem(a))}catch(b){return null}},Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.URL=window.URL||window.webkitURL}function ParamMap(){var a=window.location.search;a.startsWith("?")&&(a=a.substring(1)),a.split("&").map(function(a){var b,c=a.split("="),d=decodeURIComponent(c[0]);b=void 0==c[1]?null:decodeURIComponent(c[1]),this[d]=b},this),this.flag=function(a,b){return b=!!b,a in this?"false"!=this[a]:b}}function normalRandom(a,b){a=void 0!==a?a:0,b=void 0!==b?b:1;var c=Math.sqrt(3*b*b),d=2*c,e=Math.random()*d-c,f=Math.random()*d-c,g=Math.random()*d-c,h=Math.random()*d-c,i=Math.random()*d-c;return a+(e+f+g+h+i)/5*2.23606797749979}function jdkNormalRandom(a,b){a=void 0!==a?a:0,b=void 0!==b?b:1;var c,d,e;do c=2*Math.random()-1,d=2*Math.random()-1,e=c*c+d*d;while(e>=1||0==e);var f=Math.sqrt(-2*Math.log(e)/e);return c*f*b+a}function Identifier(){throw new Error}function AnimationSupport(){function a(a,b){return function(c){return a+b(c)}}this.supported=!1,this.id="standard",this.domName=Identifier.toPascalCase,this.styleName=Identifier.toCamelCase,this.eventName=Identifier.toSimple;var b=[{id:"webkit",domName:a("Webkit",Identifier.toPascalCase),styleName:a("webkit",Identifier.toPascalCase),eventName:a("webkit",Identifier.toPascalCase)},{id:"moz",domName:a("Moz",Identifier.toPascalCase),styleName:a("moz",Identifier.toPascalCase),eventName:a("moz",Identifier.toPascalCase)},{id:"ms",domName:a("MS",Identifier.toPascalCase),styleName:a("ms",Identifier.toPascalCase),eventName:a("MS",Identifier.toPascalCase)}],c=document.body;if(void 0!==c.style.animationName)this.supported=!0;else for(var d=0;d<b.length;d++){var e=b[d];if(void 0!==c.style[e.domName("animation-name")]){this.supported=!0,this.id=e.id,this.domName=e.domName,this.styleName=e.styleName,this.eventName=e.eventName;break}}}function Color(a){if(3==arguments.length)return this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],this;if("number"==typeof a){var b=0|a;return this.r=b>>16&255,this.g=b>>8&255,this.b=255&b,this}if("string"==typeof a){a.startsWith("#")&&(a=a.substring(1));var c=parseInt(a,16);return this.r=c>>16&255,this.g=c>>8&255,this.b=255&c,this}if("array"==typeof a)return this.r=0|a[0],this.g=0|a[1],this.b=0|a[2],this;if("object"==typeof a)return this.r=0|a.r,this.g=0|a.g,this.b=0|a.b,this;throw new Error}function DateX(a){return"number"==typeof a&&(a=new Date(a)),this.year=a.getFullYear(),this.month=a.getMonth()+1,this.day=a.getDate(),Object.freeze(this)}function mapValues(a){var b=[];for(var c in a)b.push(a[c]);return b}function round(a,b){return Math.round(a*b)/b}function clientId(){function a(a){for(var b="abcdefghijklmnopqrstuvwxyz0123456789",c="",d=0;a>d;d++)c+=b.charAt(Math.randomInt(0,b.length-1));return c}function b(a){return void 0==a||null==a?a:a.trim()}var c=b(Cookies.get("cid")),d=b(window.localStorage.getItem("cid")),e=null;return e=c&&d?d=c:c?d=c:c=d?d:d=a(10),Cookies.set("cid",e),window.localStorage.setItem("cid",e),e}function rc4(a,b){var c,d,e,f=[];for(c=0;256>c;c++)f[c]=c;for(d=0,c=0;256>c;c++)d=(d+f[c]+a[c%a.length])%256,e=f[c],f[c]=f[d],f[d]=e;c=0,d=0;for(var g=0;g<b.length;g++)c=(c+1)%256,d=(d+f[c])%256,e=f[c],f[c]=f[d],f[d]=e,b[g]^=f[(f[c]+f[d])%256]}function DropDown(a){this.$el=a,this.$placeholder=this.$el.children("span"),0==this.$placeholder.length&&this.$el.append(this.$placeholder=$("<span></span>")),this.$list=this.$el.children("ul"),0==this.$list.length&&this.$el.append(this.$list=$('<ul tabindex="1"></ul>'));var b=this;b.$el.on("click",function(){return b.$el.toggleClass("active"),!1}),this.clear()}function initCommonUi(){$(document).on("click",function(){$(".ui.dropdown").removeClass("active")})}function buildTourPages(a){var b=[];return $(a).each(function(a,c){var d=$(c);b.push({selection:$(d.data("query")),content:d.html(),position:d.data("position")})}),b}function Tour(a,b){if(0==a.length)throw new Error;this.settings=$.extend({pageIndex:0,canGoNext:!0,canGoPrev:!0,nextLabel:"Next",prevLabel:"Back",finishLabel:"Close",onStart:$.noop,onStop:$.noop,onChange:$.noop},b),this.tourPages=a,this.$root=$("body"),this.$tour=null,this.$progress=null,this.pageIndex=this.settings.pageIndex,this.create()}function UnicodeCombiner(a,b,c,d){if(c.length!=d.length)throw new Error;for(var e=0;e<d.length;e++)if(Unicode.isCombining(d.charCodeAt(e)))throw new Error;return this.combiner=a,this.image=b,this.from=c,this.to=d,Object.freeze(this)}function sanitizeText(a,b,c){for(var d="",e="",f=0;f<a.length;f++){var g=a.charCodeAt(f);if(Unicode.isNl(g))e=""==d?"":"\n";else if(Unicode.isWs(g))""==d?e="":"\n"!=e&&(e=" ");else{d+=e,e="";var h=String.fromCharCode(g);switch(g){case 8210:case 8211:case 8212:case 8213:g=45,h="-";break;case 8216:case 8217:case 8218:g=39,h="'";break;case 8220:case 8221:case 8222:case 171:case 187:g=34,h='"';break;case 8230:g=0,h="..."}if(null!=c&&-1!=c.indexOf(g))continue;(null==b||-1!=b.indexOf(g))&&(d+=h)}}return d}function TextParser(a){this.text=a,this.reset()}function Censor(a){this.config={set:a.set.map(function(a){return a.replace(/\s+/g," ").trim()}).sort(function(a,b){return b.length-a.length}).map(function(a){return new RegExp("\\b"+a.replace(" ","\\s+")+"\\b","gi")})}}function Generator(){}function DummyGenerator(a){Generator.call(this),this.text=a}function StaticTextGenerator(a,b,c){Generator.call(this),this.wordLimit=20,this.fragmentLimit=80,b.censor&&(a=CENSOR.get(c.lang).censor(a)),a=b.simplify?sanitizeText(a,c.charSet,sanitizeText.GRAPHICS):sanitizeText(a,c.charSet),b.lowercase&&(a=a.toLowerCase()),this.text=a,this.parser=new TextParser(this.text),this.nextWord()}function RandomWordsGenerator(){Generator.call(this),this.charSet=new CharSet,this.subSet=null,this.boost=null,this.wordLimit=8,this.fragmentLimit=80,this.enableCapitals=!1,this.enablePunctuators=!1,this.punctuators=["."]}function LanguageModel(a){function b(a,b,c){this.index=a,this.charCode=b,this.weight=c}function c(a){Array.call(this,a)}function d(a,d){function e(a){for(var b=0;n>b;b++)a[b]=0}function f(){for(var b=new Uint8Array(a,0),c=9,d=b[c++],f=0;d>f;f++)o+=String.fromCharCode(256*b[c++]+b[c++]);n=b[c++]-1;var g=c,h=g+2*Math.pow(o.length,n);p=new Uint8Array(a,g,h-g),q=new Uint8Array(a,h),e(s)}function g(a,b){for(var c=0;c<b.length;c++){var d=o.charCodeAt(b[c]);if(d>32&&-1==a.indexOf(d))return!1}return!0}function h(a,b){var c=r[b];if(null==c)throw new Error;if(a){for(var d=[],e=0;e<c.length;e++){var f=c[e];g(a,f)&&d.push(f)}if(d.length>0)return d}return c}function i(a,b,c,d){function f(){if(e(c),g="",i){if(!i.length)throw new Error;c=i[Math.floor(Math.random()*i.length)].slice(0);for(var a=0;n>a;a++){var b=o.charCodeAt(c[a]);b>32&&(g+=String.fromCharCode(b))}}}var g,i;for(b&&(i=h(a,b.charCode)),f();;){var k=j(a,c);if(0==k.length)f();else{var l=k.pickRandom();if(c.push(l.index),c.shift(),32==l.charCode){if(!(g.length<3))return g;f()}else g.length==d?f():g+=String.fromCharCode(l.charCode)}}}function j(a,d){for(var e=o.length,f=0,g=1,h=0;n>h;h++)f+=g*d[n-h-1],g*=e;f*=2,f=p[f]<<8|p[f+1];var i=new c,j=0;if(65535!=f){var k=q[f]>>4&15,l=15&q[f];for(f++;;){for(;k>0;){var m=o.charCodeAt(j),r=q[f];(32==m||null==a||-1!=a.indexOf(m))&&i.push(new b(j,m,r)),f++,j++,k--}if(j+=l,j==e)break;k=q[f]>>>4&15,l=15&q[f],f++}}return i}function k(){for(var a=Object.create(null),b=0;b<o.length;b++){var c=o.charCodeAt(b);a[c]=0,r[c]=[]}return a}function l(a,b,c,d){for(var e=0;e<o.length;e++)if(a[b]=e,n-1>b)l(a,b+1,c,d||0==b&&0==e);else for(var f=j(null,a),g=0;g<f.length;g++){var h=f[g],i=c[h.charCode];if(i+=h.weight,c[h.charCode]=i,d){var k=r[h.charCode],m=a.slice(0);m.push(h.index),m.shift(),k.push(m)}}}function m(a){var b,c,d=0;for(b=0;b<o.length;b++)c=o.charCodeAt(b),c>32&&(d+=a[c]);var e=new CharSet;for(b=0;b<o.length;b++)c=o.charCodeAt(b),c>32&&e.push(new CharSetItem(c,a[c]/d));return e}var n=0,o="",p=null,q=null,r=Object.create(null),s=[],t="";f();var u=new RandomWordsGenerator,v=k();return l(new Array(n),0,v,!1),u.charSet=m(v),u.nextWord=function(){try{for(var a=i(this.subSet,this.boost,s,this.wordLimit);t==a;)a=i(this.subSet,this.boost,s,this.wordLimit);return t=a}catch(b){return"x"}},u.nextFragment=function(){for(var a="";;){var b=this.nextWord();if(this.enableCapitals&&(b=b.substring(0,1).toUpperCase()+b.substring(1)),this.enablePunctuators){var c=this.punctuators[Math.floor(Math.random()*this.punctuators.length)];switch(c){case null:break;case"-":b=b+"-"+this.nextWord();break;case"(":b="("+b+")";break;case"[":b="["+b+"]";break;case'"':b='"'+b+'"';break;case"'":b=b+"'"+this.nextWord();break;default:b+=c}}if(0==a.length){if(a=b,a.length>this.fragmentLimit)break}else{if(a.length+1+b.length>this.fragmentLimit)break;a+=" "+b}}return d.censor(a,"omg")},u}function e(){i=[],j=null}function f(a){j=new XMLHttpRequest,j.onload=function(){i.forEach(function(a){a(h=d(j.response,g))}),e()},j.onerror=function(){i.forEach(function(a){a(h=new DummyGenerator("error loading language data"))}),e()},watchProgress(j),j.open("GET",a,!0),j.responseType="arraybuffer",j.send()}this.code=a,c.prototype=[],c.prototype.boost=function(a,b){for(var c=0;c<this.length;c++){var d=this[c];if(d.charCode==a)return d.weight=Math.round(d.weight*b),!0}return!1},c.prototype.weight=function(){for(var a=0,b=0;b<this.length;b++){var c=this[b];a+=c.weight}return a},c.prototype.pickRandom=function(){for(var a=this.weight(),b=Math.floor(Math.random()*(a+1)),c=0;c<this.length;c++){var d=this[c];if(b<=d.weight)return d;b-=d.weight}throw new Error};var g=CENSOR.get(this.code),h=null,i=[],j=null;return this.load=function(a){null==h?(i.push(a),null==j&&f("/data/lang-"+this.code+".data")):a(h)},Object.freeze(this)}function Language(a,b){return this.id=a,this.name=b,Object.freeze(this)}function CustomKeyboardEvent(a){return this.ev=a,this.type=a.type,this.timeStamp=a.timeStamp,this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.location=a.location,this.keyCode=VK.normalizeKeyCode(a.keyCode),Object.defineProperty(this,"eventPhase",{configurable:!1,enumerable:!0,get:function(){return a.eventPhase}}),Object.defineProperty(this,"bubbles",{configurable:!1,enumerable:!0,get:function(){return a.bubbles}}),Object.defineProperty(this,"cancelable",{configurable:!1,enumerable:!0,get:function(){return a.cancelable}}),Object.defineProperty(this,"defaultPrevented",{configurable:!1,enumerable:!0,get:function(){return a.defaultPrevented}}),Object.defineProperty(this,"cancelBubble",{configurable:!1,enumerable:!0,get:function(){return a.cancelBubble},set:function(b){a.cancelBubble=b}}),Object.freeze(this)}function LayoutKey(a,b,c,d,e,f,g){function h(a){if(null==a)return 0;if("string"==typeof a)return a.charCodeAt(0);if("number"==typeof a)return a;throw new Error}return this.position=a,this.keyCode=b,this.alpha=c,this.primary=h(d),this.primaryShift=h(e),this.secondary=h(f),this.secondaryShift=h(g),Object.freeze(this)}function KeyCombo(a,b,c,d,e,f,g){function h(a,b,c,d,e){var f=1;return a&&f++,b&&f++,c&&(f++,d&&f++,e&&f++),f}return this.charCode=a,this.key=b,this.shift=c,this.alt=d,this.deadKey=e,this.deadShift=f,this.deadAlt=g,this.complexity=h(c,d,e,f,g),Object.freeze(this)}function Layout(a,b,c,d,e,f,g){function h(a){var b=m.comboMap[a.charCode];if(b){if(b.deadKey&&a.deadKey)throw new Error;b.deadKey&&!a.deadKey&&(m.comboMap[a.charCode]=a)}else m.comboMap[a.charCode]=a;m.charSet.push(a.charCode)}function i(a,b,c,d){a>0&&!Unicode.isCombining(a)&&(n.push(a),h(new KeyCombo(a,b,c,d)))}function j(a,b,c,d){if(a>0&&Unicode.isCombining(a))for(var e=0;e<n.length;e++){var f=n[e],g=Unicode.combine(f,a);if(g!=f){var i=m.comboMap[f];h(i.applyDeadKey(g,b,c,d))}}}this.id=a,this.xid=b,this.name=c,this.lang=d,this.keys=e,this.geometry=f,this.variantOf=g,this.config={emulate:!1},this.charSet=[],this.comboMap=[];var k,l;for(this.byKeyCode=[],this.byPosition=[],k=0;k<this.keys.length;k++)this.byKeyCode[this.keys[k].keyCode]=this.keys[k],this.byPosition[this.keys[k].position]=this.keys[k];for(this.geometryMap=[],k=0;k<this.geometry.length;k++)this.geometryMap[this.geometry[k].id]=this.geometry[k];var m=this,n=[];for(k=0;k<this.keys.length;k++)l=this.keys[k],i(l.primary,l,!1,!1),i(l.primaryShift,l,!0,!1),i(l.secondary,l,!1,!0),i(l.secondaryShift,l,!0,!0);for(k=0;k<this.keys.length;k++)l=this.keys[k],j(l.primary,l,!1,!1),j(l.primaryShift,l,!0,!1),j(l.secondary,l,!1,!0),j(l.secondaryShift,l,!0,!0);return this.charSet.sort(function(a,b){return a-b}),Object.freeze(this)}function KeyboardEventHandler(a,b){this.layout=a,this.sink=b}function KeyboardShakeAnimation(a){ShakeAnimation.call(this),this.keyMap=a}function dumpGeometry(){function a(a){return void 0===a||null===a?"":a}function b(b){for(var c="",d=0;d<b.length;d++){var e=b[d],f=e.id;f="number"==typeof f?"VK."+VK.name(f):'"'+f+'"',c+="{ id: "+f+", x: "+e.x+", y: "+e.y+', ref: "'+a(e.ref)+'", c: "'+a(e.c)+'" },\n'}return c}for(var c in LAYOUT_GEOMETRY){var d=LAYOUT_GEOMETRY[c];console.log("--- "+c+" ---"),console.log(b(d))}}function dumpLayout(){function a(a){function b(a){try{return"VK."+VK.name(a)}catch(b){return a}}function c(a){if(0==a)return"null";var b=String.fromCharCode(a);return"\\"==b&&(b="\\\\"),'"'==b&&(b='\\"'),a+' /*"'+b+'"*/'}var d="";for(var e in a.keys){var f=a.keys[e];d+=f.keyCode==f.position?"LayoutKey.std("+b(f.keyCode)+", "+f.alpha+", "+c(f.primary)+", "+c(f.primaryShift)+", "+c(f.secondary)+", "+c(f.secondaryShift)+"),\n":"LayoutKey.ext("+b(f.position)+", "+b(f.keyCode)+", "+f.alpha+", "+c(f.primary)+", "+c(f.primaryShift)+", "+c(f.secondary)+", "+c(f.secondaryShift)+"),\n"}return d}for(var b in LAYOUT){var c=LAYOUT[b];console.log("--- "+b+" ---"),console.log(a(c))}}function keyName(a){return"object"==typeof a&&(a=a.charCode),String.fromCharCode(a).toUpperCase()}function Sounds(){this.library=null}function Enum(){}function ModeType(a,b,c){return this.id=a,this.xid=b,this.title=c,Object.freeze(this)}function Mode(a,b,c){return this.id=a,this.xid=b,this.type=c,this.config={},Object.freeze(this)}function SpeedUnit(a,b,c){return this.id=a,this.title=b,this.measure=c,Object.freeze(this)}function ModeKey(a,b){return"string"==typeof a&&(a=Enum.fromCode(LAYOUT,a)),"string"==typeof b&&(b=Enum.fromCode(MODE_TYPE,b)),this.layout=a,this.modeType=b,this.key=this.layout.id+":"+this.modeType.id,Object.freeze(this)}function Settings(a,b){this.cid=a,this.layout=Settings.DEFAULT_LAYOUT,this.emulateLayout=!1,this.mode=Settings.DEFAULT_MODE,this.lesson={complexity:1,length:1,capitals:!1,punctuators:!1},this.speedUnit=SPEED_UNIT.WPM,this.enableSound=!1,this.textConfig={url:"",text:"",mangle:{simplify:!0,lowercase:!0,censor:!0}},this.newSettings=!0,(void 0===b||b)&&(this.reload(),this.newSettings&&this.persist()),Object.defineProperty(this,"modeKey",{get:function(){return ModeKey.get(this.layout,this.mode.type)}})}function ResultArray(){}function CharSetItem(a,b){return this.charCode=a,this.f=b,Object.freeze(this)}function CharSet(){}function Statistics(){this.n=0,this.mean=0,this.m2=0,this.variance=null}function MovingMean(a,b){this.size=a,this.sink=b||[],this.data=[],this.sum=0,this.mean=null,this.min=null,this.max=null}function KeyData(a){this.charCode=a,this.t=[],this.st=[],this.statistics=new Statistics,this.movingMean=new MovingMean(Lesson.WINDOW_SIZE,this.st),this.learningTime=0}function Forecast(a,b){this.charSet=a,this.data=b,this.map=Object.create(null);for(var c=0;c<this.charSet.length;c++){var d=this.charSet[c];this.map[d.charCode]=new KeyData(d.charCode)}for(var e=0;e<this.data.length;e++)this._add(this.data[e])}function Histogram(a,b){this.charSet=a,this.data=b,this.map=Object.create(null),this.minh=null,this.maxh=0,this.minm=null,this.maxm=0,this.minr=null,this.maxr=0,this.count=0;for(var c=0;c<this.charSet.length;c++){var d=this.charSet[c];this.map[d.charCode]={h:0,m:0,r:0}}for(var e=0;e<this.data.length;e++)this.add(this.data[e])}function History(a){this.id=a,this.data=Object.create(null)}function Sync(a){this.id=a,this.url="/sync",this.data=new ResultArray}function Serializer(){this.array=[],this.size=0}function generateExampleData(a){var b=new ResultArray,c=Settings.DEFAULT_LAYOUT,d=MODE_TYPE.AUTO,e=ModeKey.get(c,d);LanguageModel.get(c.lang).load(function(c){for(var d=(new Lesson(new Settings(""),c),c.charSet),f=Date.now(),g=864e5,h=30,i=0;h>i;i++)for(var j=(i+1)/h,k=f-(h-i)*g,l=Math.randomInt(10,20),m=0;l>m;m++){for(var n=1e3*Math.randomInt(30-20*j,50-25*j),o=Math.randomInt(0,15-15*j),p=Object.create(null),q=0;q<d.length;q++){var r=d[q];p[r.charCode]={h:Math.randomInt(0,Math.round(r.f/d.maxf*10)+1),m:0,t:Math.randomInt(Math.round(500-300*j),Math.round(900-600*j))}}var s=new Result(e,k,40,n,o,20,p);b.push(s),k+=n+1e3*Math.randomInt(1,5)}a(b)})}function Achievement(a,b){this.id=a,this.value=b}function AchievementsAnalyzer(){this.reset()}function StaticLesson(a,b){return this.settings=a,this.generator=b,this.charSet=new CharSet,this}function Lesson(a,b){return this.settings=a,this.generator=b,this.charSet=this.settings.layout.filterCharSet(this.generator.charSet).orderBy(CharSet.ORDER_BY.FREQUENCY),this.generator.punctuators=this.settings.layout.filterCharacters(".,:;!?-([\"'").map(function(a){return String.fromCharCode(a)}),this}function LessonUi(){throw new Error}function Result(a,b,c,d,e,f,g){return this.modeKey=a,this.timeStamp=b,this.length=c,this.time=d,this.errors=e,this.complexity=f,this.speed=this.length/(this.time/1e3)*60,this.score=this.speed*this.complexity/(this.errors+1)*(this.length/50),this.histogram=g,Object.freeze(this)}function Fragment(a,b){this.modeKey=a,this.lesson=b,this.text=this.lesson.generate(),this.complexity=this.modeKey.layout.complexity(this.text),this.reset()}function FragmentUi(a,b){this.fragment=b,this.fragmentEl=_dom.el("div",["fragment"]),this.itemEl=[];for(var c=this.fragment.text,d=0;d<c.length;d++){var e=c.charCodeAt(d);if(10==e)this.fragmentEl.appendChild(this.itemEl[d]=_dom.el("span",["item","new-line"],"↵")),this.fragmentEl.appendChild(_dom.el("br",null,null));else if(32==e)this.fragmentEl.appendChild(this.itemEl[d]=_dom.el("span",["item","space"],"␣")),this.fragmentEl.appendChild(_dom.el("span",null," "));else{var f=["item"];a.boost&&a.boost.charCode&&e==a.boost.charCode&&f.push("boosted"),this.fragmentEl.appendChild(this.itemEl[d]=_dom.el("span",f,String.fromCharCode(e)))}}this.updateUi()}function LessonDetailsUi(a){this.$el=a}function FragmentShakeAnimation(a){ShakeAnimation.call(this),this.elArray=a}function Shake(a){this.a=a}function ShakeAnimation(){}function initGameUi(a){$("#ctl-reset").on("click",function(){a.reset()}),$("#ctl-skip").on("click",function(){a.next()}),$("#vote-box-close").on("click",function(){$("#vote-box").fadeOut()})}function initSettingsUi(a){function b(a){function b(){LanguageModel.get(o.layout.lang).load(function(a){var b=new Lesson(o,a),c=p.get(ModeKey.get(o.layout,MODE_TYPE.AUTO)),d=new Forecast(b.charSet,c);b.update(d),new LessonDetailsUi(r).update(d,b),s.text(b.generate())})}T&&(window.clearTimeout(T),T=null),a?b():T=window.setTimeout(function(){T=null,b()},100)}function c(){N.text(o.speedUnit.id),N.attr("title",o.speedUnit.title),O.attr("title",o.speedUnit.title)}function d(){b(!0)}function e(){}function f(){}function g(){}function h(){}function i(){}function j(){switch(Q.reveal("_form-1"),t.val(Math.round(100*o.lesson.complexity)),u.val(Math.round(100*o.lesson.length)),v.attr("checked",o.lesson.capitals),w.attr("checked",o.lesson.punctuators),x.val(o.textConfig.url),y.val(o.textConfig.text),z.attr("checked",o.textConfig.mangle.simplify),A.attr("checked",o.textConfig.mangle.lowercase),B.attr("checked",o.textConfig.mangle.censor),o.mode){case MODE.GUIDED:R.reveal("_fieldset-mode-1");break;case MODE.IMPORT_WEBSITE:R.reveal("_fieldset-mode-2");break;case MODE.IMPORT_TEXT:R.reveal("_fieldset-mode-3")}switch(o.speedUnit){case SPEED_UNIT.WPM:K.attr("checked",!0),L.attr("checked",!1);break;default:K.attr("checked",!1),L.attr("checked",!0)}M.attr("checked",o.enableSound),S.reset(),P.reset(),document.addEventListener("keydown",U,!0),document.addEventListener("keyup",V,!0)}function k(){document.removeEventListener("keydown",U,!0),document.removeEventListener("keyup",V,!0)}function l(){switch(o.layout=S.layout,o.emulateLayout=S.emulateLayout,R.mode){case"_fieldset-mode-1":o.mode=MODE.GUIDED;break;case"_fieldset-mode-2":o.mode=MODE.IMPORT_WEBSITE;break;case"_fieldset-mode-3":o.mode=MODE.IMPORT_TEXT}return o.lesson.capitals=v.is(":checked"),o.lesson.punctuators=w.is(":checked"),o.textConfig.url=x.val().trim(),o.textConfig.text=y.val().trim(),o.textConfig.mangle.simplify=z.is(":checked"),o.textConfig.mangle.lowercase=A.is(":checked"),o.textConfig.mangle.censor=B.is(":checked"),o.speedUnit=K.is(":checked")?SPEED_UNIT.WPM:SPEED_UNIT.CPM,o.enableSound=M.is(":checked"),c(),m()}function m(){switch(o.mode){case MODE.IMPORT_WEBSITE:if(0==o.textConfig.url.length)return Q.reveal("_form1"),R.reveal("_fieldset-mode-2"),x.focus(),!1;break;case MODE.IMPORT_TEXT:if(0==o.textConfig.text.length)return Q.reveal("_form1"),R.reveal("_fieldset-mode-3"),y.focus(),!1}return!0}var n=function(){var a='Jabberwocky\n\n\'Twas brillig, and the slithy toves\nDid gyre and gimble in the wabe;\nAll mimsy were the borogoves,\nAnd the mome raths outgrabe.\n\n"Beware the Jabberwock, my son!\nThe jaws that bite, the claws that catch!\nBeware the Jubjub bird, and shun\nThe frumious Bandersnatch!"\n\nHe took his vorpal sword in hand:\nLong time the manxome foe he sought-\nSo rested he by the Tumtum tree,\nAnd stood awhile in thought.\n\nAnd as in uffish thought he stood,\nThe Jabberwock, with eyes of flame,\nCame whiffling through the tulgey wood,\nAnd burbled as it came!\n\nOne, two! One, two! and through and through\nThe vorpal blade went snicker-snack!\nHe left it dead, and with its head\nHe went galumphing back.\n\n"And hast thou slain the Jabberwock?\nCome to my arms, my beamish boy!\nO frabjous day! Callooh! Callay!"\nHe chortled in his joy.\n\n\'Twas brillig, and the slithy toves\nDid gyre and gimble in the wabe;\nAll mimsy were the borogoves,\nAnd the mome raths outgrabe.',b="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut egestas libero non laoreet scelerisque. Mauris nec sodales velit. Quisque mattis eu nulla varius accumsan. Sed interdum erat eu justo sodales, vel hendrerit diam pretium. Phasellus lacus libero, scelerisque quis enim eget, tempus elementum massa. Aenean elementum nec magna at fringilla. Nam nisl eros, viverra et luctus eget, placerat non velit. Cras ante velit, mattis quis porttitor nec, pellentesque eu sem. Aenean blandit consectetur metus ut bibendum. Aliquam in suscipit erat. Praesent non vulputate tortor, ac semper diam.",c="Imagine all human beings swept off the face of the earth, excepting one man. Imagine this man in some vast city, New York or London. Imagine him on the third or fourth day of his solitude sitting in a house and hearing a ring at the door-bell!";return{jabberwocky:a,loremipsum:b,story:c}}(),o=a.settings,p=a.history,q=$("#_form-1"),r=($("#_form-2"),$("#_form-3"),$("#_lesson-details")),s=$("#_lesson-example"),t=$("#_range-lesson-complexity"),u=$("#_range-lesson-length"),v=$("#_cb-enable-capitals"),w=$("#_cb-enable-punctuators"),x=$("#_url"),y=$("#_text"),z=$("#_cb-simplify"),A=$("#_cb-lowercase"),B=$("#_cb-censor"),C=$("#_t0"),D=$("#_t1"),E=$("#_t2"),F=C.find(".field-list"),G=$("#_language-list"),H=$("#_layout-list"),I=$("#_layout-demo"),J=$("#_cb-emulate-layout"),K=$("#_rb-speed-unit-wpm"),L=$("#_rb-speed-unit-cpm"),M=$("#_cb-enable-sound"),N=$(".speed-unit-text"),O=$(".speed-unit-title"),P=new KeyboardUi,Q={$items:$("ul.menu > li"),$forms:$("form.settings"),init:function(){var a=this;this.$items.on("click",function(){var b=$(this);a.reveal(b.data("for"))})},reveal:function(a){switch(this.$items.each(function(b,c){var d=$(c);d.data("for")==a?d.addClass("active"):d.removeClass("active")}),this.$forms.each(function(b,c){var d=$(c);c.id==a?d.show():d.hide()}),a){case"_form-1":d();break;case"_form-2":e();break;case"_form-3":f();break;default:throw new Error("unknown id: "+a)}}};Q.init();var R={mode:null,$items:q.find("input[name=mode]"),$forms:q.find("fieldset"),init:function(){var a=this;this.$items.on("click",function(){var b=$(this);a.mode=b.val(),a.reveal(b.val())})},reveal:function(a){switch(this.$items.each(function(b,c){var d=$(c);d.val()==a?d.attr("checked",!0):d.attr("checked",!1)}),this.$forms.each(function(b,c){var d=$(c);c.id==a?d.show():d.hide()}),a){case"_fieldset-mode-1":C.append(F),g();break;case"_fieldset-mode-2":D.append(F),h();break;case"_fieldset-mode-3":E.append(F),i();break;default:throw new Error("unknown id: "+a)}}};R.init();var S={map:Object.create(null),layout:null,emulateLayout:null,init:function(){var a=this;a.languageList=new DropDown(G);for(var b in LAYOUT){var c=LAYOUT[b],d=c.lang,e=this.map[d];void 0===e&&(this.map[d]=e=[],a.languageList.add(LANGUAGE[d].name,d)),e.push(c)}a.languageList.change=function(b,c){a.switchLanguage(c)},J.on("click",function(){a.emulateLayout=J.is(":checked"),a.update()})},reset:function(){var a=this;a.layout=o.layout,a.emulateLayout=o.emulateLayout,a.switchLanguage(a.layout.lang),a.update()},switchLanguage:function(a){var b=this;H.empty();var c=$();$.each(b.map[a],function(a,d){var e=$("<span></span>").addClass("ui radio").text(d.name);H.append($("<li></li>").append(e)),c=c.add(e),d==b.layout&&e.addClass("checked"),e.on("click",function(){c.removeClass("checked"),e.addClass("checked"),b.layout=d,b.update()})})},update:function(){var a=this;a.languageList.select(a.layout.lang),a.layout.config.emulate=a.emulateLayout,P.init(I[0],a.layout),J.each(function(b,c){c.disabled=a.layout.variantOf?!1:!0,c.checked=a.emulateLayout})}};S.init();var T,U=function(a){P.keyDown(new CustomKeyboardEvent(a))},V=function(a){P.keyUp(new CustomKeyboardEvent(a))};t.on("change",function(){o.lesson.complexity=t.val()/100,b(!1)}),u.on("change",function(){o.lesson.length=u.val()/100,b(!1)}),v.on("change",function(){o.lesson.capitals=v.is(":checked"),b(!0)}),w.on("change",function(){o.lesson.punctuators=w.is(":checked"),b(!0)}),c(),q.find("a.example-url").on("click",function(){return x.val($(this).data("url")),!1}),q.find("a.example-text").on("click",function(){return y.val(n[$(this).data("name")]),!1}),$("#submit").on("click",function(){return l()?document.dispatchEvent(new CustomEvent("settings-changed",{detail:{settings:o},bubbles:!0,cancelable:!1}))?(o.persist(),o.loadLesson(function(b){a.start(b)}),!0):!1:!1}),document.addEventListener("reveal-page",function(a){"#settings"==a.detail.url&&j()}),document.addEventListener("hide-page",function(a){"#settings"==a.detail.url&&k()})}function initProfileUi(a){function b(a,b,c,d,e){this.size=a,this.top=b,this.right=c,this.bottom=void 0!==d?d:b,this.left=void 0!==e?e:c,this.width=this.size.width-this.left-this.right,this.height=this.size.height-this.top-this.bottom}function c(){this.gap=0}function d(a){for(var b=new c,d=null,e=0;e<a.length;e++){var f=a[e];if(d){var g=f.timeStamp-d.timeStamp;g>864e5&&(b.length>0&&this.push(b),b=new c,b.gap=g)}b.push(f),d=f}b.length>0&&this.push(b)}function e(a){var b=$(a),c=b.width(),d=b.height();return b.attr("width",c=b.parent().width()),{width:c,height:d}}function f(a,b){a.text2("Not enough data").leading(new SVG.Number("1em")).x(b.x(b.width/2)).cy(b.y(b.height/2-15)).font({size:"30px",anchor:"middle"}).fill("#999999")}function g(){var a=new AchievementsAnalyzer,b=a.analyze(T.data);if(v.empty(),b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.list.length;e++){var f=d.list[e];if(f.id!=ACH_ID.MAX_SPEED&&f.id!=ACH_ID.MAX_SCORE){var g=$("<div></div>").addClass("badge");g.attr("title",f+" "+new Date(d.timeStamp).toLocaleString()),g.addClass(f.id),g.addClass(f.value),v.append(g)}}}function h(){function a(){n.rect(i.width,i.height).move(i.x(0),i.y(0)).attr("class","f");for(var a=0;a<j.length;a++){var b=j[a];n.text2(keyName(b)).leading(new SVG.Number("1em")).x(i.x(0)-20).cy(i.y(a*m)+k/2).font({anchor:"middle"}).attr("class","l")}n.text2(String(T.data.length)).leading(new SVG.Number("1em")).x(i.x(i.width)).y(i.y(i.height)+3).font({size:"10px",anchor:"middle"})}function c(){for(var a=0;a<j.length;a++)for(var b=j[a],c=0;c<T.data.length;c++){var d=T.data[c],e=d.histogram,f=e[b.charCode];if(f){var g=KeyData.confidenceLevel(f.t),n=LessonUi.confidenceColor(g);h.fillStyle=n.toString(),h.fillRect(i.x(c*l),i.y(a*m),l,k)}}}$(G).empty();var d=e(G),g=SVG(G).size(d.width,d.height);g.clear(),e(F);var h=F.getContext("2d");h.clearRect(0,0,d.width,d.height);var i=new b(d,40,50),j=T.charSet.orderBy(CharSet.ORDER_BY.FREQUENCY),k=8,l=Math.min(i.width/T.data.length,30),m=(i.height-k)/(j.length-1),n=g.group();a(),T.data.length>2?c():f(n,i)}function i(){function c(){function a(a){var b=["Character '"+keyName(a)+"'"];return a.t?(b.push("Typing speed: "+round(r.fromTime(a.t),1)+r.id),b.push("Time to type: "+round(a.t,1)+"ms"),b.push("Confidence level: "+round(a.confidenceLevel,100))):b.push("Not calibrated"),b.join("; ")}B.empty();for(var b=0;b<q.length;b++){var c=q[b],e=T.forecast.map[c.charCode],f={charCode:c.charCode,t:e.movingMean.mean||e.statistics.mean,isConfident:e.isConfident(),confidenceLevel:e.confidenceLevel()},g=$("<span></span>").addClass("key").css("background-color",String(LessonUi.confidenceColor(f.confidenceLevel))).text(keyName(c)).attr("title",a(f)).data("item",f);B.append(g),s[c.charCode]=g}var h=B.children();h.on("click",function(){d(T.charCode=$(this).data("item").charCode)})}function d(a){function b(a){return j.x(a/e.length*j.width)}function c(a){return j.y(j.height-a/q*j.height)}for(var d in s)s[d].removeClass("current");s[a].addClass("current");var e,f=T.forecast.map[a],h=r.fromTime(Lesson.MIN_TIME),k=null,q=0;if(e=p?f.st:f.t,e.length>0&&(k=Math.linearRegression(e.map(function(a){return r.fromTime(a)})),q=Math.max(k.max,h)),m.text(String(round(q,1))+r.id),n.text(String(round(q/2,1))+r.id),o.text(String(f.t.length)),i.clearRect(0,0,g.width,g.height),e.length>0){var t=f.learningRate(r),u="~"+String(round(t.perSample,1e3))+r.id+"/sample",v="~"+String(round(t.perHour,1))+r.id+"/hour";C.text(u+", "+v),l.y(c(h));for(var w=Math.max(Math.min(j.width/e.length,12),6),x=0;x<e.length;x++){var y=e[x];i.fillStyle="#6FB48C",i.beginPath(),i.arc(b(x),c(r.fromTime(y)),w,0,2*Math.PI,!0),i.closePath(),i.fill()}i.lineWidth=14,i.strokeStyle="rgba(111,180,140,0.7)",i.beginPath(),i.moveTo(b(0),c(k.fn(0))),i.lineTo(b(e.length),c(k.fn(e.length))),i.stroke()}else C.text("-"),l.y(j.y(0))}$(I).empty();var g=e(I),h=SVG(I).size(g.width,g.height);h.clear(),e(H);var i=H.getContext("2d");i.clearRect(0,0,g.width,g.height);var j=new b(g,40,50),k=h.group(),l=k.line(j.x(0),j.y(0),j.x(j.width),j.y(0)).attr("class","threshold");k.rect(j.width,j.height).move(j.x(0),j.y(0)).attr("class","f"),k.line(j.x(0),j.y(.25*j.height),j.x(j.width),j.y(.25*j.height)).attr("class","f"),k.line(j.x(0),j.y(.5*j.height),j.x(j.width),j.y(.5*j.height)).attr("class","f"),k.line(j.x(0),j.y(.75*j.height),j.x(j.width),j.y(.75*j.height)).attr("class","f"),k.line(j.x(0),j.y(0),j.x(j.height),j.y(0)).attr("class","f"),k.line(j.x(.25*j.width),j.y(0),j.x(.25*j.width),j.y(j.height)).attr("class","f"),k.line(j.x(.5*j.width),j.y(0),j.x(.5*j.width),j.y(j.height)).attr("class","f"),k.line(j.x(.75*j.width),j.y(0),j.x(.75*j.width),j.y(j.height)).attr("class","f"),k.line(j.x(-20),j.y(j.height),j.x(j.width+20),j.y(j.height)).attr("class","f axis"),k.line(j.x(0),j.y(-20),j.x(0),j.y(j.height+20)).attr("class","f axis");
var m=k.text2("").leading(new SVG.Number("1em")).x(j.x(0)-3).cy(j.y(0)).font({size:"10px",anchor:"end"}),n=k.text2("").leading(new SVG.Number("1em")).x(j.x(0)-3).cy(j.y(j.height/2)).font({size:"10px",anchor:"end"}),o=k.text2("").leading(new SVG.Number("1em")).x(j.x(j.width)).y(j.y(j.height)+3).font({size:"10px",anchor:"middle"}),p=D.is(":checked"),q=T.charSet.orderBy(CharSet.ORDER_BY.FREQUENCY),r=a.settings.speedUnit,s=Object.create(null);c(),T.data.length>2?(0==T.charCode&&(T.charCode=q[0].charCode),d(T.charCode)):(C.text("-"),f(k,j))}function j(){function c(a){return l.x(a/s.length*l.width)}function d(a){return l.y(l.height-a/u.max*l.height)}function g(a){return l.y(l.height-a/v.max*l.height)}function h(){for(var a=Math.max(Math.min(l.width/s.length,12),6),b=0;b<s.length;b++){var e=c(b),f=d(s[b]),h=g(t[b]),i=Math.abs(f-h)<1;k.fillStyle="rgba(172,113,208,1)",k.beginPath(),k.arc(e,f,i?a+1:a,0,2*Math.PI,!0),k.closePath(),k.fill(),k.fillStyle="rgba(111,180,140,1)",k.beginPath(),k.arc(e,h,i?a-1:a,0,2*Math.PI,!0),k.closePath(),k.fill()}k.lineWidth=14,k.strokeStyle="rgba(172,113,208,0.7)",k.beginPath(),k.moveTo(c(0),d(u.fn(0))),k.lineTo(c(s.length),d(u.fn(s.length))),k.stroke(),k.lineWidth=14,k.strokeStyle="rgba(111,180,140,0.7)",k.beginPath(),k.moveTo(c(0),g(v.fn(0))),k.lineTo(c(s.length),g(v.fn(s.length))),k.stroke()}$(K).empty();var i=e(K),j=SVG(K).size(i.width,i.height);j.clear(),e(J);var k=J.getContext("2d");k.clearRect(0,0,i.width,i.height);var l=new b(i,40,50),m=j.group();m.rect(l.width,l.height).move(l.x(0),l.y(0)).attr("class","f"),m.line(l.x(0),l.y(.25*l.height),l.x(l.width),l.y(.25*l.height)).attr("class","f"),m.line(l.x(0),l.y(.5*l.height),l.x(l.width),l.y(.5*l.height)).attr("class","f"),m.line(l.x(0),l.y(.75*l.height),l.x(l.width),l.y(.75*l.height)).attr("class","f"),m.line(l.x(0),l.y(0),l.x(l.height),l.y(0)).attr("class","f"),m.line(l.x(.25*l.width),l.y(0),l.x(.25*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(.5*l.width),l.y(0),l.x(.5*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(.75*l.width),l.y(0),l.x(.75*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(-20),l.y(l.height),l.x(l.width+20),l.y(l.height)).attr("class","f axis"),m.line(l.x(0),l.y(-20),l.x(0),l.y(l.height+20)).attr("class","f axis");var n=m.text2("").leading(new SVG.Number("1em")).x(l.x(0)-3).cy(l.y(0)).font({size:"10px",anchor:"end"}),o=m.text2("").leading(new SVG.Number("1em")).x(l.x(0)-3).cy(l.y(l.height/2)).font({size:"10px",anchor:"end"}),p=m.text2("").leading(new SVG.Number("1em")).x(l.x(l.width)).y(l.y(l.height)+3).font({size:"10px",anchor:"middle"}),q=E.is(":checked"),r=a.settings.speedUnit,s=T.data.map(function(a){return a.score}),t=T.data.map(function(a){return r.measure(a.speed)});q&&(s=MovingMean.smooth(Lesson.WINDOW_SIZE,s),t=MovingMean.smooth(Lesson.WINDOW_SIZE,t));var u=Math.linearRegression(s),v=Math.linearRegression(t);n.text(String(round(v.max,1))+r.id),o.text(String(round(v.max/2,1))+r.id),p.text(String(T.data.length)),T.data.length>2?h():f(m,l)}function k(){function c(){for(var a=0,b=0;b<j.length;b++){var c=j[b],d=T.forecast.map[c.charCode],e=d.movingMean.mean||d.statistics.mean;e&&(a=Math.max(a,k.fromTime(e)))}return a}function d(){for(var a=0;a<j.length;a++){var b,c=j[a],d=T.forecast.map[c.charCode],e=d.movingMean.mean||d.statistics.mean,f=i.x(a*m);if(e){var g=k.fromTime(e),h=g/n*i.height;o.rect(m-l,h).move(f,i.y(i.height-h)).attr("class","b").title(String(round(g,1))+k.id),b="l"}else b="l empty";o.text2(keyName(j[a])).move(f+m/2-l/2,i.y(i.height)).font({anchor:"middle"}).attr("class",b)}}$(L).empty();var g=e(L),h=SVG(L).size(g.width,g.height);h.clear();var i=new b(g,40,50),j=T.charSet.orderBy(CharSet.ORDER_BY.INDEX),k=a.settings.speedUnit,l=5,m=(i.width+l)/j.length,n=c(),o=h.group(),p=h.group();p.rect(i.width,i.height).move(i.x(0),i.y(0)).attr("class","f"),p.text2(String(round(n,1))+k.id).x(i.x(0)-3).cy(i.y(0)).font({size:"10px",anchor:"end"}),p.text2(String(round(n/2,1))+k.id).x(i.x(0)-3).cy(i.y(i.height/2)).font({size:"10px",anchor:"end"}),T.data.length>0?d():f(p,i)}function l(){$(M).empty();var a=e(M),c=SVG(M).size(a.width,a.height);c.clear();var d=new b(a,40,50),g=T.charSet.orderBy(CharSet.ORDER_BY.INDEX),h=5,i=(d.width+h)/g.length,j=.5*d.height,k=.25*d.height-10,l=.25*d.height-10,m=c.group(),n=c.group();if(n.rect(d.width,j).move(d.x(0),d.y(0)).attr("class","f"),n.rect(d.width,k).move(d.x(0),d.y(j+10)).attr("class","f"),n.rect(d.width,l).move(d.x(0),d.y(j+k+20)).attr("class","f"),T.data.length>0)for(var o=0;o<g.length;o++){var p=d.x(o*i),q=T.histogram.map[g[o].charCode],r="l";if(q.h){var s=q.h/T.histogram.maxh*j,t=q.m/T.histogram.maxm*k,u=q.r/T.histogram.maxr*l;m.rect(i-h,s).move(p,d.y(j-s)).attr("class","b h").title(q.h),m.rect(i-h,t).move(p,d.y(j+k-t+10)).attr("class","b m").title(q.m),m.rect(i-h,u).move(p,d.y(j+k+l-u+20)).attr("class","b r").title(round(q.r,100)),r="l"}else r="l empty";m.text2(keyName(g[o])).move(p+i/2-h/2,d.y(d.height)).font({anchor:"middle"}).attr("class",r)}else f(n,d)}function m(){$(O).empty();var a=new SVG(O);a.clear(),$(P).empty();var b=new SVG(P);b.clear();for(var c,d=T.charSet,e=T.histogram.minh,f=T.histogram.maxh,g=T.histogram.minm,h=T.histogram.maxm,i=f-e,j=h-g,k=0;k<d.length;k++){var l=d[k],m=T.modeKey.layout.keyCombo(l.charCode);if(m&&!m.deadKey){var n=S.getKeyPoint(m.key.position),o=T.histogram.map[d[k].charCode];o.h&&(c=Math.round((o.h-e)/i*30)+20,a.circle(c).center(n.cx,n.cy).attr("class","h")),o.m&&(c=Math.round((o.m-g)/j*20)+5,b.circle(c).center(n.cx,n.cy).attr("class","m"))}}}function n(){for(var a=new DateX(Date.now()),b=Object.create(null),c=T.data.groupByDate(),d=0;d<c.length;d++){var e=c[d],f=e.date.year+"-"+e.date.month,g=b[f];void 0===g&&(b[f]=g=new p(e.date.year,e.date.month));for(var h=0;h<e.data.length;h++)g.add(e.date.day,e.data[h])}var i=mapValues(b).sort(function(a,b){return a.timeStamp-b.timeStamp});0==i.length&&i.push(new p(a.year,a.month));var j=$("#calendar");j.empty();for(var k=0;k<i.length;k++)j.append($(i[k].build()))}function o(a){this.day=a,this.count=0,this.time=0}function p(a,b){this.year=a,this.month=b,this.cell=[];var c=new Date(this.year,this.month-1,1,12,0,0,0);this.timeStamp=c.getTime(),this.dayOffset=0==c.getDay()?6:c.getDay()-1;for(var d=0;42>d;d++)if(d<this.dayOffset)this.cell[d]=null;else{var e=d-this.dayOffset,f=new Date(c.getTime()+1e3*e*60*60*24);this.cell[d]=c.getMonth()==f.getMonth()?new o(e+1):null}}function q(a){function b(a){return 10>a?"0"+a:a}var c=a/3600|0;a-=3600*c;var d=a/60|0;a-=60*d;var e=0|a;return b(c)+":"+b(d)+":"+b(e)}function r(){var b=a.settings.speedUnit,c=T.data.statistics();if(c.count){w.text(q(c.totalTime/1e3)),x.text(c.count),y.text(round(b.measure(c.topSpeed),1)),z.text(round(b.measure(c.avgSpeed),1));var d=T.data.today().statistics();A.text(d.count?round(b.measure(d.avgSpeed),1):"N/A")}else w.text(q(0)),x.text("0"),y.text("N/A"),z.text("N/A"),A.text("N/A");g(),h(),i(),j(),k(),l(),m(),n()}function s(){function b(a,b){var c=ModeKey.get(a),d=c.modeType.title+" / "+c.layout.name;e[a]={modeKey:c,data:b},R.add(d,a)}var c=a.history.data,e=Object.create(null);R.clear(),$.each(c,function(a,c){b(a,c)});var f=a.settings.modeKey.key;void 0===e[f]&&b(f,new ResultArray),R.change=function(a,b){var c=e[b];S.init(N,c.modeKey.layout),LanguageModel.get(c.modeKey.layout.lang).load(function(a){var b=c.data.length>Lesson.WINDOW_SIZE;D.attr("checked",b),D.attr("disabled",!b),E.attr("checked",b),E.attr("disabled",!b);var e=c.modeKey.layout.filterCharSet(a.charSet).orderBy(CharSet.ORDER_BY.FREQUENCY);T={charSet:e,modeKey:c.modeKey,data:c.data,forecast:new Forecast(e,c.data),histogram:new Histogram(e,c.data),resultGroupArray:new d(c.data),charCode:0},r()})},R.select(f),V&&(window.URL.revokeObjectURL(V),V=null),U=new Blob([JSON.stringify(c)],{type:"application/json"}),V=window.URL.createObjectURL(U),Q.each(function(a,b){b.href=V,b.download="typing-data.json"})}function t(){V&&(window.URL.revokeObjectURL(V),V=null),U=null}var u=$("#group-list"),v=$("#achievements"),w=$("#g-s-total-time"),x=$("#g-s-total-samples"),y=$("#g-s-top-speed"),z=$("#g-s-avg-speed"),A=$("#g-s-avg-speed-today"),B=$("#key-list"),C=$("#g-learning-rate"),D=$("#cb-smooth-progress-details"),E=$("#cb-smooth-speed"),F=document.getElementById("canvas-chart-progress-overview"),G=document.getElementById("svg-chart-progress-overview"),H=document.getElementById("canvas-chart-progress-details"),I=document.getElementById("svg-chart-progress-details"),J=document.getElementById("canvas-chart-speed"),K=document.getElementById("svg-chart-speed"),L=document.getElementById("svg-histogram-key-speed"),M=document.getElementById("svg-histogram-key-frequency"),N=document.getElementById("svg-heat-map-layout"),O=document.getElementById("svg-heat-map-overlay-h"),P=document.getElementById("svg-heat-map-overlay-m"),Q=$("#download-data"),R=new DropDown(u),S=new KeyboardUi,T=null;SVG.ForeignObject=function(){this.constructor.call(this,SVG.create("foreignObject")),this.type="foreignObject"},SVG.ForeignObject.prototype=new SVG.Shape,SVG.extend(SVG.ForeignObject,{appendChild:function(a,b){var c="string"==typeof a?document.createElement(a):a;if("object"==typeof b)for(var d in b)c[d]=b[d];return this.node.appendChild(c),this},getChild:function(a){return this.node.childNodes[a]}}),SVG.extend(SVG.Container,{foreignObject:function(a,b){return this.put(new SVG.ForeignObject).size(null==a?100:a,null==b?100:b)}}),b.prototype={x:function(a){return a+this.left},y:function(a){return a+this.top}},SVG.Text2=function(){SVG.Text.call(this),this.styles={}},SVG.Text2.prototype=new SVG.Text,SVG.Text2.prototype.x=function(a,b){return null==a?b?this.attr("x"):this.bbox().x:(this.textPath||this.lines.each(function(){this.newLined&&this.x(a)}),this.attr("x",a))},SVG.extend(SVG.Container,{text2:function(a){return this.put(new SVG.Text2).text(a)}}),SVG.extend(SVG.Element,{title:function(a){var b=SVG.create("title");return b.textContent=a,this.node.insertBefore(b,this.node.firstChild),this}}),c.prototype=new ResultArray,d.prototype=[],o.prototype.add=function(a){this.count++,this.time+=a.time},o.prototype.className=function(){return this.count>30?"s3":this.count>20?"s2":this.count>10?"s1":this.count>0?"s0":"z"},p.prototype.add=function(a,b){this.cell[a+this.dayOffset-1].add(b)},p.prototype.build=function(){var a=_dom.el("div","calendar"),b=_dom.el("table"),c=_dom.el("caption",null,this.year+"/"+this.month);b.appendChild(c);var d=_dom.el("tr");d.appendChild(_dom.el("th",null,"M")),d.appendChild(_dom.el("th",null,"T")),d.appendChild(_dom.el("th",null,"W")),d.appendChild(_dom.el("th",null,"T")),d.appendChild(_dom.el("th",null,"F")),d.appendChild(_dom.el("th",null,"S")),d.appendChild(_dom.el("th",null,"S")),b.appendChild(d);for(var e=0;6>e;e++){for(var f=_dom.el("tr"),g=0;7>g;g++){var h,i=this.cell[7*e+g];null==i?h=_dom.el("td",null,null):(h=_dom.el("td",i.className(),i.day),i.count>0&&(h.title=i.count+" sample(s)")),f.appendChild(h)}b.appendChild(f)}return a.appendChild(b),a};var U=null,V=null;D.on("click",function(){i(T.forecast)}),E.on("click",function(){j(T.forecast)}),Q.on("click",function(){return V&&window.navigator.msSaveBlob?(window.navigator.msSaveBlob(U,"typing-data.json"),!1):void 0}),document.addEventListener("reveal-page",function(a){"#profile"==a.detail.url?s():t()})}function initAccount(){function a(a){console.log("loading facebook api"),$.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:global.facebook.appId,status:!0,cookie:!0,xfbml:!1}),a()})}function b(a){console.log("loading persona api"),$.ajaxSetup({cache:!0}),$.getScript("https://login.persona.org/include.js",function(){a()})}function c(){function a(){function a(){window.location.href="/auth/logout"}return FB.getLoginStatus(function(b){"connected"==b.status?FB.logout(function(){a()}):(navigator.id.logout(),a())}),!1}navigator.id.watch({loggedInUser:global.auth.email,onlogin:function(){},onlogout:function(){}}),$("#logout").on("click",a),$(".js-user-name").text(global.auth.name),$(".js-user-email").text(global.auth.email),$(document.body).addClass("js-named-user").removeClass("js-anonymous-user")}function d(){function a(){return console.log("performing facebook login"),FB.login(function(a){"connected"==a.status&&$.ajax({type:"POST",url:"/auth/facebook_login",data:{response:a.authResponse},success:function(a){"ok"===a.status?window.location.reload():console.log("facebook Login failure",a)},error:function(a,b,c){console.log("facebook Login failure: "+c)}})},{scope:"email"}),!1}function b(){return console.log("performing persona login"),navigator.id.request(),!1}navigator.id.watch({loggedInUser:null,onlogin:function(a){$.ajax({type:"POST",url:"/auth/persona_login",data:{assertion:a},success:function(a){"ok"===a.status?window.location.reload():console.log("persona Login failure",a)},error:function(a,b,c){console.log("persona Login failure: "+c),navigator.id.logout()}})},onlogout:function(){}}),$("#facebook-login").on("click",a),$("#persona-login").on("click",b),$(document.body).addClass("js-anonymous-user").removeClass("js-named-user")}a(function(){b(function(){global.auth.id?c():d()})})}function Invaders(){}function initInvadersUi(){}function PageNavigation(a){function b(a){return document.dispatchEvent(new CustomEvent("hide-page",{detail:{url:a},bubbles:!0,cancelable:!0}))}function c(a){return document.dispatchEvent(new CustomEvent("reveal-page",{detail:{url:a},bubbles:!0,cancelable:!1}))}function d(a){return document.dispatchEvent(new CustomEvent("page-ready",{detail:{url:a},bubbles:!0,cancelable:!1}))}function e(a,b,c){b.detach(),a.append(c)}function f(a,b,c){function e(){b.off(i),l=!0,m&&h()}function f(){c.off(i),m=!0,l&&h()}function h(){b.detach(),k.detach(),c.detach(),$(document.body).removeClass("animating"),b.removeClass("anim-page-out"),c.removeClass("anim-page-in"),a.append(c),d(j.url)}var i=g.eventName("animation-end"),k=$("<div>").addClass("backstage"),l=!1,m=!1;$(document.body).addClass("animating"),b.addClass("anim-page-out").on(i,e),c.addClass("anim-page-in").on(i,f),k.append(c),a.append(k)}var g=new AnimationSupport;a=!!a&&g.supported;var h=$("#perspective"),i=$("section.page"),j={url:"#null",$page:h.children(),$links:$()},k=null,l={};this.reveal=function(g){if(g=g||k,j.url!=g){var i=l[g];i&&b(j.url)&&(a?f(h,j.$page,i.$page):e(h,j.$page,i.$page),j.$page.removeClass("current"),j.$links.removeClass("current"),i.$page.addClass("current"),i.$links.addClass("current"),j=i,c(j.url),a||d(j.url))}},this.init=function(){var a=this;i.each(function(b,c){var d=$(c),e=d.data("url");if(e){e="#"+e;var f=$("a[href="+e+"]");l[e]={url:e,$page:d,$links:f},f.on("click",function(b){b.isDefaultPrevented()||(b.preventDefault(),j.url!=e&&(window.history.pushState(null,"",e),a.reveal(e)))}),k=k||e}}),i.detach(),window.addEventListener("popstate",function(){a.reveal(window.location.hash)}),a.reveal(window.location.hash)}}function initChromeWebStore(){function a(){b.hide()}var b=$("#cws-install");window.chrome?window.chrome.app.isInstalled?b.hide():b.on("click",function(){try{window.chrome.webstore.install("",a,a)}catch(b){console.log(b)}return!1}):b.hide()}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function initFullScreen(){$(".button.full-screen").on("click",function(){toggleFullScreen()})}function buildTour(a){var b=buildTourPages(".tour-page");return new Tour(b,{onStart:function(){$(document.body).addClass("tour"),a.pause()},onStop:function(){$(document.body).removeClass("tour"),a.unpause()}})}function init(a,b){initAccount(),initCommonUi(),initFullScreen();var c=new Settings(a);b.url&&c.importUrl(b.url);var d=new Game(c);initSettingsUi(d),initProfileUi(d),initGameUi(d),initInvadersUi(d),d.init(function(){new PageNavigation(b.flag("animate")).init(),c.loadLesson(function(a){d.start(a)}),window.game=d});var e=buildTour(d);$(".button.tour").on("click",function(){return e.start(),!1});var f=c.newSettings;document.addEventListener("hide-page",function(a){"#game"==a.detail.url&&e.stop()}),document.addEventListener("page-ready",function(a){"#game"==a.detail.url&&f&&(f=!1,e.start())}),initChromeWebStore()}var _svg={classList:{contains:function(a,b){if(a.classList)return a.classList.contains(b);var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);return-1!=d},add:function(a,b){if(a.classList)a.classList.add(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1==d&&(c.push(b),a.className.baseVal=c.join(" "))}},remove:function(a,b){if(a.classList)a.classList.remove(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className.baseVal=c.join(" "))}},toggle:function(a,b){if(a.classList)a.classList.toggle(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1!=d?c.splice(d,1):c.push(b),a.className.baseVal=c.join(" ")}}}},_dom={el:function(a,b,c){if("object"==typeof a){var d=a;a=d.tagName,b=d.className,c=d.text}var e=document.createElement(a);if(b)if(b instanceof Array)for(var f=0;f<b.length;f++)e.classList.add(b[f]);else e.classList.add(b);return c&&(e.textContent=c),e},empty:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)}};Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.normalRandom=normalRandom,Math.normalRandomInt=function(a,b){return Math.round(Math.normalRandom((a+b)/2,Math.sqrt(b-a)))},Math.linearRegression=function(a){var b,c,d=a.length,e=.5*(d+1),f=0,g=0,h=0;for(b=0;d>b;b++)c=a[b],h+=c,0==b?(f=c,g=c):(f=Math.min(f,c),g=Math.max(g,c));var i=h/d,j=0;for(b=0;d>b;b++)c=a[b]-i,j+=c*c;var k=Math.sqrt(j/(d-1)),l=0,m=0;for(b=0;d>b;b++)c=b-e,l+=c*(a[b]-i),m+=c*c;var n=l/m,o=i-n*e;return{min:f,max:g,mean:i,stdDev:k,alpha:o,beta:n,fn:function(a){return o+a*n}}},Identifier.toSimple=function(a){return a.split("-").map(function(a){return a.toLowerCase()}).join("")},Identifier.toPascalCase=function(a){return a.split("-").map(function(a){return a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}).join("")},Identifier.toCamelCase=function(a){return a.split("-").map(function(a,b){return 0==b?a.toLowerCase():a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}).join("")},Color.prototype.shade=function(a){function b(a,b){return a+=b,a>255?255:0>a?0:a}this.r=b(this.r,a),this.g=b(this.g,a),this.b=b(this.b,a)},Color.prototype.toHex=function(){function a(a){return 16>a?"0"+a.toString(16):a.toString(16)}return"#"+a(this.r)+a(this.g)+a(this.b)},Color.prototype.toRgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},Color.prototype.toString=Color.prototype.toHex,DateX.prototype.toString=function(){return this.year+"-"+this.month+"-"+this.day},function(a){function b(b){return{path:b&&b.path||g.defaults.path,domain:b&&b.domain||g.defaults.domain,expires:b&&b.expires||g.defaults.expires,secure:b&&b.secure!==a?b.secure:g.defaults.secure}}function c(a,b){switch(b=b||new Date,typeof a){case"number":a=new Date(b.getTime()+1e3*a);break;case"string":a=new Date(a)}return a}function d(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),c=c||{};var d=a+"="+b;return c.path&&(d+=";path="+c.path),c.domain&&(d+=";domain="+c.domain),c.expires&&(d+=";expires="+c.expires.toUTCString()),c.secure&&(d+=";secure"),d}function e(b){for(var c={},d=b?b.split("; "):[],e=0;e<d.length;e++){var g=f(d[e]);c[g.key]===a&&(c[g.key]=g.value)}return c}function f(a){var b=a.indexOf("=");return b=-1===b?a.length:b,{key:decodeURIComponent(a.substring(0,b)),value:decodeURIComponent(a.substring(b+1))}}var g=function(a,b,c){return 1===arguments.length?g.get(a):g.set(a,b,c)};g.defaults={path:"/"},g.get=function(a){return e(document.cookie)[a]},g.set=function(e,f,h){return h=b(h),h.expires=c(f===a?-1:h.expires),document.cookie=d(e,f,h),g},g.expire=function(b,c){return g.set(b,a,c)},window.Cookies=g}();var watchProgress=function(){var a=$(document.body);return function(b){a.addClass("loading"),console.log("loading started"),b.addEventListener("load",function(){a.removeClass("loading"),console.log("loading completed")},!1),b.addEventListener("abort",function(){a.removeClass("loading"),console.log("loading aborted")},!1),b.addEventListener("error",function(){console.log("loading failed")},!1),b.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.floor(a.loaded/a.total*100);console.log("loading in progress: "+b+"%")}},!1)}}(),crc32=function(){function a(a){for(var b=-1,d=0;d<a.length;d++)b=b>>>8^c[255&(b^a[d])];return(-1^b)>>>0}function b(){for(var a=[],b=0;256>b;b++){for(var c=b,d=0;8>d;d++)c=1&c?3988292384^c>>>1:c>>>1;a[b]=c}return a}var c=b();return a}(),sha1=function(){function a(a){function d(){return k<a.length?a[k++]:k==a.length?(k++,128):(k++,0)}function e(){if(j-1>l){var b=d(),c=d(),e=d(),f=d(),g=b<<24|c<<16|e<<8|f;return l++,g}return l==j-1?(l++,8*a.length):(k++,0)}for(var f=a.length+1+8,g=f>>6,h=63&f,i=g+(h>0?1:0),j=i<<4,k=0,l=0,m=[1518500249,1859775393,2400959708,3395469782],n=1732584193,o=4023233417,p=2562383102,q=271733878,r=3285377520,s=new Array(80),t=0;i>t;t++){for(var u=0;16>u;u++)s[u]=e();for(var u=16;80>u;u++)s[u]=c(s[u-3]^s[u-8]^s[u-14]^s[u-16],1);for(var v=n,w=o,x=p,y=q,z=r,u=0;80>u;u++){var A=u/20|0,B=c(v,5)+b(A,w,x,y)+z+m[A]+s[u]&4294967295;z=y,y=x,x=c(w,30),w=v,v=B}n=n+v&4294967295,o=o+w&4294967295,p=p+x&4294967295,q=q+y&4294967295,r=r+z&4294967295}var C=new ArrayBuffer(20),D=new DataView(C);return D.setUint32(0,n),D.setUint32(4,o),D.setUint32(8,p),D.setUint32(12,q),D.setUint32(16,r),new Uint8Array(C)}function b(a,b,c,d){switch(a){case 0:return b&c^~b&d;case 1:return b^c^d;case 2:return b&c^b&d^c&d;case 3:return b^c^d}throw new Error}function c(a,b){return a<<b|a>>>32-b}return a}();rc4._concat=function(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a,0),c.set(b,a.length),c},rc4.encode=function(a,b){var c=rc4.iv();return rc4(rc4._concat(c,a),b),rc4._concat(c,b)},rc4.decode=function(a,b){var c=new Uint8Array(b.buffer,0,4),d=new Uint8Array(b.buffer,4);return rc4(rc4._concat(c,a),d),d},rc4.iv=function(){var a=Math.floor(4294967295*Math.random()),b=new Uint8Array(4);return b[0]=a>>>24&255,b[1]=a>>>16&255,b[2]=a>>>8&255,b[3]=a>>>0&255,b},rc4.key=function(a){var b=new Uint8Array(4);return b[0]=a>>>24&255,b[1]=a>>>16&255,b[2]=a>>>8&255,b[3]=a>>>0&255,b};var XTea=function(){function a(b){this.buffer=b,this.position=0,this.length=a.pad(this.buffer.length)}function b(b){if(16!=b.length)throw new Error;this.key=[],this.y=0,this.z=0;var c=new a(b);this.key.push(c.get()),this.key.push(c.get()),this.key.push(c.get()),this.key.push(c.get())}return a.pad=function(a){var b=a>>3,c=7&a;return b+(c>0?1:0)<<3},a.prototype.more=function(){return this.position<this.length},a.prototype.get=function(){return this.readUint32()},a.prototype.put=function(a){this.writeUint32(a)},a.prototype.readUint32=function(){var a=this.readUint8(),b=this.readUint8(),c=this.readUint8(),d=this.readUint8();return a<<24|b<<16|c<<8|d<<0},a.prototype.writeUint32=function(a){this.writeUint8(a>>>24&255),this.writeUint8(a>>>16&255),this.writeUint8(a>>>8&255),this.writeUint8(a>>>0&255)},a.prototype.readUint8=function(){var a;if(this.position<this.buffer.length)a=this.buffer[this.position];else{if(!(this.position<this.length))throw new Error;a=0}return this.position++,a},a.prototype.writeUint8=function(a){if(this.position<this.buffer.length)this.buffer[this.position++]=a;else{if(!(this.position<this.length))throw new Error;this.position++}},b.encrypt=function(a,c){return new b(a).encrypt(c)},b.decrypt=function(a,c){return new b(a).decrypt(c)},b.prototype.encryptBlock=function(){for(var a=0,b=0;32>b;b++)this.y+=(this.z<<4^this.z>>>5)+this.z^a+this.key[3&a],a+=2654435769,this.z+=(this.y<<4^this.y>>>5)+this.y^a+this.key[a>>>11&3]},b.prototype.decryptBlock=function(){for(var a=3337565984,b=0;32>b;b++)this.z-=(this.y<<4^this.y>>>5)+this.y^a+this.key[a>>>11&3],a-=2654435769,this.y-=(this.z<<4^this.z>>>5)+this.z^a+this.key[3&a]},b.prototype.encrypt=function(b){var c=new Uint8Array(a.pad(b.length)+8),d=new a(b),e=new a(c),f=4294967295*Math.random()>>>0,g=4294967295*Math.random()>>>0;for(e.put(f),e.put(g),this.y=0,this.z=0;d.more();)this.y=d.get()^f,this.z=d.get()^g,this.encryptBlock(),e.put(f=this.y),e.put(g=this.z);return c},b.prototype.decrypt=function(b){var c=new Uint8Array(a.pad(b.length)-8),d=new a(b),e=new a(c),f=d.get(),g=d.get();for(this.y=0,this.z=0;d.more();){var h=this.y=d.get(),i=this.z=d.get();this.decryptBlock(),e.put(this.y^f),e.put(this.z^g),f=h,g=i}return c},b}();DropDown.prototype={getValue:function(){return this.val},clear:function(){this.val=null,this.map=Object.create(null),this.$list.empty(),this.$placeholder.text("-")},add:function(a,b){b=b||a;var c=this,d=$('<a href="#"></a>').data("value",b).text(a),e=$("<li></li>").append(d);d.on("click",function(){return c.$el.removeClass("active"),c.select(b),!1}),this.$list.append(e),this.map[b]={text:a,value:b}},select:function(a){var b=this.map[a];b?(this.val=b.value,this.$placeholder.text(b.text),"function"==typeof this.change&&this.change(this,b.value)):(this.val=null,this.$placeholder.text("-"))}},Tour.prototype={create:function(){var a=['<div class="tour-block vertical flex">','<a href="#" class="tour-close"></a>','<div class="tour-content fill article"></div>','<div class="tour-progress-wrapper horizontal flex align-center">','<div class="tour-progress-bar horizontal flex align-center fill"></div>','<a href="#" class="tour-prev"></a>','<a href="#" class="tour-next"></a>',"</div>","</div>"].join(""),b=this,c=$(a);c.find(".tour-close").on("click",function(a){a.preventDefault(),b.stop()}),c.find(".tour-prev").on("click",function(a){a.preventDefault(),b.prev()}),c.find(".tour-next").on("click",function(a){a.preventDefault(),b.next()}),c.hide(),this.$tour=c,this.$progress=c.find(".tour-progress-bar");for(var d=0;d<this.tourPages.length;d++)this.$progress.append($("<span class='pi'></span>"));this.$root.append(this.$tour)},bindEvents:function(){var a=this;$(window).on("resize.Tour",function(b){a.resizeEvent.call(a,b)}),$(window.document).on("keydown.Tour",function(b){a.keyEvent.call(a,b)})},unbindEvents:function(){$(window).off("resize.Tour"),$(window.document).off("keydown.Tour")},resizeEvent:function(){this.run()},keyEvent:function(a){switch(a.keyCode){case VK.ESCAPE:a.preventDefault(),this.stop();break;case VK.LEFT:case VK.UP:a.preventDefault(),this.prev();break;case VK.RIGHT:case VK.DOWN:a.preventDefault(),this.next()}},next:function(){this.isLast()?this.stop():this.canGoNext()&&(this.increaseIndex(),this.run(),this.callCallback())},prev:function(){this.isFirst()||this.canGoPrev()&&(this.decreaseIndex(),this.run(),this.callCallback())},run:function(){var a=this.tourPages[this.pageIndex];this.showCurrentPage(a),this.settings.onChange(this.pageIndex,a)},showCurrentPage:function(a){"string"==typeof a.selection&&(a.selection=$(a.selection)),this.updateTourBlock(a),this.showTourBlock(a)},isFirst:function(){return 0===this.pageIndex},isLast:function(){return this.pageIndex===this.tourPages.length-1},callCallback:function(){var a=this.tourPages[this.pageIndex].callback;"function"==typeof a&&a(this.pageIndex)},canGoPrev:function(){var a=this.tourPages[this.pageIndex],b=a.canGoPrev||this.settings.canGoPrev;return"function"==typeof b&&(b=b.call(a)),b},canGoNext:function(){var a=this.tourPages[this.pageIndex],b=a.canGoNext||this.settings.canGoNext;return"function"==typeof b&&(b=b.call(a)),b},increaseIndex:function(){this.pageIndex<this.tourPages.length-1&&this.pageIndex++},decreaseIndex:function(){this.pageIndex>0&&this.pageIndex--},updateTourBlock:function(a){var b=this.$tour,c=this.$progress,d=a.prevLabel||this.settings.prevLabel,e=a.nextLabel||this.settings.nextLabel,f=a.finishLabel||this.settings.finishLabel,g=c.children();g.removeClass("current"),$(g[this.pageIndex]).addClass("current"),b.find(".tour-content").html(a.content),b.find(".tour-prev").html(d).toggle(!this.isFirst()),b.find(".tour-next").html(this.isLast()?f:e).toggle(!0),b.removeClass("slide s n e w"),b.addClass(a.selection.length?a.position:"slide"),this.setTourBlockPosition(a,"left"),this.setTourBlockPosition(a,"top")},setTourBlockPosition:function(a,b){var c=this.$tour,d=a.selection,e=d.offset(),f=$(window).width(),g=$(window).height(),h=d.outerWidth(),i=d.outerHeight(),j=c.outerWidth(),k=c.outerHeight(),l=10,m=10,n=0,o=0;switch(a.position){case"e":n=e.left+h+m,o=e.top-(k-i)/2;break;case"s":n=e.left+(h-j)/2,o=e.top+i+l;break;case"w":n=e.left-(m+j),o=e.top-(k-i)/2;break;case"n":n=e.left+(h-j)/2,o=e.top-l-k;break;default:n=(f-j)/2,o=(g-k)/2}c.css("left"===b?{left:n}:{top:o})},showTourBlock:function(){this.$tour.show();var a=$(window).height(),b=$(window).scrollTop(),c=this.$tour.offset().top,d=100;b+a>c&&c>=b||this.$root.animate({scrollTop:c-d},"slow")},hideTourBlock:function(){var a=this.$tour;a.fadeOut("slow",function(){a.removeClass("slide s n e w"),a.find(".tour-content").empty()})},start:function(){this.settings.onStart(),this.bindEvents(),this.run()},stop:function(){this.unbindEvents(),this.hideTourBlock(),this.pageIndex=this.settings.pageIndex,this.settings.onStop()}};var Unicode=Object.freeze({MIN_HIGH_SURROGATE:55296,MAX_HIGH_SURROGATE:56319,MIN_LOW_SURROGATE:56320,MAX_LOW_SURROGATE:57343,MIN_SURROGATE:this.MIN_HIGH_SURROGATE,MAX_SURROGATE:this.MAX_LOW_SURROGATE,MIN_SUPPLEMENTARY_CODE_POINT:65536,MIN_CODE_POINT:0,MAX_CODE_POINT:1114111,COMBINING_DIACRITICAL_MARK_MIN:768,COMBINING_DIACRITICAL_MARK_MAX:879,DIACRITIC_ACUTE:180,COMBINING_DIACRITIC_ACUTE:769,DIACRITIC_DOUBLE_ACUTE:733,COMBINING_DIACRITIC_DOUBLE_ACUTE:779,DIACRITIC_BREVE:728,COMBINING_DIACRITIC_BREVE:774,DIACRITIC_CARON:711,COMBINING_DIACRITIC_CARON:780,DIACRITIC_CEDILLA:184,COMBINING_DIACRITIC_CEDILLA:807,DIACRITIC_CIRCUMFLEX:710,COMBINING_DIACRITIC_CIRCUMFLEX:770,DIACRITIC_DIAERESIS:168,COMBINING_DIACRITIC_DIAERESIS:776,DIACRITIC_GRAVE:96,COMBINING_DIACRITIC_GRAVE:768,DIACRITIC_TILDE:126,COMBINING_DIACRITIC_TILDE:771,COMBINER_MAP:[],isValidCodePoint:function(a){return a>=this.MIN_CODE_POINT&&a<=this.MAX_CODE_POINT},isBmpCodePoint:function(a){return a>>>16==0},isSupplementaryCodePoint:function(a){return a>=this.MIN_SUPPLEMENTARY_CODE_POINT&&a<=this.MAX_CODE_POINT},isHighSurrogate:function(a){return a>=this.MIN_HIGH_SURROGATE&&a<=this.MAX_HIGH_SURROGATE},isLowSurrogate:function(a){return a>=this.MIN_LOW_SURROGATE&&a<=this.MAX_LOW_SURROGATE},isSurrogate:function(a){return a>=this.MIN_SURROGATE&&a<=this.MAX_SURROGATE},isSurrogatePair:function(a,b){return this.isHighSurrogate(a)&&this.isLowSurrogate(b)},isCombining:function(a){return this.isCombiningDiacriticalMark(a)},isCombiningDiacriticalMark:function(a){return a>=this.COMBINING_DIACRITICAL_MARK_MIN&&a<=this.COMBINING_DIACRITICAL_MARK_MAX},combine:function(a,b){var c=this.COMBINER_MAP[b];return c?c.combine(a):a},uncombine:function(a){for(var b=0;b<this.COMBINER_MAP.length;b++){var c=this.COMBINER_MAP[b];if(c){var d=c.uncombine(a);if(d!=a)return d}}return a},combinerImage:function(a){var b=this.COMBINER_MAP[a];return b?b.image:a},isWs:function(a){return"string"==typeof a&&(a=a.charCodeAt(0)),32==a||9==a||10==a||13==a||160==a||8192==a||8193==a||8194==a||8195==a||8232==a||8233==a},isNl:function(a){return"string"==typeof a&&(a=a.charCodeAt(0)),10==a||13==a||8232==a||8233==a}});UnicodeCombiner.prototype.combine=function(a){for(var b=this.from,c=this.to,d=0;d<b.length;d++)if(b.charCodeAt(d)==a)return c.charCodeAt(d);
return a},UnicodeCombiner.prototype.uncombine=function(a){for(var b=this.from,c=this.to,d=0;d<c.length;d++)if(c.charCodeAt(d)==a)return b.charCodeAt(d);return a},UnicodeCombiner.initCombinerMap=function(a){function b(a,b,c,d,e){a[b]=new UnicodeCombiner(b,c,d,e)}a.length>0||(b(a,Unicode.COMBINING_DIACRITIC_ACUTE,Unicode.DIACRITIC_ACUTE,"AaCcEeGgIiKkLlMmNnOoPpRrSsUuWwYyZz","ÁáĆćÉéǴǵÍíḰḱĹĺḾḿŃńÓóṔṕŔŕŚśÚúẂẃÝýŹź"),b(a,Unicode.COMBINING_DIACRITIC_DOUBLE_ACUTE,Unicode.DIACRITIC_DOUBLE_ACUTE,"OoUu","ŐőŰű"),b(a,Unicode.COMBINING_DIACRITIC_CEDILLA,Unicode.DIACRITIC_CEDILLA,"CcDdEeGgHhKkLlNnRrSsTt","ÇçḐḑȨȩĢģḨḩĶķĻļŅņŖŗŞşŢţ"),b(a,Unicode.COMBINING_DIACRITIC_CIRCUMFLEX,Unicode.DIACRITIC_CIRCUMFLEX,"AaCcEeGgHhIiJjOoSsUuWwYyZz","ÂâĈĉÊêĜĝĤĥÎîĴĵÔôŜŝÛûŴŵŶŷẐẑ"),b(a,Unicode.COMBINING_DIACRITIC_DIAERESIS,Unicode.DIACRITIC_DIAERESIS,"AaEeHhIiOotUuWwXxYy","ÄäËëḦḧÏïÖöẗÜüẄẅẌẍŸÿ"),b(a,Unicode.COMBINING_DIACRITIC_GRAVE,Unicode.DIACRITIC_GRAVE,"AaEeIiNnOoUuWwYy","ÀàÈèÌìǸǹÒòÙùẀẁỲỳ"),b(a,Unicode.COMBINING_DIACRITIC_TILDE,Unicode.DIACRITIC_TILDE,"AaEeIiNnOoUuVvYy","ÃãẼẽĨĩÑñÕõŨũṼṽỸỹ"))},UnicodeCombiner.initCombinerMap(Unicode.COMBINER_MAP),function(){function a(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(-1!=b.indexOf(d))throw new Error("duplicate char code "+d);b.push(d)}return b}sanitizeText.NUMBER=a("0123456789"),sanitizeText.GRAPHICS=a("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~")}(),TextParser.SPLIT=">>>",TextParser.prototype.reset=function(){this.offset=0,this.next=null},TextParser.prototype.nextWord=function(a){for(a=void 0!==a?a:15;;){var b=this.next,c=this.nextWordImpl(a);if(null==c){if(null==b)return"empty";this.reset(),b!=TextParser.SPLIT&&(this.next=TextParser.SPLIT)}else{if(null==b&&c==TextParser.SPLIT)continue;if(null==b&&"\n"==c)continue;if(b==TextParser.SPLIT&&c==TextParser.SPLIT){this.next=TextParser.SPLIT;continue}if(b==TextParser.SPLIT&&"\n"==c){this.next=TextParser.SPLIT;continue}if("\n"==b&&c==TextParser.SPLIT){this.next=TextParser.SPLIT;continue}if("\n"==b&&"\n"==c){this.next="\n";continue}this.next=c}if(null!=b)return b}},TextParser.prototype.nextWordImpl=function(a){if(this.skipWs())return"\n";if(this.offset==this.text.length)return null;for(var b=this.offset;this.offset<this.text.length&&this.offset-b<a;){var c=this.text.charCodeAt(this.offset);if(Unicode.isWs(c))break;this.offset++}var d=this.text.substring(b,this.offset);return d==TextParser.SPLIT&&this.skipWs(),d},TextParser.prototype.skipWs=function(){for(var a=!1;this.offset<this.text.length;){var b=this.text.charCodeAt(this.offset);if(!Unicode.isWs(b))break;Unicode.isNl(b)&&(a=!0),this.offset++}return a},Censor.prototype.censor=function(a){for(var b=a,c=0;c<this.config.set.length;c++){var d=this.config.set[c];d.lastIndex=0,b=b.replace(d,"?")}return b};var CENSOR_EN=new Censor({set:["acrotomophilia","anal","anilingus","anus","arsehole","ass","asshole","assmunch","autoerotic","babeland","baby batter","ball gag","ball gravy","ball kicking","ball licking","ball sack","ball sucking","bangbros","bareback","barely legal","barenaked","bastardo","bastinado","bbw","bdsm","beaver cleaver","beaver lips","bestiality","big breasts","big knockers","big tits","bimbos","birdlock","bitch","blow j","blue waffle","blumpkin","bollocks","bondage","boner","boob","boobs","booty call","brown showers","brunette action","bukkake","bulldyke","bullet vibe","bung hole","bunghole","busty","butt","buttcheeks","butthole","camel toe","camgirl","camslut","camwhore","carpet muncher","carpetmuncher","chocolate rosebuds","circlejerk","clit","clitoris","clusterfuck","cock","cocks","coprolagnia","coprophilia","cornhole","cum","cumming","cunnilingus","cunt","darkie","date rape","daterape","deep throat","deepthroat","dick","dildo","dirty pillows","dirty sanchez","dog style","doggie style","doggiestyle","doggy style","doggystyle","dolcett","dominatrix","dommes","donkey punch","double dong","double penetration","dp action","eat my ass","ecchi","ejaculation","erotic","erotism","escort","ethical slut","eunuch","faggot","fecal","felch","fellatio","feltch","female squirting","femdom","figging","fingering","fisting","foot fetish","footjob","frotting","fuck","fucked","fucker","fucking","fuck buttons","fudge packer","fudgepacker","futanari","g-spot","gang bang","gay sex","genitals","giant cock","goatcx","goatse","gokkun","golden shower","goo girl","goodpoop","goregasm","grope","group sex","guro","hand job","handjob","hard core","hardcore","hentai","homoerotic","honkey","hooker","hot chick","how to kill","how to murder","huge fat","humping","incest","intercourse","jack off","jail bait","jailbait","jerk off","jigaboo","jiggaboo","jiggerboo","jizz","juggs","kike","kinbaku","kinkster","kinky","knobbing","leather restraint","leather straight jacket","lemon party","lolita","lovemaking","make me come","male squirting","masturbate","menage a trois","milf","mother fucker","motherfucker","mound of venus","mr hands","muff diver","muffdiving","nambla","nawashi","negro","neonazi","nig nog","nigga","nigger","nimphomania","nipple","nipples","nsfw images","nude","nudity","nympho","nymphomania","octopussy","omorashi","one cup two girls","one guy one jar","orgasm","orgy","paedophile","panties","panty","pedobear","pedophile","pegging","penis","phone sex","piece of shit","piss pig","pissing","pisspig","playboy","pleasure chest","pole smoker","ponyplay","poof","poop chute","poopchute","porn","porno","pornography","pubes","pussy","queaf","raghead","raging boner","rape","raping","rapist","rectum","reverse cowgirl","rimjob","rimming","rosy palm","rusty trombone","sadism","scat","schlong","scissoring","semen","sex","sexo","sexy","shaved beaver","shaved pussy","shemale","shibari","shit","shota","shrimping","slanteye","slut","smut","snatch","snowballing","sodomize","sodomy","spic","spooge","spread legs","strap on","strapon","strappado","strip club","style doggy","suck","sucks","suicide girls","sultry women","swastika","swinger","tainted love","taste my","tea bagging","threesome","throating","tied up","tight white","tit","tits","titties","titty","tongue in a","topless","tosser","towelhead","tranny","tribadism","tub girl","tubgirl","tushy","twat","twink","twinkie","two girls one cup","upskirt","urethra play","urophilia","vagina","venus mound","vibrator","violet blue","violet wand","vorarephilia","voyeur","vulva","wank","wet dream","wetback","white power","women rapping","wrapping men","wrinkled starfish","yaoi","yellow showers","yiffy","zoophilia"]}),CENSOR_EMPTY=new Censor({set:[]}),CENSOR={en:CENSOR_EN,de:CENSOR_EMPTY,fr:CENSOR_EMPTY,it:CENSOR_EMPTY,es:CENSOR_EMPTY,pt:CENSOR_EMPTY,ru:CENSOR_EMPTY,get:function(a){if("string"==typeof a)return CENSOR[a];if("object"==typeof a)return CENSOR[a.code];throw new Error}};Generator.prototype.nextFragment=function(){throw new Error},DummyGenerator.prototype=new Generator,DummyGenerator.prototype.nextFragment=function(){return this.text},StaticTextGenerator.prototype=new Generator,StaticTextGenerator.prototype.nextWord=function(){return this.word=this.parser.nextWord(this.wordLimit)},StaticTextGenerator.prototype.nextFragment=function(){for(var a="",b=0,c=" ";this.word!=TextParser.SPLIT&&5>b;){if(""==a)"\n"!=this.word&&(a=this.word);else if("\n"==this.word)c="\n",b++;else{if(a.length+this.word.length+1>this.fragmentLimit)break;a=a+c+this.word,c=" "}this.nextWord()}for(;this.word==TextParser.SPLIT;)this.nextWord();return a},RandomWordsGenerator.prototype=new Generator,RandomWordsGenerator.prototype.nextWord=function(){throw new Error},RandomWordsGenerator.prototype.nextFragment=function(){throw new Error},RandomWordsGenerator.prototype.getBoostFactor=function(a){for(var b=0,c=null,d=0;d<this.charSet.length;d++){var e=this.charSet[d];e.charCode==a&&(c=e.f),b=Math.max(b,e.f)}if(null==c)throw new Error;return b/c},LanguageModel.cache={},LanguageModel.get=function(a){var b=LanguageModel.cache[a];return b||(LanguageModel.cache[a]=b=new LanguageModel(a)),b};var LANGUAGE={en:new Language("en","English"),de:new Language("de","German"),fr:new Language("fr","French"),it:new Language("it","Italian"),es:new Language("es","Spanish"),pt:new Language("pt","Portuguese"),ru:new Language("ru","Russian")},VK_Name=[],VK=Object.freeze({BACK_SPACE:8,TAB:9,CLEAR:12,RETURN:13,SHIFT:16,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,N0:48,N1:49,N2:50,N3:51,N4:52,N5:53,N6:54,N7:55,N8:56,N9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SEPARATOR:108,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,QUOTE:222,META:224,OEM_102:226,ALT_SEMICOLON:59,ALT_EQUALS:61,ALT_HYPHEN_MINUS:173,normalizeKeyCode:function(a){switch(a){case VK.ALT_SEMICOLON:return VK.SEMICOLON;case VK.ALT_EQUALS:return VK.EQUALS;case VK.ALT_HYPHEN_MINUS:return VK.DASH}return a},name:function(a){if(0==VK_Name.length)for(var b in this)VK_Name[this[b]]=b;var c=VK_Name[a];if(void 0===c)throw new Error("undefined key code: "+a);return c},isSpecialKey:function(a){return a.ctrlKey||a.metaKey||a.keyCode==VK.SHIFT||a.keyCode==VK.CONTROL||a.keyCode==VK.ALT||a.keyCode==VK.META||a.keyCode==VK.CAPS_LOCK||a.keyCode==VK.CONTEXT_MENU||a.keyCode==VK.F1||a.keyCode==VK.F2||a.keyCode==VK.F3||a.keyCode==VK.F4||a.keyCode==VK.F5||a.keyCode==VK.F6||a.keyCode==VK.F7||a.keyCode==VK.F8||a.keyCode==VK.F9||a.keyCode==VK.F10||a.keyCode==VK.F11||a.keyCode==VK.F12||a.keyCode==VK.F13||a.keyCode==VK.F14||a.keyCode==VK.F15||a.keyCode==VK.F16||a.keyCode==VK.INSERT||a.keyCode==VK.HOME||a.keyCode==VK.PAGE_UP||a.keyCode==VK.DELETE||a.keyCode==VK.END||a.keyCode==VK.PAGE_DOWN||a.keyCode==VK.UP||a.keyCode==VK.LEFT||a.keyCode==VK.DOWN||a.keyCode==VK.RIGHT||a.keyCode==VK.NUM_LOCK||a.keyCode==VK.SCROLL_LOCK}});CustomKeyboardEvent.prototype={preventDefault:function(){this.ev.preventDefault()},stopPropagation:function(){this.ev.stopPropagation()}},LayoutKey.prototype.charCode=function(a,b){function c(a,b,c,d){return d>0?d:c>0?c:b>0?b:a}return b?a?c(this.primary,this.primaryShift,this.secondary,this.secondaryShift):c(this.primary,this.secondary,0,0):a?c(this.primary,this.primaryShift,0,9):this.primary},LayoutKey.std=function(a,b,c,d,e,f){return new LayoutKey(a,a,b,c,d,e,f)},LayoutKey.ext=function(a,b,c,d,e,f,g){return new LayoutKey(a,b,c,d,e,f,g)},KeyCombo.prototype.applyDeadKey=function(a,b,c,d){return new KeyCombo(a,this.key,this.shift,this.alt,b,c,d)},Layout.prototype.configure=function(a){this.config.emulate=a.emulateLayout},Layout.prototype.createEventHandler=function(a){return new KeyboardEventHandler(this,a)},Layout.prototype.keyCombo=function(a){return this.comboMap[a]},Layout.prototype.hasCharacter=function(a){return null!=this.keyCombo(a)},Layout.prototype.complexity=function(a){for(var b=0,c=[],d=0;d<a.length;d++){var e=a.charCodeAt(d);if(-1==c.indexOf(e)){c.push(e);var f=this.keyCombo(e);f?b+=f.complexity:b++}}return b},Layout.prototype.filterCharSet=function(a){for(var b=new CharSet,c=0;c<a.length;c++){var d=a[c],e=this.keyCombo(d.charCode);e&&!e.deadKey&&b.push(d)}return b},Layout.prototype.filterCharacters=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c),e=this.keyCombo(d);e&&!e.deadKey&&b.push(d)}return b},Layout.prototype.getKeyPosition=function(a){var b=(KeyboardEvent.DOM_KEY_LOCATION_LEFT||1,KeyboardEvent.DOM_KEY_LOCATION_RIGHT||2),c=KeyboardEvent.DOM_KEY_LOCATION_NUMPAD||3;if(a.location==c)switch(a.keyCode){case VK.BACK_SPACE:return"numpad-backspace";case VK.RETURN:return"numpad-enter";case VK.INSERT:return VK.NUMPAD0;case VK.DELETE:return VK.DECIMAL;case VK.END:return VK.NUMPAD1;case VK.DOWN:return VK.NUMPAD2;case VK.PAGE_DOWN:return VK.NUMPAD3;case VK.LEFT:return VK.NUMPAD4;case VK.CLEAR:return VK.NUMPAD5;case VK.RIGHT:return VK.NUMPAD6;case VK.HOME:return VK.NUMPAD7;case VK.UP:return VK.NUMPAD8;case VK.PAGE_UP:return VK.NUMPAD9}switch(a.keyCode){case VK.SHIFT:return a.location==b?"rshift":"lshift";case VK.CONTROL:return a.location==b?"rctrl":"lctrl";case VK.ALT:return a.location==b?"ralt":"Lalt";case VK.BACK_SPACE:return VK.BACK_SPACE;case VK.TAB:return VK.TAB;case VK.RETURN:return VK.RETURN;case VK.CAPS_LOCK:return VK.CAPS_LOCK;case VK.SPACE:return VK.SPACE}if(this.config.emulate)return a.keyCode;var d=this.byKeyCode[a.keyCode];return d?d.position:a.keyCode},KeyboardEventHandler.prototype.keyDown=function(a){if(!(a.ctrlKey||a.altKey||a.metaKey)){switch(a.keyCode){case VK.BACK_SPACE:return this.sink(8),!0;case VK.TAB:return this.sink(9),!0;case VK.RETURN:return this.sink(10),!0;case VK.SPACE:return this.sink(32),!0;case VK.MULTIPLY:return this.sink(42),!0;case VK.ADD:return this.sink(43),!0;case VK.SUBTRACT:return this.sink(45),!0;case VK.DECIMAL:return this.sink(46),!0;case VK.DIVIDE:return this.sink(47),!0;case VK.NUMPAD0:return this.sink(48),!0;case VK.NUMPAD1:return this.sink(49),!0;case VK.NUMPAD2:return this.sink(50),!0;case VK.NUMPAD3:return this.sink(51),!0;case VK.NUMPAD4:return this.sink(52),!0;case VK.NUMPAD5:return this.sink(53),!0;case VK.NUMPAD6:return this.sink(54),!0;case VK.NUMPAD7:return this.sink(55),!0;case VK.NUMPAD8:return this.sink(56),!0;case VK.NUMPAD9:return this.sink(57),!0}var b;return b=this.layout.config.emulate?this.layout.byPosition[a.keyCode]:this.layout.byKeyCode[a.keyCode],b?a.shiftKey?(this.sink(b.primaryShift),!0):(this.sink(b.primary),!0):!1}},KeyboardEventHandler.prototype.keyUp=function(){},KeyboardShakeAnimation.prototype={init:function(){for(var a in this.keyMap)this.keyMap[a].initShake()},step:function(a){for(var b in this.keyMap)this.keyMap[b].stepShake(a)},reset:function(){for(var a in this.keyMap)this.keyMap[a].resetShake()}};var KeyboardUi=function(){function a(a){return"string"==typeof a&&(a=document.getElementById(a)),a=a.cloneNode(!0),a.setAttribute("id",SVG.eid("x")),a}function b(){}function c(a){return Unicode.isCombining(a)&&(a=Unicode.combinerImage(a)),String.fromCharCode(a)}return SVG.Key=function(b,c){SVG.Parent.call(this,a(c.ref)),this._layout=b,this._pos=c,this._key=this._layout.byPosition[this._pos.id],this.init(),this.move(this._pos.x,this._pos.y),this._pos.c&&_svg.classList.add(this.node,this._pos.c)},SVG.Key.prototype=new SVG.Parent,SVG.Key.prototype.init=function(){var a=this.node.querySelector(".symbol"),b=this.node.querySelector(".symbol-primary-shift"),d=this.node.querySelector(".symbol-primary"),e=this.node.querySelector(".symbol-secondary-shift"),f=this.node.querySelector(".symbol-secondary");this._key&&(this._key.alpha?(a.textContent=c(this._key.primary).toUpperCase(),this.node.removeChild(b),this.node.removeChild(d),this.node.removeChild(e),this.node.removeChild(f)):(this.node.removeChild(a),this._key.primaryShift?b.textContent=c(this._key.primaryShift):this.node.removeChild(b),this._key.primary?d.textContent=c(this._key.primary):this.node.removeChild(d),this._key.secondaryShift?e.textContent=c(this._key.secondaryShift):this.node.removeChild(e),this._key.secondary?f.textContent=c(this._key.secondary):this.node.removeChild(f)))},SVG.Key.prototype.state=function(a){a?_svg.classList.add(this.node,"down"):_svg.classList.remove(this.node,"down")},SVG.Key.prototype.initShake=function(){this._anim={x:this._pos.x,y:this._pos.y,rx:Math.randomInt(5,20)*(Math.randomInt(0,1)>0?1:-1),ry:Math.randomInt(5,20)*(Math.randomInt(0,1)>0?1:-1),sx:Math.randomInt(80,200),sy:Math.randomInt(80,200)}},SVG.Key.prototype.stepShake=function(a){this.move(this._anim.x+Math.sin(a/this._anim.sx)*this._anim.rx,this._anim.y+Math.cos(a/this._anim.sy)*this._anim.ry)},SVG.Key.prototype.resetShake=function(){this._anim=null,this.move(this._pos.x,this._pos.y)},b.prototype={init:function(a,b,c){function d(a,c,d){for(var e=0;e<d.length;e++){var f=d[e],g=new SVG.Key(b,f);a.add(g),c[f.id]=g}}this.layout=b,this.keyMap=[];var e=a.instance||new SVG.Container(a);e.clear(),d(e,this.keyMap,this.layout.geometry),c&&(d(e,this.keyMap,LAYOUT_GEOMETRY.CURSOR),d(e,this.keyMap,LAYOUT_GEOMETRY.NUMPAD))},getKeyPoint:function(a){var b=this.layout.geometryMap[a];if(b){var c=this.keyMap[b.id].bbox(),d=b.x+c.width/2,e=b.y+c.height/2;return{cx:d,cy:e}}return null},keyDown:function(a){var b=this.layout.getKeyPosition(a),c=this.keyMap[b];c&&c.state(!0),this.unpressSpecial(a)},keyUp:function(a){var b=this.layout.getKeyPosition(a),c=this.keyMap[b];c&&c.state(!1),this.unpressSpecial(a)},unpressSpecial:function(a){a.ctrlKey||(this.keyMap.lctrl.state(!1),this.keyMap.rctrl.state(!1)),a.altKey||(this.keyMap.lalt.state(!1),this.keyMap.ralt.state(!1)),a.shiftKey||(this.keyMap.lshift.state(!1),this.keyMap.rshift.state(!1))},highlight:function(a,b){if(_dom.empty(a),b){var c=this.layout.geometryMap;switch(b){case 8:return void this._highlight(a,c[VK.TAB]);case 10:return void this._highlight(a,c[VK.RETURN]);case 32:return void this._highlight(a,c[VK.SPACE])}var d=this.layout.keyCombo(b);d&&(this._highlight(a,c[d.key.position]),d.shift&&(this._highlight(a,c.lshift),this._highlight(a,c.rshift)),d.alt&&this._highlight(a,c.ralt),d.deadKey&&(this._highlight(a,c[d.deadKey.position]),d.deadShift&&!d.shift&&(this._highlight(a,c.lshift),this._highlight(a,c.rshift)),d.deadAlt&&!d.alt&&this._highlight(a,c.ralt)))}},_highlight:function(b,c){var d=this.keyMap[c.id],e=d.bbox(),f=(Math.min(e.width,e.height)/2+10,c.x+e.width/2),g=c.y+e.height/2,h=a("key-hl");h.setAttribute("x",f),h.setAttribute("y",g),b.appendChild(h)},reset:function(){for(var a in this.keyMap)this.keyMap[a].state(!1)},animation:null,createShakeAnimation:function(){return new KeyboardShakeAnimation(this.keyMap)}},b}(),LAYOUT_KEY_SET=function(){var a=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,96,126,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,64,null,null),LayoutKey.std(VK.N3,!1,51,35,null,null),LayoutKey.std(VK.N4,!1,52,36,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,94,null,null),LayoutKey.std(VK.N7,!1,55,38,null,null),LayoutKey.std(VK.N8,!1,56,42,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,null,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,null,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,91,123,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!1,93,125,null,null),LayoutKey.std(VK.BACK_SLASH,!1,92,124,null,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.std(VK.SEMICOLON,!1,59,58,null,null),LayoutKey.std(VK.QUOTE,!1,39,34,null,null),LayoutKey.std(VK.Z,!0,122,90,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,60,null,null),LayoutKey.std(VK.PERIOD,!1,46,62,null,null),LayoutKey.std(VK.SLASH,!1,47,63,null,null)]),b=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,96,172,166,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,34,null,null),LayoutKey.std(VK.N3,!1,51,163,null,null),LayoutKey.std(VK.N4,!1,52,36,8364,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,94,null,null),LayoutKey.std(VK.N7,!1,55,38,null,null),LayoutKey.std(VK.N8,!1,56,42,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,null,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,201,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,218,null),LayoutKey.std(VK.I,!0,105,73,205,null),LayoutKey.std(VK.O,!0,111,79,211,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,91,123,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!1,93,125,null,null),LayoutKey.std(VK.BACK_SLASH,!1,35,126,null,null),LayoutKey.std(VK.A,!0,97,65,193,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.std(VK.SEMICOLON,!1,59,58,null,null),LayoutKey.std(VK.QUOTE,!1,39,64,null,null),LayoutKey.std(VK.Z,!0,122,90,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,60,null,null),LayoutKey.std(VK.PERIOD,!1,46,62,null,null),LayoutKey.std(VK.SLASH,!1,47,63,null,null),LayoutKey.std(VK.OEM_102,!1,92,124,null,null)]),c=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,96,126,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,64,null,null),LayoutKey.std(VK.N3,!1,51,163,null,null),LayoutKey.std(VK.N4,!1,52,36,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,94,null,null),LayoutKey.std(VK.N7,!1,55,38,null,null),LayoutKey.std(VK.N8,!1,56,42,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,null,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,201,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,91,123,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!1,93,125,null,null),LayoutKey.std(VK.BACK_SLASH,!1,92,124,null,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.std(VK.SEMICOLON,!1,59,58,null,null),LayoutKey.std(VK.QUOTE,!1,39,34,null,null),LayoutKey.std(VK.Z,!0,122,90,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,60,null,null),LayoutKey.std(VK.PERIOD,!1,46,62,null,null),LayoutKey.std(VK.SLASH,!1,47,63,null,null)]),d=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,"`","~",null,null),LayoutKey.std(VK.N1,!1,"1","!",null,null),LayoutKey.std(VK.N2,!1,"2","@",null,null),LayoutKey.std(VK.N3,!1,"3","#",null,null),LayoutKey.std(VK.N4,!1,"4","$",null,null),LayoutKey.std(VK.N5,!1,"5","%",null,null),LayoutKey.std(VK.N6,!1,"6","^",null,null),LayoutKey.std(VK.N7,!1,"7","&",null,null),LayoutKey.std(VK.N8,!1,"8","*",null,null),LayoutKey.std(VK.N9,!1,"9","(",null,null),LayoutKey.std(VK.N0,!1,"0",")",null,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,"[","{",null,null),LayoutKey.ext(VK.EQUALS,VK.CLOSE_BRACKET,!1,"]","}",null,null),LayoutKey.ext(VK.Q,VK.QUOTE,!1,"'",'"',null,null),LayoutKey.ext(VK.W,VK.COMMA,!1,",","<",null,null),LayoutKey.ext(VK.E,VK.PERIOD,!1,".",">",null,null),LayoutKey.ext(VK.R,VK.P,!0,"p","P",null,null),LayoutKey.ext(VK.T,VK.Y,!0,"y","Y",null,null),LayoutKey.ext(VK.Y,VK.F,!0,"f","F",null,null),LayoutKey.ext(VK.U,VK.G,!0,"g","G",null,null),LayoutKey.ext(VK.I,VK.C,!0,"c","C",null,null),LayoutKey.ext(VK.O,VK.R,!0,"r","R",null,null),LayoutKey.ext(VK.P,VK.L,!0,"l","L",null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.SLASH,!1,"/","?",null,null),LayoutKey.ext(VK.CLOSE_BRACKET,VK.EQUALS,!1,"=","+",null,null),LayoutKey.std(VK.BACK_SLASH,!1,"\\","|",null,null),LayoutKey.std(VK.A,!0,"a","A",null,null),LayoutKey.ext(VK.S,VK.O,!0,"o","O",null,null),LayoutKey.ext(VK.D,VK.E,!0,"e","E",null,null),LayoutKey.ext(VK.F,VK.U,!0,"u","U",null,null),LayoutKey.ext(VK.G,VK.I,!0,"i","I",null,null),LayoutKey.ext(VK.H,VK.D,!0,"d","D",null,null),LayoutKey.ext(VK.J,VK.H,!0,"h","H",null,null),LayoutKey.ext(VK.K,VK.T,!0,"t","T",null,null),LayoutKey.ext(VK.L,VK.N,!0,"n","N",null,null),LayoutKey.ext(VK.SEMICOLON,VK.S,!0,"s","S",null,null),LayoutKey.ext(VK.QUOTE,VK.DASH,!1,"-","_",null,null),LayoutKey.ext(VK.Z,VK.SEMICOLON,!1,";",":",null,null),LayoutKey.ext(VK.X,VK.Q,!0,"q","Q",null,null),LayoutKey.ext(VK.C,VK.J,!0,"j","J",null,null),LayoutKey.ext(VK.V,VK.K,!0,"k","K",null,null),LayoutKey.ext(VK.B,VK.X,!0,"x","X",null,null),LayoutKey.ext(VK.N,VK.B,!0,"b","B",null,null),LayoutKey.std(VK.M,!0,"m","M",null,null),LayoutKey.ext(VK.COMMA,VK.W,!0,"w","W",null,null),LayoutKey.ext(VK.PERIOD,VK.V,!0,"v","V",null,null),LayoutKey.ext(VK.SLASH,VK.Z,!0,"z","Z",null,null)]),e=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,"`","~",null,null),LayoutKey.std(VK.N1,!1,"1","!",null,null),LayoutKey.std(VK.N2,!1,"2","@",null,null),LayoutKey.std(VK.N3,!1,"3","#",null,null),LayoutKey.std(VK.N4,!1,"4","$",null,null),LayoutKey.std(VK.N5,!1,"5","%",null,null),LayoutKey.std(VK.N6,!1,"6","^",null,null),LayoutKey.std(VK.N7,!1,"7","&",null,null),LayoutKey.std(VK.N8,!1,"8","*",null,null),LayoutKey.std(VK.N9,!1,"9","(",null,null),LayoutKey.std(VK.N0,!1,"0",")",null,null),LayoutKey.std(VK.DASH,!1,"-","_",null,null),LayoutKey.std(VK.EQUALS,!1,"=","+",null,null),LayoutKey.std(VK.Q,!0,"q","Q",null,null),LayoutKey.std(VK.W,!0,"w","W",null,null),LayoutKey.ext(VK.E,VK.F,!0,"f","F",null,null),LayoutKey.ext(VK.R,VK.P,!0,"p","P",null,null),LayoutKey.ext(VK.T,VK.G,!0,"g","G",null,null),LayoutKey.ext(VK.Y,VK.J,!0,"j","J",null,null),LayoutKey.ext(VK.U,VK.L,!0,"l","L",null,null),LayoutKey.ext(VK.I,VK.U,!0,"u","U",null,null),LayoutKey.ext(VK.O,VK.Y,!0,"y","Y",null,null),LayoutKey.ext(VK.P,VK.SEMICOLON,!1,";",":",null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,"[","{",null,null),LayoutKey.std(VK.CLOSE_BRACKET,!1,"]","}",null,null),LayoutKey.std(VK.BACK_SLASH,!1,"\\","|",null,null),LayoutKey.std(VK.A,!0,"a","A",null,null),LayoutKey.ext(VK.S,VK.R,!0,"r","R",null,null),LayoutKey.ext(VK.D,VK.S,!0,"s","S",null,null),LayoutKey.ext(VK.F,VK.T,!0,"t","T",null,null),LayoutKey.ext(VK.G,VK.D,!0,"d","D",null,null),LayoutKey.std(VK.H,!0,"h","H",null,null),LayoutKey.ext(VK.J,VK.N,!0,"n","N",null,null),LayoutKey.ext(VK.K,VK.E,!0,"e","E",null,null),LayoutKey.ext(VK.L,VK.I,!0,"i","I",null,null),LayoutKey.ext(VK.SEMICOLON,VK.O,!0,"o","O",null,null),LayoutKey.std(VK.QUOTE,!1,"'",'"',null,null),LayoutKey.std(VK.Z,!0,"z","Z",null,null),LayoutKey.std(VK.X,!0,"x","X",null,null),LayoutKey.std(VK.C,!0,"c","C",null,null),LayoutKey.std(VK.V,!0,"v","V",null,null),LayoutKey.std(VK.B,!0,"b","B",null,null),LayoutKey.ext(VK.N,VK.K,!0,"k","K",null,null),LayoutKey.std(VK.M,!0,"m","M",null,null),LayoutKey.std(VK.COMMA,!1,",","<",null,null),LayoutKey.std(VK.PERIOD,!1,".",">",null,null),LayoutKey.std(VK.SLASH,!1,"/","?",null,null)]),f=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.BACK_SLASH,!1,770,176,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,34,178,null),LayoutKey.std(VK.N3,!1,51,167,179,null),LayoutKey.std(VK.N4,!1,52,36,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,38,null,null),LayoutKey.std(VK.N7,!1,55,47,123,null),LayoutKey.std(VK.N8,!1,56,40,91,null),LayoutKey.std(VK.N9,!1,57,41,93,null),LayoutKey.std(VK.N0,!1,48,61,125,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,223,63,92,null),LayoutKey.ext(VK.EQUALS,VK.CLOSE_BRACKET,!1,769,768,null,null),LayoutKey.std(VK.Q,!0,113,81,64,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.ext(VK.Y,VK.Z,!0,122,90,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.SEMICOLON,!0,252,220,null,null),LayoutKey.ext(VK.CLOSE_BRACKET,VK.EQUALS,!1,43,42,771,null),LayoutKey.ext(VK.BACK_SLASH,VK.SLASH,!1,35,39,null,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.ext(VK.SEMICOLON,VK.BACK_QUOTE,!0,246,214,null,null),LayoutKey.std(VK.QUOTE,!0,228,196,null,null),LayoutKey.ext(VK.Z,VK.Y,!0,121,89,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,181,null),LayoutKey.std(VK.COMMA,!1,44,59,null,null),LayoutKey.std(VK.PERIOD,!1,46,58,null,null),LayoutKey.ext(VK.SLASH,VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.OEM_102,!1,60,62,124,null)]),g=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.SLASH,!1,167,176,null,null),LayoutKey.std(VK.N1,!1,49,43,166,null),LayoutKey.std(VK.N2,!1,50,34,64,null),LayoutKey.std(VK.N3,!1,51,42,35,null),LayoutKey.std(VK.N4,!1,52,231,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,38,172,null),LayoutKey.std(VK.N7,!1,55,47,124,null),LayoutKey.std(VK.N8,!1,56,40,162,null),LayoutKey.std(VK.N9,!1,57,41,null,null),LayoutKey.std(VK.N0,!1,48,61,null,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,39,63,769,null),LayoutKey.ext(VK.EQUALS,VK.CLOSE_BRACKET,!1,770,768,771,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.ext(VK.Y,VK.Z,!0,122,90,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.SEMICOLON,!1,252,232,91,null),LayoutKey.ext(VK.CLOSE_BRACKET,VK.BACK_QUOTE,!1,776,33,93,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.ext(VK.SEMICOLON,VK.QUOTE,!1,246,233,null,null),LayoutKey.ext(VK.QUOTE,VK.BACK_SLASH,!1,228,224,123,null),LayoutKey.ext(VK.BACK_SLASH,223,!1,36,163,125,null),LayoutKey.ext(VK.Z,VK.Y,!0,121,89,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,59,null,null),LayoutKey.std(VK.PERIOD,!1,46,58,null,null),LayoutKey.ext(VK.SLASH,VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.OEM_102,!1,60,62,92,null)]),h=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.QUOTE,!1,178,null,null,null),LayoutKey.std(VK.N1,!1,38,49,null,null),LayoutKey.std(VK.N2,!1,233,50,771,null),LayoutKey.std(VK.N3,!1,34,51,35,null),LayoutKey.std(VK.N4,!1,39,52,123,null),LayoutKey.std(VK.N5,!1,40,53,91,null),LayoutKey.std(VK.N6,!1,45,54,124,null),LayoutKey.std(VK.N7,!1,232,55,768,null),LayoutKey.std(VK.N8,!1,95,56,92,null),LayoutKey.std(VK.N9,!1,231,57,94,null),LayoutKey.std(VK.N0,!1,224,48,64,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,41,176,93,null),LayoutKey.std(VK.EQUALS,!1,61,43,125,null),LayoutKey.ext(VK.Q,VK.A,!0,97,65,null,null),LayoutKey.ext(VK.W,VK.Z,!0,122,90,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.CLOSE_BRACKET,!1,770,776,null,null),LayoutKey.ext(VK.CLOSE_BRACKET,VK.SEMICOLON,!1,36,163,null,null),LayoutKey.std(VK.BACK_SLASH,!1,42,181,null,null),LayoutKey.ext(VK.A,VK.Q,!0,113,81,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.ext(VK.SEMICOLON,VK.M,!0,109,77,null,null),LayoutKey.ext(VK.QUOTE,VK.BACK_QUOTE,!1,249,37,null,null),LayoutKey.ext(VK.Z,VK.W,!0,119,87,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.ext(VK.M,VK.COMMA,!1,44,63,null,null),LayoutKey.ext(VK.COMMA,VK.PERIOD,!1,59,46,null,null),LayoutKey.ext(VK.PERIOD,VK.SLASH,!1,58,47,null,null),LayoutKey.ext(VK.SLASH,223,!1,33,167,null,null),LayoutKey.std(VK.OEM_102,!1,60,62,null,null)]),i=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.QUOTE,!1,47,92,124,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,64,null,null),LayoutKey.std(VK.N3,!1,51,35,null,null),LayoutKey.std(VK.N4,!1,52,36,164,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,63,null,null),LayoutKey.std(VK.N7,!1,55,38,123,null),LayoutKey.std(VK.N8,!1,56,42,125,null),LayoutKey.std(VK.N9,!1,57,40,91,null),LayoutKey.std(VK.N0,!1,48,41,93,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,172,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,770,776,768,null),LayoutKey.std(VK.CLOSE_BRACKET,!0,231,199,771,null),LayoutKey.std(VK.BACK_SLASH,!0,224,192,null,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.std(VK.SEMICOLON,!1,59,58,176,null),LayoutKey.ext(VK.QUOTE,VK.BACK_QUOTE,!0,232,200,null,null),LayoutKey.std(VK.Z,!0,122,90,171,null),LayoutKey.std(VK.X,!0,120,88,187,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,39,60,null),LayoutKey.std(VK.PERIOD,!1,46,34,62,null),LayoutKey.std(VK.SLASH,!0,233,201,null,null),LayoutKey.std(VK.OEM_102,!0,249,217,null,null)]),j=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.SLASH,!1,167,176,null,null),LayoutKey.std(VK.N1,!1,49,43,166,null),LayoutKey.std(VK.N2,!1,50,34,64,null),LayoutKey.std(VK.N3,!1,51,42,35,null),LayoutKey.std(VK.N4,!1,52,231,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,38,172,null),LayoutKey.std(VK.N7,!1,55,47,124,null),LayoutKey.std(VK.N8,!1,56,40,162,null),LayoutKey.std(VK.N9,!1,57,41,null,null),LayoutKey.std(VK.N0,!1,48,61,null,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,39,63,769,null),LayoutKey.ext(VK.EQUALS,VK.CLOSE_BRACKET,!1,770,768,771,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.ext(VK.Y,VK.Z,!0,122,90,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.SEMICOLON,!1,232,252,91,null),LayoutKey.ext(VK.CLOSE_BRACKET,VK.BACK_QUOTE,!1,776,33,93,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.ext(VK.SEMICOLON,VK.QUOTE,!1,233,246,null,null),LayoutKey.ext(VK.QUOTE,VK.BACK_SLASH,!1,224,228,123,null),LayoutKey.ext(VK.BACK_SLASH,223,!1,36,163,125,null),LayoutKey.ext(VK.Z,VK.Y,!0,121,89,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,59,null,null),LayoutKey.std(VK.PERIOD,!1,46,58,null,null),LayoutKey.ext(VK.SLASH,VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.OEM_102,!1,60,62,92,null)]),k=Object.freeze([LayoutKey.ext(VK.BACK_QUOTE,VK.BACK_SLASH,!1,92,124,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,34,null,null),LayoutKey.std(VK.N3,!1,51,163,null,null),LayoutKey.std(VK.N4,!1,52,36,null,null),LayoutKey.std(VK.N5,!1,53,37,8364,null),LayoutKey.std(VK.N6,!1,54,38,null,null),LayoutKey.std(VK.N7,!1,55,47,null,null),LayoutKey.std(VK.N8,!1,56,40,null,null),LayoutKey.std(VK.N9,!1,57,41,null,null),LayoutKey.std(VK.N0,!1,48,61,null,null),LayoutKey.ext(VK.DASH,VK.OPEN_BRACKET,!1,39,63,null,null),LayoutKey.ext(VK.EQUALS,VK.CLOSE_BRACKET,!1,236,94,null,null),LayoutKey.std(VK.Q,!0,113,81,null,null),LayoutKey.std(VK.W,!0,119,87,null,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.ext(VK.OPEN_BRACKET,VK.SEMICOLON,!1,232,233,91,123),LayoutKey.ext(VK.CLOSE_BRACKET,VK.EQUALS,!1,43,42,93,125),LayoutKey.ext(VK.BACK_SLASH,VK.SLASH,!1,249,167,null,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.ext(VK.SEMICOLON,VK.BACK_QUOTE,!1,242,231,64,null),LayoutKey.std(VK.QUOTE,!1,224,176,35,null),LayoutKey.std(VK.Z,!0,122,90,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,59,null,null),LayoutKey.std(VK.PERIOD,!1,46,58,null,null),LayoutKey.ext(VK.SLASH,VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.OEM_102,!1,60,62,null,null)]),l=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,39,34,null,null),LayoutKey.std(VK.N1,!1,49,33,185,null),LayoutKey.std(VK.N2,!1,50,64,178,null),LayoutKey.std(VK.N3,!1,51,35,179,null),LayoutKey.std(VK.N4,!1,52,36,163,null),LayoutKey.std(VK.N5,!1,53,37,162,null),LayoutKey.std(VK.N6,!1,54,776,172,null),LayoutKey.std(VK.N7,!1,55,38,null,null),LayoutKey.std(VK.N8,!1,56,42,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,167,null),LayoutKey.std(VK.Q,!0,113,81,47,null),LayoutKey.std(VK.W,!0,119,87,63,null),LayoutKey.std(VK.E,!0,101,69,8364,null),LayoutKey.std(VK.R,!0,114,82,null,null),LayoutKey.std(VK.T,!0,116,84,null,null),LayoutKey.std(VK.Y,!0,121,89,null,null),LayoutKey.std(VK.U,!0,117,85,null,null),LayoutKey.std(VK.I,!0,105,73,null,null),LayoutKey.std(VK.O,!0,111,79,null,null),LayoutKey.std(VK.P,!0,112,80,null,null),LayoutKey.std(VK.OPEN_BRACKET,!1,769,768,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!1,91,123,170,null),LayoutKey.std(VK.A,!0,97,65,null,null),LayoutKey.std(VK.S,!0,115,83,null,null),LayoutKey.std(VK.D,!0,100,68,null,null),LayoutKey.std(VK.F,!0,102,70,null,null),LayoutKey.std(VK.G,!0,103,71,null,null),LayoutKey.std(VK.H,!0,104,72,null,null),LayoutKey.std(VK.J,!0,106,74,null,null),LayoutKey.std(VK.K,!0,107,75,null,null),LayoutKey.std(VK.L,!0,108,76,null,null),LayoutKey.std(VK.SEMICOLON,!0,231,199,null,null),LayoutKey.std(VK.QUOTE,!1,771,770,null,null),LayoutKey.std(VK.BACK_SLASH,!1,93,125,186,null),LayoutKey.std(VK.Z,!0,122,90,null,null),LayoutKey.std(VK.X,!0,120,88,null,null),LayoutKey.std(VK.C,!0,99,67,null,null),LayoutKey.std(VK.V,!0,118,86,null,null),LayoutKey.std(VK.B,!0,98,66,null,null),LayoutKey.std(VK.N,!0,110,78,null,null),LayoutKey.std(VK.M,!0,109,77,null,null),LayoutKey.std(VK.COMMA,!1,44,60,null,null),LayoutKey.std(VK.PERIOD,!1,46,62,null,null),LayoutKey.std(VK.SLASH,!1,59,58,null,null),LayoutKey.std(VK.OEM_102,!1,92,124,null,null)]),m=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!0,1105,1025,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,34,null,null),LayoutKey.std(VK.N3,!1,51,8470,null,null),LayoutKey.std(VK.N4,!1,52,59,null,null),LayoutKey.std(VK.N5,!1,53,37,null,null),LayoutKey.std(VK.N6,!1,54,58,null,null),LayoutKey.std(VK.N7,!1,55,63,null,null),LayoutKey.std(VK.N8,!1,56,42,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,null,null),LayoutKey.std(VK.Q,!0,1081,1049,null,null),LayoutKey.std(VK.W,!0,1094,1062,null,null),LayoutKey.std(VK.E,!0,1091,1059,null,null),LayoutKey.std(VK.R,!0,1082,1050,null,null),LayoutKey.std(VK.T,!0,1077,1045,null,null),LayoutKey.std(VK.Y,!0,1085,1053,null,null),LayoutKey.std(VK.U,!0,1075,1043,null,null),LayoutKey.std(VK.I,!0,1096,1064,null,null),LayoutKey.std(VK.O,!0,1097,1065,null,null),LayoutKey.std(VK.P,!0,1079,1047,null,null),LayoutKey.std(VK.OPEN_BRACKET,!0,1093,1061,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!0,1098,1066,null,null),LayoutKey.std(VK.BACK_SLASH,!1,92,47,null,null),LayoutKey.std(VK.A,!0,1092,1060,null,null),LayoutKey.std(VK.S,!0,1099,1067,null,null),LayoutKey.std(VK.D,!0,1074,1042,null,null),LayoutKey.std(VK.F,!0,1072,1040,null,null),LayoutKey.std(VK.G,!0,1087,1055,null,null),LayoutKey.std(VK.H,!0,1088,1056,null,null),LayoutKey.std(VK.J,!0,1086,1054,null,null),LayoutKey.std(VK.K,!0,1083,1051,null,null),LayoutKey.std(VK.L,!0,1076,1044,null,null),LayoutKey.std(VK.SEMICOLON,!0,1078,1046,null,null),LayoutKey.std(VK.QUOTE,!0,1101,1069,null,null),LayoutKey.std(VK.Z,!0,1103,1071,null,null),LayoutKey.std(VK.X,!0,1095,1063,null,null),LayoutKey.std(VK.C,!0,1089,1057,null,null),LayoutKey.std(VK.V,!0,1084,1052,null,null),LayoutKey.std(VK.B,!0,1080,1048,null,null),LayoutKey.std(VK.N,!0,1090,1058,null,null),LayoutKey.std(VK.M,!0,1100,1068,null,null),LayoutKey.std(VK.COMMA,!0,1073,1041,null,null),LayoutKey.std(VK.PERIOD,!0,1102,1070,null,null),LayoutKey.std(VK.SLASH,!1,46,44,null,null)]),n=Object.freeze([LayoutKey.std(VK.BACK_QUOTE,!1,93,91,null,null),LayoutKey.std(VK.N1,!1,49,33,null,null),LayoutKey.std(VK.N2,!1,50,34,null,null),LayoutKey.std(VK.N3,!1,51,8470,null,null),LayoutKey.std(VK.N4,!1,52,37,null,null),LayoutKey.std(VK.N5,!1,53,58,null,null),LayoutKey.std(VK.N6,!1,54,44,null,null),LayoutKey.std(VK.N7,!1,55,46,null,null),LayoutKey.std(VK.N8,!1,56,59,null,null),LayoutKey.std(VK.N9,!1,57,40,null,null),LayoutKey.std(VK.N0,!1,48,41,null,null),LayoutKey.std(VK.DASH,!1,45,95,null,null),LayoutKey.std(VK.EQUALS,!1,61,43,null,null),LayoutKey.std(VK.Q,!0,1081,1049,null,null),LayoutKey.std(VK.W,!0,1094,1062,null,null),LayoutKey.std(VK.E,!0,1091,1059,null,null),LayoutKey.std(VK.R,!0,1082,1050,null,null),LayoutKey.std(VK.T,!0,1077,1045,null,null),LayoutKey.std(VK.Y,!0,1085,1053,null,null),LayoutKey.std(VK.U,!0,1075,1043,null,null),LayoutKey.std(VK.I,!0,1096,1064,null,null),LayoutKey.std(VK.O,!0,1097,1065,null,null),LayoutKey.std(VK.P,!0,1079,1047,null,null),LayoutKey.std(VK.OPEN_BRACKET,!0,1093,1061,null,null),LayoutKey.std(VK.CLOSE_BRACKET,!0,1098,1066,null,null),LayoutKey.std(VK.BACK_SLASH,!0,1105,1025,null,null),LayoutKey.std(VK.A,!0,1092,1060,null,null),LayoutKey.std(VK.S,!0,1099,1067,null,null),LayoutKey.std(VK.D,!0,1074,1042,null,null),LayoutKey.std(VK.F,!0,1072,1040,null,null),LayoutKey.std(VK.G,!0,1087,1055,null,null),LayoutKey.std(VK.H,!0,1088,1056,null,null),LayoutKey.std(VK.J,!0,1086,1054,null,null),LayoutKey.std(VK.K,!0,1083,1051,null,null),LayoutKey.std(VK.L,!0,1076,1044,null,null),LayoutKey.std(VK.SEMICOLON,!0,1078,1046,null,null),LayoutKey.std(VK.QUOTE,!0,1101,1069,null,null),LayoutKey.std(VK.Z,!0,1103,1071,null,null),LayoutKey.std(VK.X,!0,1095,1063,null,null),LayoutKey.std(VK.C,!0,1089,1057,null,null),LayoutKey.std(VK.V,!0,1084,1052,null,null),LayoutKey.std(VK.B,!0,1080,1048,null,null),LayoutKey.std(VK.N,!0,1090,1058,null,null),LayoutKey.std(VK.M,!0,1100,1068,null,null),LayoutKey.std(VK.COMMA,!0,1073,1041,null,null),LayoutKey.std(VK.PERIOD,!0,1102,1070,null,null),LayoutKey.std(VK.SLASH,!1,47,63,null,null)]);
return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD_WIN:b,ENGLISH_UK_STANDARD_MAC:c,ENGLISH_US_DVORAK:d,ENGLISH_US_COLEMAK:e,GERMAN_STANDARD:f,GERMAN_SWITZERLAND:g,FRENCH_STANDARD:h,FRENCH_CANADA:i,FRENCH_SWITZERLAND:j,ITALIAN_STANDARD:k,PORTUGUESE_BRAZIL:l,RUSSIAN_WIN:m,RUSSIAN_MAC:n})}(),LAYOUT_GEOMETRY=function(){var a=[{id:VK.BACK_QUOTE,x:0,y:0,ref:"key",c:"z1"},{id:VK.N1,x:42,y:0,ref:"key",c:"z1"},{id:VK.N2,x:84,y:0,ref:"key",c:"z2"},{id:VK.N3,x:126,y:0,ref:"key",c:"z3"},{id:VK.N4,x:168,y:0,ref:"key",c:"z4"},{id:VK.N5,x:210,y:0,ref:"key",c:"z4"},{id:VK.N6,x:252,y:0,ref:"key",c:"z5"},{id:VK.N7,x:294,y:0,ref:"key",c:"z5"},{id:VK.N8,x:336,y:0,ref:"key",c:"z6"},{id:VK.N9,x:378,y:0,ref:"key",c:"z7"},{id:VK.N0,x:420,y:0,ref:"key",c:"z8"},{id:VK.DASH,x:462,y:0,ref:"key",c:"z8"},{id:VK.EQUALS,x:504,y:0,ref:"key",c:"z8"},{id:VK.BACK_SPACE,x:546,y:0,ref:"key-backspace"},{id:VK.TAB,x:0,y:42,ref:"key-tab"},{id:VK.Q,x:65,y:42,ref:"key",c:"z1"},{id:VK.W,x:107,y:42,ref:"key",c:"z2"},{id:VK.E,x:149,y:42,ref:"key",c:"z3"},{id:VK.R,x:191,y:42,ref:"key",c:"z4"},{id:VK.T,x:233,y:42,ref:"key",c:"z4"},{id:VK.Y,x:275,y:42,ref:"key",c:"z5"},{id:VK.U,x:317,y:42,ref:"key",c:"z5"},{id:VK.I,x:359,y:42,ref:"key",c:"z6"},{id:VK.O,x:401,y:42,ref:"key",c:"z7"},{id:VK.P,x:443,y:42,ref:"key",c:"z8"},{id:VK.OPEN_BRACKET,x:485,y:42,ref:"key",c:"z8"},{id:VK.CLOSE_BRACKET,x:527,y:42,ref:"key",c:"z8"},{id:VK.CAPS_LOCK,x:0,y:84,ref:"key-caps-lock"},{id:VK.A,x:72,y:84,ref:"key",c:"z1"},{id:VK.S,x:114,y:84,ref:"key",c:"z2"},{id:VK.D,x:156,y:84,ref:"key",c:"z3"},{id:VK.F,x:198,y:84,ref:"key",c:"z4"},{id:VK.G,x:240,y:84,ref:"key",c:"z4"},{id:VK.H,x:282,y:84,ref:"key",c:"z5"},{id:VK.J,x:324,y:84,ref:"key",c:"z5"},{id:VK.K,x:366,y:84,ref:"key",c:"z6"},{id:VK.L,x:408,y:84,ref:"key",c:"z7"},{id:VK.SEMICOLON,x:450,y:84,ref:"key",c:"z8"},{id:VK.QUOTE,x:492,y:84,ref:"key",c:"z8"},{id:VK.BACK_SLASH,x:534,y:84,ref:"key",c:"z8"},{id:VK.RETURN,x:569,y:42,ref:"key-enter"},{id:"lshift",x:0,y:126,ref:"key-left-shift"},{id:VK.Z,x:94,y:126,ref:"key",c:"z1"},{id:VK.X,x:136,y:126,ref:"key",c:"z2"},{id:VK.C,x:178,y:126,ref:"key",c:"z3"},{id:VK.V,x:220,y:126,ref:"key",c:"z4"},{id:VK.B,x:262,y:126,ref:"key",c:"z4"},{id:VK.N,x:304,y:126,ref:"key",c:"z5"},{id:VK.M,x:346,y:126,ref:"key",c:"z5"},{id:VK.COMMA,x:388,y:126,ref:"key",c:"z6"},{id:VK.PERIOD,x:430,y:126,ref:"key",c:"z7"},{id:VK.SLASH,x:472,y:126,ref:"key",c:"z8"},{id:"rshift",x:514,y:126,ref:"key-right-shift"},{id:"lctrl",x:0,y:168,ref:"key-ctrl"},{id:"lalt",x:65,y:168,ref:"key-alt"},{id:VK.SPACE,x:130,y:168,ref:"key-space"},{id:"ralt",x:501,y:168,ref:"key-alt"},{id:"rctrl",x:566,y:168,ref:"key-ctrl"}],b=[{id:VK.BACK_QUOTE,x:0,y:0,ref:"key",c:"z1"},{id:VK.N1,x:42,y:0,ref:"key",c:"z1"},{id:VK.N2,x:84,y:0,ref:"key",c:"z2"},{id:VK.N3,x:126,y:0,ref:"key",c:"z3"},{id:VK.N4,x:168,y:0,ref:"key",c:"z4"},{id:VK.N5,x:210,y:0,ref:"key",c:"z4"},{id:VK.N6,x:252,y:0,ref:"key",c:"z5"},{id:VK.N7,x:294,y:0,ref:"key",c:"z5"},{id:VK.N8,x:336,y:0,ref:"key",c:"z6"},{id:VK.N9,x:378,y:0,ref:"key",c:"z7"},{id:VK.N0,x:420,y:0,ref:"key",c:"z8"},{id:VK.DASH,x:462,y:0,ref:"key",c:"z8"},{id:VK.EQUALS,x:504,y:0,ref:"key",c:"z8"},{id:VK.BACK_SPACE,x:546,y:0,ref:"key-backspace"},{id:VK.TAB,x:0,y:42,ref:"key-tab"},{id:VK.Q,x:65,y:42,ref:"key",c:"z1"},{id:VK.W,x:107,y:42,ref:"key",c:"z2"},{id:VK.E,x:149,y:42,ref:"key",c:"z3"},{id:VK.R,x:191,y:42,ref:"key",c:"z4"},{id:VK.T,x:233,y:42,ref:"key",c:"z4"},{id:VK.Y,x:275,y:42,ref:"key",c:"z5"},{id:VK.U,x:317,y:42,ref:"key",c:"z5"},{id:VK.I,x:359,y:42,ref:"key",c:"z6"},{id:VK.O,x:401,y:42,ref:"key",c:"z7"},{id:VK.P,x:443,y:42,ref:"key",c:"z8"},{id:VK.OPEN_BRACKET,x:485,y:42,ref:"key",c:"z8"},{id:VK.CLOSE_BRACKET,x:527,y:42,ref:"key",c:"z8"},{id:VK.CAPS_LOCK,x:0,y:84,ref:"key-caps-lock"},{id:VK.A,x:72,y:84,ref:"key",c:"z1"},{id:VK.S,x:114,y:84,ref:"key",c:"z2"},{id:VK.D,x:156,y:84,ref:"key",c:"z3"},{id:VK.F,x:198,y:84,ref:"key",c:"z4"},{id:VK.G,x:240,y:84,ref:"key",c:"z4"},{id:VK.H,x:282,y:84,ref:"key",c:"z5"},{id:VK.J,x:324,y:84,ref:"key",c:"z5"},{id:VK.K,x:366,y:84,ref:"key",c:"z6"},{id:VK.L,x:408,y:84,ref:"key",c:"z7"},{id:VK.SEMICOLON,x:450,y:84,ref:"key",c:"z8"},{id:VK.QUOTE,x:492,y:84,ref:"key",c:"z8"},{id:VK.BACK_SLASH,x:534,y:84,ref:"key",c:"z8"},{id:VK.RETURN,x:569,y:42,ref:"key-enter"},{id:"lshift",x:0,y:126,ref:"key-left-shift-small"},{id:VK.OEM_102,x:52,y:126,ref:"key",c:"z1"},{id:VK.Z,x:94,y:126,ref:"key",c:"z1"},{id:VK.X,x:136,y:126,ref:"key",c:"z2"},{id:VK.C,x:178,y:126,ref:"key",c:"z3"},{id:VK.V,x:220,y:126,ref:"key",c:"z4"},{id:VK.B,x:262,y:126,ref:"key",c:"z4"},{id:VK.N,x:304,y:126,ref:"key",c:"z5"},{id:VK.M,x:346,y:126,ref:"key",c:"z5"},{id:VK.COMMA,x:388,y:126,ref:"key",c:"z6"},{id:VK.PERIOD,x:430,y:126,ref:"key",c:"z7"},{id:VK.SLASH,x:472,y:126,ref:"key",c:"z8"},{id:"rshift",x:514,y:126,ref:"key-right-shift"},{id:"lctrl",x:0,y:168,ref:"key-ctrl"},{id:"lalt",x:65,y:168,ref:"key-alt"},{id:VK.SPACE,x:130,y:168,ref:"key-space"},{id:"ralt",x:501,y:168,ref:"key-alt-gr"},{id:"rctrl",x:566,y:168,ref:"key-ctrl"}],c=[{id:VK.BACK_QUOTE,x:0,y:0,ref:"key",c:"z1"},{id:VK.N1,x:42,y:0,ref:"key",c:"z1"},{id:VK.N2,x:84,y:0,ref:"key",c:"z2"},{id:VK.N3,x:126,y:0,ref:"key",c:"z3"},{id:VK.N4,x:168,y:0,ref:"key",c:"z4"},{id:VK.N5,x:210,y:0,ref:"key",c:"z4"},{id:VK.N6,x:252,y:0,ref:"key",c:"z5"},{id:VK.N7,x:294,y:0,ref:"key",c:"z5"},{id:VK.N8,x:336,y:0,ref:"key",c:"z6"},{id:VK.N9,x:378,y:0,ref:"key",c:"z7"},{id:VK.N0,x:420,y:0,ref:"key",c:"z8"},{id:VK.DASH,x:462,y:0,ref:"key",c:"z8"},{id:VK.EQUALS,x:504,y:0,ref:"key",c:"z8"},{id:VK.BACK_SPACE,x:546,y:0,ref:"key-backspace"},{id:VK.TAB,x:0,y:42,ref:"key-tab"},{id:VK.Q,x:65,y:42,ref:"key",c:"z1"},{id:VK.W,x:107,y:42,ref:"key",c:"z2"},{id:VK.E,x:149,y:42,ref:"key",c:"z3"},{id:VK.R,x:191,y:42,ref:"key",c:"z4"},{id:VK.T,x:233,y:42,ref:"key",c:"z4"},{id:VK.Y,x:275,y:42,ref:"key",c:"z5"},{id:VK.U,x:317,y:42,ref:"key",c:"z5"},{id:VK.I,x:359,y:42,ref:"key",c:"z6"},{id:VK.O,x:401,y:42,ref:"key",c:"z7"},{id:VK.P,x:443,y:42,ref:"key",c:"z8"},{id:VK.OPEN_BRACKET,x:485,y:42,ref:"key",c:"z8"},{id:VK.CLOSE_BRACKET,x:527,y:42,ref:"key",c:"z8"},{id:VK.BACK_SLASH,x:569,y:42,ref:"key-wide",c:"z8"},{id:VK.CAPS_LOCK,x:0,y:84,ref:"key-caps-lock"},{id:VK.A,x:72,y:84,ref:"key",c:"z1"},{id:VK.S,x:114,y:84,ref:"key",c:"z2"},{id:VK.D,x:156,y:84,ref:"key",c:"z3"},{id:VK.F,x:198,y:84,ref:"key",c:"z4"},{id:VK.G,x:240,y:84,ref:"key",c:"z4"},{id:VK.H,x:282,y:84,ref:"key",c:"z5"},{id:VK.J,x:324,y:84,ref:"key",c:"z5"},{id:VK.K,x:366,y:84,ref:"key",c:"z6"},{id:VK.L,x:408,y:84,ref:"key",c:"z7"},{id:VK.SEMICOLON,x:450,y:84,ref:"key",c:"z8"},{id:VK.QUOTE,x:492,y:84,ref:"key",c:"z8"},{id:VK.RETURN,x:534,y:84,ref:"key-enter-small"},{id:"lshift",x:0,y:126,ref:"key-left-shift"},{id:VK.Z,x:94,y:126,ref:"key",c:"z1"},{id:VK.X,x:136,y:126,ref:"key",c:"z2"},{id:VK.C,x:178,y:126,ref:"key",c:"z3"},{id:VK.V,x:220,y:126,ref:"key",c:"z4"},{id:VK.B,x:262,y:126,ref:"key",c:"z4"},{id:VK.N,x:304,y:126,ref:"key",c:"z5"},{id:VK.M,x:346,y:126,ref:"key",c:"z5"},{id:VK.COMMA,x:388,y:126,ref:"key",c:"z6"},{id:VK.PERIOD,x:430,y:126,ref:"key",c:"z7"},{id:VK.SLASH,x:472,y:126,ref:"key",c:"z8"},{id:"rshift",x:514,y:126,ref:"key-right-shift"},{id:"lctrl",x:0,y:168,ref:"key-ctrl"},{id:"lalt",x:65,y:168,ref:"key-alt"},{id:VK.SPACE,x:130,y:168,ref:"key-space"},{id:"ralt",x:501,y:168,ref:"key-alt"},{id:"rctrl",x:566,y:168,ref:"key-ctrl"}],d=[{id:VK.INSERT,x:648,y:0,ref:"key-insert"},{id:VK.HOME,x:690,y:0,ref:"key-home"},{id:VK.PAGE_UP,x:732,y:0,ref:"key-page-up"},{id:VK.DELETE,x:648,y:42,ref:"key-delete"},{id:VK.END,x:690,y:42,ref:"key-end"},{id:VK.PAGE_DOWN,x:732,y:42,ref:"key-page-down"},{id:VK.UP,x:690,y:126,ref:"key-up"},{id:VK.LEFT,x:648,y:168,ref:"key-left"},{id:VK.DOWN,x:690,y:168,ref:"key-down"},{id:VK.RIGHT,x:732,y:168,ref:"key-right"}],e=[{id:VK.NUM_LOCK,x:792,y:0,ref:"key-np-num-lock"},{id:VK.DIVIDE,x:834,y:0,ref:"key-np-divide"},{id:VK.MULTIPLY,x:876,y:0,ref:"key-np-multiply"},{id:VK.SUBTRACT,x:918,y:0,ref:"key-np-subtract"},{id:VK.NUMPAD7,x:792,y:42,ref:"key-np-7"},{id:VK.NUMPAD8,x:834,y:42,ref:"key-np-8"},{id:VK.NUMPAD9,x:876,y:42,ref:"key-np-9"},{id:VK.ADD,x:918,y:42,ref:"key-np-add"},{id:VK.NUMPAD4,x:792,y:84,ref:"key-np-4"},{id:VK.NUMPAD5,x:834,y:84,ref:"key-np-5"},{id:VK.NUMPAD6,x:876,y:84,ref:"key-np-6"},{id:VK.NUMPAD1,x:792,y:126,ref:"key-np-1"},{id:VK.NUMPAD2,x:834,y:126,ref:"key-np-2"},{id:VK.NUMPAD3,x:876,y:126,ref:"key-np-3"},{id:"numpad-enter",x:918,y:126,ref:"key-np-enter"},{id:VK.NUMPAD0,x:792,y:168,ref:"key-np-0"},{id:VK.DECIMAL,x:876,y:168,ref:"key-np-decimal"}];return Object.freeze({TYPE_A:a,TYPE_B:b,TYPE_C:c,CURSOR:d,NUMPAD:e})}(),XID_LANG_EN=16,XID_LANG_DE=32,XID_LANG_FR=48,XID_LANG_IT=64,XID_LANG_SP=64,XID_LANG_PT=96,XID_LANG_RU=112,LAYOUT=function(){var a=new Layout("us",0|XID_LANG_EN,"English/US","en",LAYOUT_KEY_SET.ENGLISH_US_STANDARD,LAYOUT_GEOMETRY.TYPE_C,null),b=new Layout("us-dvorak",8|XID_LANG_EN,"English/US - Dvorak","en",LAYOUT_KEY_SET.ENGLISH_US_DVORAK,LAYOUT_GEOMETRY.TYPE_C,a),c=new Layout("us-colemak",9|XID_LANG_EN,"English/US - Colemak","en",LAYOUT_KEY_SET.ENGLISH_US_COLEMAK,LAYOUT_GEOMETRY.TYPE_C,a),d=new Layout("de",0|XID_LANG_DE,"German/Germany","de",LAYOUT_KEY_SET.GERMAN_STANDARD,LAYOUT_GEOMETRY.TYPE_B,null),e=new Layout("de-ch",1|XID_LANG_DE,"German/Switzerland","de",LAYOUT_KEY_SET.GERMAN_SWITZERLAND,LAYOUT_GEOMETRY.TYPE_B,null),f=new Layout("fr",0|XID_LANG_FR,"French/France","fr",LAYOUT_KEY_SET.FRENCH_STANDARD,LAYOUT_GEOMETRY.TYPE_B,null),g=new Layout("fr-ca",1|XID_LANG_FR,"French/Canada","fr",LAYOUT_KEY_SET.FRENCH_CANADA,LAYOUT_GEOMETRY.TYPE_B,null),h=new Layout("fr-ch",2|XID_LANG_FR,"French/Switzerland","fr",LAYOUT_KEY_SET.FRENCH_SWITZERLAND,LAYOUT_GEOMETRY.TYPE_B,null),i=new Layout("it",0|XID_LANG_IT,"Italian/Italy","it",LAYOUT_KEY_SET.ITALIAN_STANDARD,LAYOUT_GEOMETRY.TYPE_B,null),j=new Layout("pt-br",0|XID_LANG_PT,"Portuguese/Brazil","pt",LAYOUT_KEY_SET.PORTUGUESE_BRAZIL,LAYOUT_GEOMETRY.TYPE_B,null),k=navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)?!0:!1;if(k){var l=new Layout("uk",1|XID_LANG_EN,"English/UK","en",LAYOUT_KEY_SET.ENGLISH_UK_STANDARD_MAC,LAYOUT_GEOMETRY.TYPE_C,null),m=new Layout("ru",0|XID_LANG_RU,"Cyrillic/Russia (Mac)","ru",LAYOUT_KEY_SET.RUSSIAN_MAC,LAYOUT_GEOMETRY.TYPE_C,null);return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD:l,ENGLISH_US_DVORAK:b,ENGLISH_US_COLEMAK:c,RUSSIAN:m})}var n=new Layout("uk",1|XID_LANG_EN,"English/UK","en",LAYOUT_KEY_SET.ENGLISH_UK_STANDARD_WIN,LAYOUT_GEOMETRY.TYPE_B,null),o=new Layout("ru",0|XID_LANG_RU,"Cyrillic/Russia (Win)","ru",LAYOUT_KEY_SET.RUSSIAN_WIN,LAYOUT_GEOMETRY.TYPE_A,null);return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD:n,ENGLISH_US_DVORAK:b,ENGLISH_US_COLEMAK:c,GERMAN_STANDARD:d,GERMAN_SWITZERLAND:e,FRENCH_STANDARD:f,FRENCH_CANADA:g,FRENCH_SWITZERLAND:h,ITALIAN_STANDARD:i,PORTUGUESE_BRAZIL:j,RUSSIAN:o})}();Sounds.prototype={init:function(a){function b(a){return[c+a+".ogg",c+a+".mp3",c+a+".wav"]}var c="/res/sound/";if(a.enableSound){if(null==this.library){this.library=Object.create(null);for(var d=["click","blip","correct","wrong","tada"],e=0;e<d.length;e++)this.library[d[e]]=new Howl({urls:b(d[e])})}}else this.library=null},play:function(a){if(this.library){var b=this.library[a];if(!b)throw new Error;b.stop(),b.play()}}};var sounds=new Sounds,__now=function(){return window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return Date.now()}}();Enum.fromCode=function(a,b,c){for(var d in a){var e=a[d];if(e.id===b)return e}if(void 0===c)throw new Error;return c},Enum.fromXCode=function(a,b,c){for(var d in a){var e=a[d];if(e.xid===b)return e}if(void 0===c)throw new Error;return c};var MODE_TYPE=function(){return Object.freeze({AUTO:new ModeType("auto",1,"Computer-generated lessons"),CUSTOM:new ModeType("custom",2,"User-provided lessons")})}(),MODE=function(){return Object.freeze({GUIDED:new Mode("guided",1,MODE_TYPE.AUTO),IMPORT_WEBSITE:new Mode("import_website",2,MODE_TYPE.CUSTOM),IMPORT_TEXT:new Mode("import_text",3,MODE_TYPE.CUSTOM)})}();SpeedUnit.prototype.fromTime=function(a){return this.measure(6e4/a)};var SPEED_UNIT=function(){var a=new SpeedUnit("wpm","Words per minute",function(a){return a/5}),b=new SpeedUnit("cpm","Characters per minute",function(a){return a});return Object.freeze({WPM:a,CPM:b})}();ModeKey.prototype.toString=function(){return this.key},ModeKey.map=Object.create(null),ModeKey.get=function(a){var b,c;if(2==arguments.length)b=arguments[0],c=arguments[1],"object"==typeof b&&(b=b.id),"object"==typeof c&&(c=c.id),a=b+":"+c;else{var d=a.indexOf(":");if(-1==d)throw new Error;b=a.substring(0,d),c=a.substring(d+1)}var e=ModeKey.map[a];return null==e&&(e=ModeKey.map[a]=new ModeKey(b,c)),e},Settings.DEFAULT_LAYOUT=LAYOUT.ENGLISH_US_STANDARD,Settings.DEFAULT_MODE=MODE.GUIDED,Settings.prototype.importUrl=function(a){this.mode=MODE.IMPORT_WEBSITE,this.textConfig.url=a},Settings.prototype.reload=function(){function a(a,b){return null==a?!!b:!!a}var b=window.localStorage.getObject("settings");null==b?b={}:this.newSettings=!1,b.layout=b.layout||"",b.mode=b.mode||"",b.lesson=b.lesson||{},b.text=b.text||{},b.text.mangle=b.text.mangle||{},this.layout=Enum.fromCode(LAYOUT,b.layout,Settings.DEFAULT_LAYOUT),this.emulateLayout=a(b.emulateLayout,!1),this.mode=Enum.fromCode(MODE,b.mode,Settings.DEFAULT_MODE),this.lesson.complexity=Math.max(0,Math.min(1,parseFloat(b.lesson.complexity)||0)),this.lesson.length=Math.max(0,Math.min(1,parseFloat(b.lesson.length)||0)),this.lesson.capitals=a(b.lesson.capitals,!1),this.lesson.punctuators=a(b.lesson.punctuators,!1),this.speedUnit=Enum.fromCode(SPEED_UNIT,b.speedUnit,SPEED_UNIT.WPM),this.enableSound=a(b.enableSound,!1),this.textConfig.url=b.text.url||"",this.textConfig.text=b.text.text||"",this.textConfig.mangle.simplify=a(b.text.mangle.simplify,!0),this.textConfig.mangle.lowercase=a(b.text.mangle.lowercase,!0),this.textConfig.mangle.censor=a(b.text.mangle.censor,!0)},Settings.prototype.persist=function(){window.localStorage.setObject("settings",{layout:this.layout.id,emulateLayout:this.emulateLayout,mode:this.mode.id,lesson:{complexity:this.lesson.complexity,length:this.lesson.length,capitals:this.lesson.capitals,punctuators:this.lesson.punctuators},speedUnit:this.speedUnit.id,enableSound:this.enableSound,text:{mangle:{simplify:this.textConfig.mangle.simplify,lowercase:this.textConfig.mangle.lowercase,censor:this.textConfig.mangle.censor},url:this.textConfig.url,text:this.textConfig.text}})},Settings.prototype.remove=function(){window.localStorage.removeItem("settings")},Settings.prototype.loadLesson=function(a){var b=this;switch(b.mode){case MODE.GUIDED:LanguageModel.get(b.layout.lang).load(function(c){a(new Lesson(b,c))}.bind(b));break;case MODE.IMPORT_WEBSITE:var c=window.location.protocol+"//"+window.location.host+"/fetch?url="+encodeURIComponent(b.textConfig.url),d=new XMLHttpRequest;d.onload=function(){a(new StaticLesson(b,new StaticTextGenerator(d.responseText,b.textConfig.mangle,b.layout)))}.bind(b),d.onerror=function(){a(new StaticLesson(b,new DummyGenerator("cannot load text")))}.bind(b),watchProgress(d),d.open("GET",c,!0),d.send();break;case MODE.IMPORT_TEXT:a(new StaticLesson(b,new StaticTextGenerator(b.textConfig.text,b.textConfig.mangle,b.layout)));break;default:throw new Error}},ResultArray.BY_TS=function(a,b){return a.timeStamp-b.timeStamp},ResultArray.prototype=[],ResultArray.prototype.statistics=function(){var a=0,b=0,c=0,d=0,e=0,f=0;if(this.length>0){for(var g=0;g<this.length;g++){var h=this[g];a+=h.time,b=Math.max(b,h.speed),c+=h.speed,d=Math.max(d,h.score),e+=h.score,f+=h.errors}c/=this.length,e/=this.length,f/=this.length}return{count:this.length,totalTime:a,topSpeed:b,avgSpeed:c,topScore:d,avgScore:e,avgErrors:f}},ResultArray.prototype.today=function(){var a=new Date;a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a=a.getTime();for(var b=new ResultArray,c=0;c<this.length;c++){var d=this[c];d.timeStamp>a&&b.push(d)}return b},ResultArray.prototype.filter=function(a){var b=new ResultArray;b.modeKey=a;for(var c=0;c<this.length;c++){var d=this[c];d.modeKey==a&&b.push(d)}return b},ResultArray.prototype.group=function(){for(var a=Object.create(null),b=0;b<this.length;b++){var c=this[b],d=c.modeKey,e=a[d];null==e&&(e=a[d]=new ResultArray),e.push(c)}return a},ResultArray.prototype.groupByDate=function(){for(var a=Object.create(null),b=0;b<this.length;b++){var c=this[b],d=new DateX(c.timeStamp),e=a[d];void 0===e&&(a[d]=e={date:d,data:new ResultArray}),e.data.push(c)}return mapValues(a).sort(function(a,b){return a.timeStamp-b.timeStamp})},CharSet.ORDER_BY=function(){return Object.freeze({FREQUENCY:"F",INDEX:"N"})}(),CharSet.prototype=[],CharSet.prototype.orderBy=function(a){for(var b=new CharSet,c=0;c<this.length;c++)b.push(this[c]);switch(a){case CharSet.ORDER_BY.FREQUENCY:b.sort(function(a,b){return b.f-a.f});break;case CharSet.ORDER_BY.INDEX:b.sort(function(a,b){return a.charCode-b.charCode});break;default:throw new Error}return b},Statistics.prototype.add=function(a){this.n++;var b=a-this.mean;this.mean+=b/this.n,this.m2+=b*(a-this.mean),this.n>1&&(this.variance=this.m2/(this.n-1))},MovingMean.smooth=function(a,b){var c=[];return new MovingMean(a,c).addAll(b),c},MovingMean.prototype.add=function(a){var b=a/this.size;this.data.push(b),this.sum+=b,this.data.length==this.size&&(this.mean=this.sum,this.min=null===this.min?this.mean:Math.min(this.min,this.mean),this.max=null===this.max?this.mean:Math.max(this.max,this.mean),this.sink.push(this.mean),this.sum-=this.data.shift())},MovingMean.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},KeyData.prototype.add=function(a){var b=a.histogram,c=b[this.charCode];c&&c.t>0&&(this.t.push(c.t),this.statistics.add(c.t),this.movingMean.add(c.t),this.learningTime+=a.time)},KeyData.prototype.isConfident=function(){return KeyData.isConfident(this.movingMean.min||this.statistics.mean||null)},KeyData.isConfident=function(a){return null==a?!1:a<=Lesson.MIN_TIME},KeyData.prototype.confidenceLevel=function(){return KeyData.confidenceLevel(this.movingMean.mean||this.statistics.mean||null)},KeyData.confidenceLevel=function(a){return null==a?null:(a=Math.max(a,Lesson.MIN_TIME),a=Math.min(a,Lesson.MAX_TIME),1-(a-Lesson.MIN_TIME)/(Lesson.MAX_TIME-Lesson.MIN_TIME))},KeyData.prototype.learningRate=function(a){var b=Math.linearRegression(this.t.map(function(b){return a.fromTime(b)}));return{unit:a,lr:b,perSample:b.beta,perHour:60*b.beta*60*1e3/(this.learningTime/this.t.length)}},Forecast.prototype.add=function(a){this.data.push(a),this._add(a)},Forecast.prototype._add=function(a){for(var b=0;b<this.charSet.length;b++){var c=this.charSet[b];this.map[c.charCode].add(a)}},Histogram.prototype.add=function(a){for(var b=0;b<this.charSet.length;b++){var c=this.charSet[b],d=this.map[c.charCode],e=a.histogram[c.charCode];e&&(d.h+=0|e.h,d.m+=0|e.m,d.r=d.m/d.h,this.maxh=Math.max(this.maxh,d.h),this.maxm=Math.max(this.maxm,d.m),this.maxr=Math.max(this.maxr,d.r),0==this.count?(this.minh=d.h,this.minm=d.m,this.minr=d.r):(this.minh=Math.min(this.minh,d.h),this.minm=Math.min(this.minm,d.m),this.minr=Math.min(this.minr,d.r)))}this.count++},History.prototype.get=function(a){var b=this.data[a];return null==b&&(b=this.data[a]=new ResultArray),b},History.prototype.add=function(a,b){this.get(a.modeKey);if(this.id){var c=new Sync(this.id);c.add(a),c.send(function(){b()}.bind(this))}else this.writeLocal(a,function(){b()}.bind(this))},History.prototype._onerror=function(a){console.log(a)},History.prototype.open=function(a){var b=window.indexedDB.open("history",1);b.onerror=this._onerror.bind(this),b.onblocked=function(a){console.log("indexed db blocked",a)}.bind(this),b.onupgradeneeded=function(){{var a=b.result,c=a.createObjectStore("history",{autoIncrement:!0});c.createIndex("by_layout","layout")}}.bind(this),b.onsuccess=function(){this.db=b.result,this.id?this.loadRemote(function(b){b.length>0?(console.log("loaded data from server"),this.data=b.group(),a()):this.readLocal(function(b){if(b.length>0){console.log("uploading local data to server");for(var c=new Sync(this.id),d=0;d<b.length;d++)c.add(b[d]);c.send(function(){this.data=b.group(),a()}.bind(this))}else a()}.bind(this))}.bind(this)):this.readLocal(function(b){this.data=b.group(),a()}.bind(this))}.bind(this)},History.prototype.loadRemote=function(a){var b=new Sync(this.id);b.receive(function(b){b.sort(ResultArray.BY_TS),a(b)}.bind(this))},History.prototype.readLocal=function(a){var b=new ResultArray,c=this.db.transaction("history"),d=c.objectStore("history"),e=d.openCursor();e.onerror=this._onerror.bind(this),e.onsuccess=function(){var c=e.result;if(c){var d=c.value;try{d.tx&&(d.n=d.tx.length),"string"==typeof d.l&&"string"==typeof d.m&&b.push(Result.fromJson(d))}catch(f){}c.continue()}else a(b)}.bind(this)},History.prototype.writeLocal=function(a,b){var c=this.db.transaction("history","readwrite"),d=c.objectStore("history"),e=Result.toJson(a),f=d.add(e);f.onerror=this._onerror.bind(this),f.onsuccess=function(){b()}.bind(this)},History.prototype.delete=function(a){this.db.close(),this.db=null;var b=window.indexedDB.deleteDatabase("history");b.onerror=this._onerror.bind(this),b.onblocked=function(a){console.log(a)}.bind(this),b.onupgradeneeded=function(a){console.log(a)}.bind(this),b.onsuccess=function(){this.open(a)}.bind(this)},Sync.MESSAGE_SIGNATURE=1262836034,Sync.MESSAGE_VERSION=1,Sync.FILE_SIGNATURE=1262836034,Sync.FILE_VERSION=1,Sync.prototype.add=function(a){this.data.push(a)},Sync.prototype.send=function(a){for(var b=new Serializer,c=0;c<this.data.length;c++)b.add(this.data[c]);var d=b.format(),e=rc4.key(this.id);d=rc4.encode(e,d);var f=new XMLHttpRequest;f.onload=function(){a()}.bind(this),f.onerror=function(){console.log("error sending message")}.bind(this),f.open("POST",this.url,!0),f.setRequestHeader("Content-Type","application/octet-stream"),f.send(d)},Sync.prototype.receive=function(a){var b=new XMLHttpRequest;b.onload=function(){var c=b.response,d=new ResultArray;this.parse(c,d),a(d)}.bind(this),b.onerror=function(){console.log("error receiving data")}.bind(this),watchProgress(b),b.open("GET",this.url,!0),b.responseType="arraybuffer",b.setRequestHeader("Cache-Control","no-cache"),b.send()},Sync.prototype.parse=function(a,b){var c=new DataView(a);if(c.byteLength>8&&c.getUint32(0)==Sync.FILE_SIGNATURE&&c.getUint32(4)==Sync.FILE_VERSION)for(var d=8;d<c.byteLength;){var e=c.getUint8(d+0),f=c.getUint8(d+1),g=c.getUint32(d+2),h=c.getUint16(d+6),i=c.getUint16(d+8),j=c.getUint8(d+10),k=c.getUint8(d+11),l=c.getUint8(d+12),m=c.getUint8(d+13);d+=Serializer.L0;for(var n={},o=0;m>o;o++){var p=c.getUint16(d+0),q=c.getUint8(d+2),r=c.getUint8(d+3),s=c.getUint32(d+4)/1e3;n[p]={h:q,m:r,t:s},d+=Serializer.L1}var t=ModeKey.get(Enum.fromXCode(LAYOUT,e),Enum.fromXCode(MODE_TYPE,f)),u=new Result(t,Math.round(1e3*g+h),j,i,k,l,n);b.push(u)}},Serializer.L0=14,Serializer.L1=8,Serializer.prototype.add=function(a){this.array.push(a),this.size+=Serializer.L0+Serializer.L1*Object.keys(a.histogram).length},Serializer.prototype.format=function(){var a=new ArrayBuffer(12+this.size+4),b=new DataView(a);b.setUint32(0,Sync.MESSAGE_SIGNATURE),b.setUint32(4,Sync.MESSAGE_VERSION),b.setUint32(8,this.array.length);for(var c=12,d=0;d<this.array.length;d++)c=this.write(this.array[d],b,c);return b.setUint32(c,crc32(new Uint8Array(a,0,c))),new Uint8Array(a)},Serializer.prototype.write=function(a,b,c){var d=Object.keys(a.histogram),e=d.length,f=a.timeStamp/1e3|0,g=a.timeStamp-1e3*f|0;b.setUint8(c+0,a.modeKey.layout.xid),b.setUint8(c+1,a.modeKey.modeType.xid),b.setUint32(c+2,f),b.setUint16(c+6,g),b.setUint16(c+8,a.time),b.setUint8(c+10,a.length),b.setUint8(c+11,a.errors),b.setUint8(c+12,a.complexity),b.setUint8(c+13,e),c+=Serializer.L0;for(var h=0;e>h;h++){var i=parseInt(d[h]),j=a.histogram[i];b.setUint16(c+0,i),b.setUint8(c+2,j.h),b.setUint8(c+3,j.m),b.setUint32(c+4,Math.round(1e3*j.t)),c+=Serializer.L1}return c},History.prototype.generateExampleData=function(){generateExampleData(function(a){this.delete(function(){for(var b=0;b<a.length;b++)this.add(a[b]);console.log("example data generated: "+a.length+" samples")}.bind(this))}.bind(this))};var ACH_ID=function(){return Object.freeze({MAX_SPEED:"max-speed",MAX_SCORE:"max-score",SPEED_STREAK:"speed-streak",SCORE_STREAK:"score-streak",ERRORS_STREAK:"errors-streak"})}(),ACH_VALUE=function(){return Object.freeze({SILVER:"silver",BRONZE:"gold",GOLD:"gold",RUBY:"ruby"})}();Achievement.prototype={equals:function(a){return this.id===a.id&&this.value===a.value},toString:function(){return this.value?"["+this.value+"] "+this.description():this.description()},description:function(){switch(this.id){case ACH_ID.MAX_SPEED:return"Top speed so far";case ACH_ID.MAX_SCORE:return"Best score so far";case ACH_ID.SPEED_STREAK:return"Increasing speed sequence";case ACH_ID.SCORE_STREAK:return"Increasing score sequence";case ACH_ID.ERRORS_STREAK:return"Sequence without errors"}throw new Error}},AchievementsAnalyzer.prototype={last:null,maxSpeed:0,maxScore:0,speedStreak:0,scoreStreak:0,errorsStreak:0,count:0,reset:function(){this.last=null,this.maxSpeed=0,this.maxScore=0,this.speedStreak=0,this.scoreStreak=0,this.errorsStreak=0,this.count=0},add:function(a){var b=[];return this.last&&(a.speed>=this.last.speed?(this.speedStreak++,7==this.speedStreak?b.push(new Achievement(ACH_ID.SPEED_STREAK,ACH_VALUE.GOLD)):5==this.speedStreak?b.push(new Achievement(ACH_ID.SPEED_STREAK,ACH_VALUE.BRONZE)):3==this.speedStreak&&b.push(new Achievement(ACH_ID.SPEED_STREAK,ACH_VALUE.SILVER))):this.speedStreak=0,a.score>=this.last.score?(this.scoreStreak++,7==this.scoreStreak?b.push(new Achievement(ACH_ID.SCORE_STREAK,ACH_VALUE.GOLD)):3==this.scoreStreak?b.push(new Achievement(ACH_ID.SCORE_STREAK,ACH_VALUE.BRONZE)):5==this.scoreStreak&&b.push(new Achievement(ACH_ID.SCORE_STREAK,ACH_VALUE.SILVER))):this.scoreStreak=0),0==a.errors?(this.errorsStreak++,17==this.errorsStreak?b.push(new Achievement(ACH_ID.ERRORS_STREAK,ACH_VALUE.RUBY)):12==this.errorsStreak?b.push(new Achievement(ACH_ID.ERRORS_STREAK,ACH_VALUE.GOLD)):8==this.errorsStreak?b.push(new Achievement(ACH_ID.ERRORS_STREAK,ACH_VALUE.BRONZE)):5==this.errorsStreak&&b.push(new Achievement(ACH_ID.ERRORS_STREAK,ACH_VALUE.SILVER))):this.errorsStreak=0,this.count>=10&&(a.speed>this.maxSpeed&&(this.maxSpeed=a.speed,b.push(new Achievement(ACH_ID.MAX_SPEED,null))),a.score>this.maxScore&&(this.maxScore=a.score,b.push(new Achievement(ACH_ID.MAX_SCORE,null)))),this.last=a,this.count++,b.length>0?{modeKey:a.modeKey,timeStamp:a.timeStamp,list:b}:null},analyze:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.add(d);e&&b.push(e)}return b}},StaticLesson.prototype={generate:function(){return this.generator.nextFragment()},update:function(){}},Lesson.MIN_TIME=300,Lesson.MAX_TIME=1e3,Lesson.WINDOW_SIZE=20,Lesson.prototype={includeCharSet:[],excludeCharSet:[],boost:null,generate:function(){if(this.includeCharSet.length){for(var a=[],b=0;b<this.includeCharSet.length;b++)a.push(this.includeCharSet[b].charCode);this.generator.subSet=a}else this.generator.subSet=null;return this.generator.boost=this.boost,this.generator.wordLimit=5+Math.round(4*this.settings.lesson.length),this.generator.fragmentLimit=50+Math.round(100*this.settings.lesson.length),this.generator.enableCapitals=this.settings.lesson.capitals,this.generator.enablePunctuators=this.settings.lesson.punctuators,this.generator.nextFragment()},update:function(a){var b=6,c=b+Math.round((this.charSet.length-b)*this.settings.lesson.complexity);this.includeCharSet=[],this.excludeCharSet=[],this.boost=null;for(var d=[],e=Object.create(null),f=0,g=0;g<this.charSet.length;g++){var h=this.charSet[g],i=a.map[h.charCode],j={charCode:h.charCode,t:i.movingMean.mean||i.statistics.mean,isConfident:i.isConfident(),confidenceLevel:i.confidenceLevel(),isForced:g>=b&&c>g,isBoosted:!1};b>g?(this.includeCharSet.push(j),j.isConfident||f++):j.isConfident?this.includeCharSet.push(j):(d.push(j),e[h.charCode]=j)}for(d.length>0&&1>f&&(j=d.shift(),this.includeCharSet.push(j));d.length>0;)j=d.shift(),j.isForced?this.includeCharSet.push(j):this.excludeCharSet.push(j);var k=this.includeCharSet.filter(function(a){return null==a.confidenceLevel||a.confidenceLevel<1});k.length>0&&(k.sort(function(a,b){var c=a.confidenceLevel||0,d=b.confidenceLevel||0;return c==d?b.f-a.f:c-d}),j=k.shift(),j.isBoosted=!0,this.boost={charCode:j.charCode,factor:this.generator.getBoostFactor(j.charCode)})}},LessonUi.COLOR_MIN_CONFIDENCE=new Color(13369344),LessonUi.COLOR_MAX_CONFIDENCE=new Color(7334996),LessonUi.confidenceColor=function(a){if(null==a)return new Color(14540253);var b=LessonUi.COLOR_MIN_CONFIDENCE,c=LessonUi.COLOR_MAX_CONFIDENCE;return new Color(Math.round((c.r-b.r)*a+b.r),Math.round((c.g-b.g)*a+b.g),Math.round((c.b-b.b)*a+b.b))},Result.toJson=function(a){return{l:a.modeKey.layout.id,m:a.modeKey.modeType.id,ts:a.timeStamp,n:a.length,t:a.time,e:a.errors,c:a.complexity,h:a.histogram}},Result.fromJson=function(a){return new Result(ModeKey.get(a.l,a.m),a.ts,a.n,a.t,a.e,a.c,a.h)},Fragment.prototype.reset=function(){this.started=null,this.finished=null,this.errors=0,this.position=0,this.buffer=[],this.errorPos=[],this.histogram=Object.create(null),this.lastKeyTime=0,this.keyTimesMap=Object.create(null),this.result=null},Fragment.prototype.put=function(a){if(0==this.position&&(13==a||32==a))return!1;var b=this.position;if(8==a)this.back();else{null==this.started&&(this.started=this.getTime());var c=this.advance(a);c===!0&&sounds.play("click"),c===!1&&sounds.play("blip")}if(this.isCompleted()){this.finished=this.getTime();for(var d in this.histogram){var e=this.histogram[d],f=this.keyTimesMap[d];if(f){for(var g=0,h=0;h<f.length;h++)g+=f[h];g/=f.length,e.t=Math.round(1e3*g)/1e3}}var i=this.finished-this.started;this.result=new Result(this.modeKey,this.started,this.text.length,i,this.errors,this.complexity,this.histogram)}return b!=this.position},Fragment.prototype.getTime=function(){return Date.now()},Fragment.prototype.isCompleted=function(){return this.position==this.text.length},Fragment.prototype.nextChar=function(){return this.position<this.text.length?this.text.charCodeAt(this.position):0},Fragment.prototype.back=function(){this.lastKeyTime=0,this.position>0&&this.position--,this.buffer=[];for(var a=this.errorPos.length;a>0;a--){var b=this.errorPos[a-1];if(b<this.position)break}this.errorPos.splice(a)},Fragment.prototype.advance=function(a){var b=3,c=this.text.charCodeAt(this.position);if(0==this.buffer.length){if(c==a)return this.hit(c),this.measureTime(c),this.position++,!0;this.errors++,this.errorPos.push(this.position)}this.lastKeyTime=0,this.buffer.push(a);var d;if(this.position+b<this.text.length&&this.buffer.length==b&&this.isSkipped()){for(this.miss(c),d=0;d<this.buffer.length;d++)this.hit(this.buffer[d]);return this.buffer=[],this.position+=b+1,this.lastKeyTime=__now(),null}if(this.position+b<this.text.length&&this.buffer.length==b+1&&this.isReplaced()){for(this.miss(c),d=1;d<this.buffer.length;d++)this.hit(this.buffer[d]);return this.buffer=[],this.position+=b+1,this.lastKeyTime=__now(),null}if(c==a){for(d=0;d<this.buffer.length-1;d++)this.miss(c);return this.hit(c),this.buffer=[],this.position++,this.lastKeyTime=__now(),!0}return!1},Fragment.prototype.isSkipped=function(){for(var a=0;a<this.buffer.length;a++){var b=this.text.charCodeAt(this.position+1+a);if(b!=this.buffer[a])return!1}return!0},Fragment.prototype.isReplaced=function(){for(var a=1;a<this.buffer.length;a++){var b=this.text.charCodeAt(this.position+a);if(b!=this.buffer[a])return!1}return!0},Fragment.prototype.hit=function(a){var b=this.histogram[a];b||(this.histogram[a]=b={h:0,m:0,t:0}),b.h++},Fragment.prototype.miss=function(a){var b=this.histogram[a];b||(this.histogram[a]=b={h:0,m:0,t:0}),b.m++},Fragment.prototype.measureTime=function(a){var b=__now();if(this.lastKeyTime>0){var c=this.keyTimesMap[a];c||(this.keyTimesMap[a]=c=[]),c.push(b-this.lastKeyTime)
}this.lastKeyTime=b},FragmentUi.prototype={attach:function(a){a.appendChild(this.fragmentEl)},detach:function(){this.fragmentEl.parentNode.removeChild(this.fragmentEl)},updateUi:function(){var a,b,c,d=this.fragment.text,e=this.fragment.position,f=this.fragment.errorPos,g=-1;for(a=0;e>a;a++)c=this.itemEl[a],c.classList.add("down"),c.classList.remove("cursor");for(a=e;a<d.length;a++)c=this.itemEl[a],c.classList.remove("down"),a==e?c.classList.add("cursor"):c.classList.remove("cursor");for(a=0,b=0;a<d.length;a++){if(c=this.itemEl[a],a>g)for(;b<f.length&&(g=f[b],!(g>=a));b++);g==a&&g!=e?c.classList.add("error"):c.classList.remove("error")}},createShakeAnimation:function(){return new FragmentShakeAnimation(this.itemEl)}},LessonDetailsUi.prototype={update:function(a,b){function c(b){var c=["Character '"+keyName(b)+"'"];if(b.t?(c.push("Typing speed: "+round(g.fromTime(b.t),1)+g.id),c.push("Time to type: "+round(b.t,1)+"ms"),c.push("Confidence level: "+round(b.confidenceLevel,100))):c.push("Not calibrated"),b.isBoosted){var d=a.map[b.charCode];if(d.t.length>=10){var e=d.learningRate(g),f="~"+String(round(e.perSample,1e3))+g.id+"/sample",h="~"+String(round(e.perHour,1))+g.id+"/hour";c.push("Learning rate: "+f+", "+h)}c.push("Boosted frequency")}return b.isForced&&c.push("Added by user"),c.join("; ")}var d,e,f,g=b.settings.speedUnit;if(this.$el.empty(),b.includeCharSet&&b.excludeCharSet){if(b.includeCharSet.length){var h=$("<span></span>").addClass("include");for(d=0;d<b.includeCharSet.length;d++)e=b.includeCharSet[d],f=$("<span></span>").addClass("key").css("background-color",String(LessonUi.confidenceColor(e.confidenceLevel))).text(keyName(e)).attr("title",c(e)).data("item",e),e.isForced&&f.addClass("forced"),e.isBoosted&&f.addClass("boosted"),h.append(f);this.$el.append(h)}if(b.excludeCharSet.length){var i=$("<span></span>").addClass("exclude");for(d=0;d<b.excludeCharSet.length;d++)e=b.excludeCharSet[d],f=$("<span></span>").addClass("key").css("background-color","#F3F3F3").text(keyName(e)).attr("title",c(e)).data("item",e),i.append(f);this.$el.append(i)}}else this.$el.append($("<span></span>").text("manual mode"))}},FragmentShakeAnimation.prototype={init:function(){for(var a=0;a<this.elArray.length;a++){var b=this.elArray[a];b._anim={x:b.offsetLeft,y:b.offsetTop,rx:Math.randomInt(5,20)*(Math.randomInt(0,1)>0?1:-1),ry:Math.randomInt(5,20)*(Math.randomInt(0,1)>0?1:-1),sx:Math.randomInt(80,200),sy:Math.randomInt(80,200)}}for(a=0;a<this.elArray.length;a++)b=this.elArray[a],b.style.position="absolute"},step:function(a){for(var b=0;b<this.elArray.length;b++){var c=this.elArray[b],d=c._anim,e=d.x+Math.sin(a/d.sx)*d.rx,f=d.y+Math.cos(a/d.sy)*d.ry;c.style.left=e+"px",c.style.top=f+"px"}},reset:function(){for(var a=0;a<this.elArray.length;a++){var b=this.elArray[a];delete b._anim,b.style.position="",b.style.left="",b.style.top=""}}};var Game=function(){function a(){m.text("0"),n.text("0"),o.text("0"),p.text("0"),q.text("0"),r.text("0"),l.empty(),s.text("-"),t.text("-")}function b(a,b){0>b?(b=round(b,1e3),a.text(b),a.removeClass("more"),a.addClass("less")):(b=round(b,1e3),a.text("+"+b),a.removeClass("less"),a.addClass("more"))}function c(a){if(l.empty(),a)for(var b=0;b<a.list.length;b++){var c=a.list[b],d=$("<div></div>").addClass("badge");d.attr("title",c),d.addClass(c.id),d.addClass(c.value),d.addClass("animated"),d.addClass("shake"),l.append(d)}}function d(a){if(s.empty(),0==a.length)s.text("-");else for(var b=0;b<a.length;b++){var c=a[b];if(c.charCode>32){var d=$("<span></span>").addClass("name").text(keyName(c)+":"),e=$("<span></span>").addClass("value"),f=String(round(c.delta,1));c.delta<0?(e.addClass("less"),e.text(f)):(e.addClass("more"),e.text("+"+f));var g=$("<span></span>").addClass("key");g.append(d),g.append(e),s.append(g)}}}function e(a,b){new LessonDetailsUi(t).update(a,b)}function f(a,b,c){this.settings=a,this.history=b,this.lesson=c,this.data=b.get(this.settings.modeKey),this.forecast=new Forecast(this.lesson.charSet,this.data),this.analyzer=new AchievementsAnalyzer,this.analyzer.analyze(this.data)}function g(a){this.settings=a,this.history=new History(global.auth.id)}var h,i=(document.getElementById("game"),document.getElementById("text")),j=document.getElementById("layout"),k=document.getElementById("overlay"),l=$("#g-achievements"),m=$("#g-speed"),n=$("#g-speed-gain"),o=$("#g-errors"),p=$("#g-errors-gain"),q=$("#g-score"),r=$("#g-score-gain"),s=$("#g-key-times-gain"),t=$("#g-lesson-details");return f.prototype={update:function(){this.lesson.update(this.forecast),e(this.forecast,this.lesson)},add:function(a,e){for(var f=this.data.statistics(),g=[],h=0;h<this.lesson.charSet.length;h++){var i=this.lesson.charSet[h],j=this.forecast.map[i.charCode],k=a.histogram[i.charCode];if(k&&k.t>0){var l=k.t,s=j.movingMean.mean||j.statistics.mean;l&&s&&g.push({charCode:i.charCode,delta:s-l})}}g.sort(function(a,b){return b.delta-a.delta}),this.forecast.add(a);var t=this.analyzer.add(a),u=this.settings.speedUnit,v=a.speed-f.avgSpeed,w=a.score-f.avgScore,x=-(a.errors-f.avgErrors);m.text(Math.round(u.measure(a.speed))),o.text(Math.round(a.errors)),q.text(Math.round(a.score)),b(n,u.measure(v)),b(r,w),b(p,x),c(t),d(g),t&&t.list.length?sounds.play("tada"):0==a.errors&&sounds.play("correct"),this.history.add(a,function(){e()}.bind(this))}},g.prototype={settings:null,history:null,lesson:null,fragment:null,progressNotifier:null,handler:null,keyboardUi:null,fragmentUi:null,active:!1,shake:null,init:function(a){h=window.setInterval(function(){i.classList.toggle("blink")},300),window.addEventListener("blur",function(){this.reset(),document.body.classList.add("pause")}.bind(this)),window.addEventListener("focus",function(){this.reset(),document.body.classList.remove("pause")}.bind(this)),document.addEventListener("keydown",function(a){this.active&&this.keyDown(new CustomKeyboardEvent(a))}.bind(this),!0),document.addEventListener("keyup",function(a){this.active&&this.keyUp(new CustomKeyboardEvent(a))}.bind(this),!0),document.addEventListener("reveal-page",function(a){"#game"==a.detail.url?this.unpause():this.pause()}.bind(this)),this.keyboardUi=new KeyboardUi,this.history.open(function(){a()}.bind(this))},start:function(a){this.lesson=a,this.settings.layout.configure(this.settings),this.keyboardUi.init(j,this.settings.layout,!0),this.progressNotifier=new f(this.settings,this.history,this.lesson),sounds.init(this.settings),this.next()},reset:function(){this.fragment&&(this.fragment.reset(),this._update(this.fragment))},next:function(){this._update(null)},_update:function(a){this.progressNotifier.update(),this.fragment=a?a:new Fragment(this.settings.modeKey,this.lesson);var b=function(a){this.fragment.put(a)}.bind(this);this.handler=this.settings.layout.createEventHandler(b),this.fragmentUi&&this.fragmentUi.detach(),this.fragmentUi=new FragmentUi(this.lesson,this.fragment),this.fragmentUi.attach(i),this.keyboardUi.reset(),this.highlight(),this.delayShake()},completed:function(a){this.progressNotifier.add(a,function(){this.next()}.bind(this)),document.dispatchEvent(new CustomEvent("fragment-complete",{detail:{result:a},bubbles:!0,cancelable:!1}))},highlight:function(){this.keyboardUi.highlight(k,this.fragment.nextChar())},pause:function(){this.active=!1,this.cancelShake()},unpause:function(){this.active=!0,a(),this.reset()},timeoutId:null,delayShake:function(){this.cancelShake(),this.timeoutId=window.setTimeout(function(){this.kickShake()}.bind(this),3e4)},kickShake:function(){this.cancelShake(),document.body.classList.add("shake"),this.shake=new Shake([this.keyboardUi.createShakeAnimation(),this.fragmentUi.createShakeAnimation()]),this.shake.start()},cancelShake:function(){this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),document.body.classList.remove("shake"),this.shake&&(this.shake.cancel(),this.shake=null)},lastKeyCode:-1,keyDown:function(a){this.lastKeyCode!=a.keyCode&&(this.lastKeyCode=a.keyCode,this.shake?(this.cancelShake(),this.reset()):(this.keyboardUi.keyDown(a),a.keyCode==VK.ESCAPE?this.kickShake():a.keyCode==VK.LEFT&&a.ctrlKey?(this.reset(),a.preventDefault(),a.stopPropagation()):a.keyCode==VK.RIGHT&&a.ctrlKey?(this.next(),a.preventDefault(),a.stopPropagation()):VK.isSpecialKey(a)||(this.handler.keyDown(a),this.fragmentUi.updateUi(),this.highlight(),this.fragment.isCompleted()&&this.completed(this.fragment.result),this.delayShake(),a.preventDefault(),a.stopPropagation())))},keyUp:function(a){this.lastKeyCode==a.keyCode&&(this.lastKeyCode=-1),this.keyboardUi.keyUp(a),this.handler.keyUp(a)}},g}();Shake.prototype={start:function(){this._init(),this._schedule()},cancel:function(){this._unschedule(),this._reset()},_timerId:null,_schedule:function(){this._timerId=window.requestAnimationFrame(function(a){this._step(a)}.bind(this))},_unschedule:function(){this._timerId&&(window.cancelAnimationFrame(this._timerId),this._timerId=null)},_init:function(){for(var a=0;a<this.a.length;a++)this.a[a].init()},_started:null,_n:0,_step:function(a){var b;null===this._started&&(this._started=a),this._n++,b=a-this._started;for(var c=0;c<this.a.length;c++)this.a[c].step(b);if(this._schedule(),100==this._n){this._n/b*1e3}},_reset:function(){for(var a=0;a<this.a.length;a++)this.a[a].reset()}},ShakeAnimation.prototype={init:function(){},step:function(){},reset:function(){}};var shape={empty:{w:0,h:0,p:[]},invader:{w:11,h:8,p:[{y:0,x:1},{y:0,x:8},{y:1,x:3},{y:1,x:7},{y:2,x:2},{y:2,x:3},{y:2,x:4},{y:2,x:5},{y:2,x:6},{y:2,x:7},{y:2,x:8},{y:3,x:1},{y:2,x:2},{y:3,x:4},{y:3,x:5},{y:3,x:6},{y:3,x:8},{y:3,x:9},{y:4,x:0},{y:4,x:1},{y:4,x:2},{y:4,x:3},{y:4,x:4},{y:4,x:5},{y:4,x:6},{y:4,x:7},{y:4,x:8},{y:4,x:9},{y:4,x:10},{y:5,x:0},{y:5,x:2},{y:5,x:3},{y:5,x:4},{y:5,x:5},{y:5,x:6},{y:5,x:7},{y:5,x:8},{y:5,x:10},{y:6,x:0},{y:6,x:2},{y:6,x:8},{y:6,x:10},{y:7,x:3},{y:7,x:4},{y:7,x:6},{y:7,x:7}]}};!function(){if(!("__killme__"in window)){polyfill();var a="\n      ___      __   __     __   __        \n|__/ |__  \\ / |__) |__)   /    /  \\  |\\/| \n|  \\ |___  |  |__) |  \\ . \\__  \\__/  |  | \n\n";console.log(a);try{var b=window.document.domain;"string"==typeof b&&b.startsWith("www.")&&(Cookies.defaults.domain=window.document.domain=b=b.substring(4))}catch(c){console.log(c)}if(!("__test__"in window)){SVG.eid=function(a){return"svg-"+a+"-"+(SVG.did++).toString(36)};var d=new ParamMap;if(!d.flag("noinit")){var e=clientId();init(e,d)}}}}(),function(a){function b(a,b){this.container=a,this.options=b,this.init()}function c(b,c){this.widget=b,this.options=a.extend({},c),this.detectService(),this.service&&this.init()}function d(a){function b(a,b){return b.toUpper()}var c={},d=a.data();for(var e in d){var f=d[e];"yes"===f?f=!0:"no"===f&&(f=!1),c[e.replace(/-(\w)/g,b)]=f}return c}function e(a,b){return f(a,b,encodeURIComponent)}function f(a,b,c){return a.replace(/\{([^\}]+)\}/g,function(a,d){return d in b?c?c(b[d]):b[d]:a})}function g(a,b){var c=k+a;return c+" "+c+"_"+b}function h(b){function c(f){"keydown"===f.type&&27!==f.which||a(f.target).closest(b).length||(b.removeClass(l),d.off(e,c))}var d=a(document),e="click touchstart keydown";d.on(e,c)}function i(a,b){if(document.documentElement.getBoundingClientRect){var c=parseInt(a.css("left"),10),d=parseInt(a.css("top"),10),e=a[0].getBoundingClientRect();e.left<b?a.css("left",b-e.left+c):e.right>window.innerWidth-b&&a.css("left",window.innerWidth-e.right-b+c),e.top<b?a.css("top",b-e.top+d):e.bottom>window.innerHeight-b&&a.css("top",window.innerHeight-e.bottom-b+d)}a.addClass(l)}var j="social-likes",k=j+"__",l=j+"_opened",m={facebook:{counterUrl:"http://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(a){return a.data[0].total_count},popupUrl:"http://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"http://urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){return/[\.:\-–—]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},plusone:{counterUrl:"http://share.yandex.ru/gpp.xml?url={url}",counter:function(b,c){var d=m.plusone;return d._?void c.reject():(window.services||(window.services={}),window.services.gplus={cb:function(a){d._.resolve(a)}},d._=c,void a.getScript(e(b)).fail(c.reject))},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:"http://api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},n={promises:{},fetch:function(b,c,d){n.promises[b]||(n.promises[b]={});var f=n.promises[b];if(f[c])return f[c];var g=a.extend({},m[b],d),h=a.Deferred(),i=g.counterUrl&&e(g.counterUrl,{url:c});return a.isFunction(g.counter)?g.counter(i,h):g.counterUrl?a.getJSON(i).done(function(b){try{var c=b;a.isFunction(g.convertNumber)&&(c=g.convertNumber(b)),h.resolve(c)}catch(d){h.reject()}}).fail(h.reject):h.reject(),f[c]=h.promise(),f[c]}};a.fn.socialLikes=function(c){return this.each(function(){var e=a(this);new b(e,a.extend({},a.fn.socialLikes.defaults,c,d(e)))})},a.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:!0,zeroes:!1,wait:500,singleTitle:"Share"},b.prototype={init:function(){this.container.addClass(j),this.single=this.container.hasClass(j+"_single"),this.initUserButtons(),this.number=0,this.container.on("counter."+j,a.proxy(this.updateCounter,this));var b=this.container.children();this.countersLeft=b.length,this.makeSingleButton(),b.each(a.proxy(function(b,d){new c(a(d),this.options)},this)),this.options.counters?this.timer=setTimeout(a.proxy(this.appear,this),this.options.wait):this.appear()},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&a.extend(!0,m,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){if(this.single){var b=this.container;b.addClass(j+"_vertical"),b.wrap(a("<div>",{"class":j+"_single-w"}));var c=b.parent(),d=parseInt(b.css("left"),10),e=parseInt(b.css("top"),10),m=a("<div>",{"class":g("widget","single")}),n=a(f('<div class="{buttonCls}"><span class="{iconCls}"></span>{title}</div>',{buttonCls:g("button","single"),iconCls:g("icon","single"),title:this.options.singleTitle}));m.append(n),c.append(m),m.click(function(){return b.css({left:d,top:e}),i(b,20),h(b),!1});var o=a("<div>",{"class":k+"close",html:"&times;"});b.append(o),o.click(function(){b.removeClass(l)}),this.widget=m}},updateCounter:function(a,b,c){c&&(this.number+=c,this.single&&this.getCounterElem().text(this.number)),this.countersLeft--,0===this.countersLeft&&(this.appear(),this.container.addClass(j+"_ready"),this.container.trigger("ready."+j,this.number))},appear:function(){this.container.addClass(j+"_visible")},getCounterElem:function(){var b=this.widget.find("."+k+"counter_single");return b.length||(b=a("<span>",{"class":g("counter","single")}),this.widget.append(b)),b}},c.prototype={init:function(){if(this.detectParams(),this.initHtml(),this.options.counters)if(this.options.counterNumber)this.updateCounter(this.options.counterNumber);else{var b=this.options.counterUrl?{counterUrl:this.options.counterUrl}:{};n.fetch(this.service,this.options.url,b).always(a.proxy(this.updateCounter,this))}},detectService:function(){for(var b=this.widget[0].classList||this.widget[0].className.split(" "),c=0;c<b.length;c++){var d=b[c];if(m[d])return this.service=d,void a.extend(this.options,m[d])}},detectParams:function(){var a=this.widget.data();if(a.counter){var b=parseInt(a.counter,10);isNaN(b)?this.options.counterUrl=a.counter:this.options.counterNumber=b}a.title&&(this.options.title=a.title),a.url&&(this.options.url=a.url)},initHtml:function(){var b=this.options,c=this.widget,d=c.find("a");d.length&&this.cloneDataAttrs(d,c);var f=a("<span>",{"class":this.getElementClassNames("button"),text:c.text()});if(b.clickUrl){var g=e(b.clickUrl,{url:b.url,title:b.title}),h=a("<a>",{href:g});this.cloneDataAttrs(c,h),c.replaceWith(h),this.widget=c=h}else c.click(a.proxy(this.click,this));c.removeClass(this.service),c.addClass(this.getElementClassNames("widget")),f.prepend(a("<span>",{"class":this.getElementClassNames("icon")})),c.empty().append(f),this.button=f},cloneDataAttrs:function(a,b){var c=a.data();for(var d in c)c.hasOwnProperty(d)&&b.data(d,c[d])},getElementClassNames:function(a){return g(a,this.service)},updateCounter:function(b){if(b=parseInt(b,10)||0,b||this.options.zeroes){var c=a("<span>",{"class":this.getElementClassNames("counter"),text:b});this.widget.append(c)}this.widget.trigger("counter."+j,[this.service,b])},click:function(b){var c=this.options,d=!0;if(a.isFunction(c.click)&&(d=c.click.call(this,b)),d){var f=e(c.popupUrl,{url:c.url,title:c.title});f=this.addAdditionalParamsToUrl(f),this.openPopup(f,{width:c.popupWidth,height:c.popupHeight})}return!1},addAdditionalParamsToUrl:function(b){var c=a.param(this.widget.data());if(!c)return b;var d=-1===b.indexOf("?")?"?":"&";return b+d+c},openPopup:function(a,b){var c=Math.round(screen.width/2-b.width/2),d=0;screen.height>b.height&&(d=Math.round(screen.height/3-b.height/2));var e=window.open(a,"sl_"+this.service,"left="+c+",top="+d+",width="+b.width+",height="+b.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");e?e.focus():location.href=a}},a(function(){a("."+j).socialLikes()})}(jQuery);
//# sourceMappingURL=js.min.map