!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}function b(a,b){return Math.round(a*b)/b}function c(a){switch(a){case 59:return 186;case 61:return 187;case 173:return 189}return a}function d(a){return a.ctrlKey||a.metaKey||16==a.keyCode||17==a.keyCode||18==a.keyCode||224==a.keyCode||20==a.keyCode||93==a.keyCode||112==a.keyCode||113==a.keyCode||114==a.keyCode||115==a.keyCode||116==a.keyCode||117==a.keyCode||118==a.keyCode||119==a.keyCode||120==a.keyCode||121==a.keyCode||122==a.keyCode||123==a.keyCode||124==a.keyCode||125==a.keyCode||126==a.keyCode||127==a.keyCode||45==a.keyCode||36==a.keyCode||33==a.keyCode||46==a.keyCode||35==a.keyCode||34==a.keyCode||38==a.keyCode||37==a.keyCode||40==a.keyCode||39==a.keyCode||144==a.keyCode||145==a.keyCode}function e(a,b,c,d,e){a[b]=new I(b,c,d,e)}function f(a){e(a,H.COMBINING_DIACRITIC_ACUTE,H.DIACRITIC_ACUTE,"AaCcEeGgIiKkLlMmNnOoPpRrSsUuWwYyZz","ÁáĆćÉéǴǵÍíḰḱĹĺḾḿŃńÓóṔṕŔŕŚśÚúẂẃÝýŹź"),e(a,H.COMBINING_DIACRITIC_DOUBLE_ACUTE,H.DIACRITIC_DOUBLE_ACUTE,"OoUu","ŐőŰű"),e(a,H.COMBINING_DIACRITIC_CEDILLA,H.DIACRITIC_CEDILLA,"CcDdEeGgHhKkLlNnRrSsTt","ÇçḐḑȨȩĢģḨḩĶķĻļŅņŖŗŞşŢţ"),e(a,H.COMBINING_DIACRITIC_CIRCUMFLEX,H.DIACRITIC_CIRCUMFLEX,"AaCcEeGgHhIiJjOoSsUuWwYyZz","ÂâĈĉÊêĜĝĤĥÎîĴĵÔôŜŝÛûŴŵŶŷẐẑ"),e(a,H.COMBINING_DIACRITIC_DIAERESIS,H.DIACRITIC_DIAERESIS,"AaEeHhIiOotUuWwXxYy","ÄäËëḦḧÏïÖöẗÜüẄẅẌẍŸÿ"),e(a,H.COMBINING_DIACRITIC_GRAVE,H.DIACRITIC_GRAVE,"AaEeIiNnOoUuWwYy","ÀàÈèÌìǸǹÒòÙùẀẁỲỳ"),e(a,H.COMBINING_DIACRITIC_TILDE,H.DIACRITIC_TILDE,"AaEeIiNnOoUuVvYy","ÃãẼẽĨĩÑñÕõŨũṼṽỸỹ")}function g(a){var b=[];for(var c in a)b.push(a[c]);return b}function h(){function a(a){for(var b="abcdefghijklmnopqrstuvwxyz0123456789",c="",d=0;a>d;d++)c+=b.charAt(B.int(b.length));return c}function b(a){return void 0==a||null==a?a:a.trim()}var c=b(E.get("cid")),d=b(window.localStorage.getItem("cid")),e=null;return e=c&&d?d=c:c?d=c:c=d?d:d=a(10),E.set("cid",e),window.localStorage.setItem("cid",e),e}function i(a,b,c){for(var d="",e="",f=0;f<a.length;f++){var g=a.charCodeAt(f);if(H.isNl(g))e=""==d?"":"\n";else if(H.isWs(g))""==d?e="":"\n"!=e&&(e=" ");else{d+=e,e="";var h=String.fromCharCode(g);switch(g){case 8210:case 8211:case 8212:case 8213:g=45,h="-";break;case 8216:case 8217:case 8218:g=39,h="'";break;case 8220:case 8221:case 8222:case 171:case 187:g=34,h='"';break;case 8230:g=0,h="..."}if(null!=c&&-1!=c.indexOf(g))continue;(null==b||-1!=b.indexOf(g))&&(d+=h)}}return d}function j(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(-1!=b.indexOf(d))throw new Error("duplicate char code "+d);b.push(d)}return b}function k(a){return"object"==typeof a&&(a=a.charCode),String.fromCharCode(a).toUpperCase()}function l(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(d,a.charCodeAt(d)));return c}function m(a){$("#ctl-reset").on("click",function(){a.reset()}),$("#ctl-skip").on("click",function(){a.next()}),$("#vote-box-close").on("click",function(){$("#vote-box").fadeOut()})}function n(b){function c(a){function b(){X.load(p.layout,function(a){var b=new Rb(p,a),c=q.get(xb.get2(p.layout,sb.AUTO)),d=new Ob(b.letters,c);b.update(d),new Sb(s).update(d,b),t.text(b.generate())})}U&&(window.clearTimeout(U),U=null),a?b():U=window.setTimeout(function(){U=null,b()},100)}function d(){N.text(p.speedUnit.id),N.attr("title",p.speedUnit.title),O.attr("title",p.speedUnit.title)}function e(){c(!0)}function f(){}function g(){}function h(){}function i(){}function j(){}function k(){switch(R.reveal("_form-1"),u.val(String(Math.round(100*p.lesson.complexity))),v.val(String(Math.round(100*p.lesson.length))),w.attr({checked:p.lesson.capitals}),x.attr({checked:p.lesson.punctuators}),y.val(p.textConfig.url),z.val(p.textConfig.text),A.attr({checked:p.textConfig.mangle.simplify}),B.attr({checked:p.textConfig.mangle.lowercase}),p.mode){case ub.GUIDED:S.reveal("_fieldset-mode-1");break;case ub.IMPORT_WEBSITE:S.reveal("_fieldset-mode-2");break;case ub.IMPORT_TEXT:S.reveal("_fieldset-mode-3")}switch(p.speedUnit){case wb.WPM:K.attr({checked:!0}),L.attr({checked:!1});break;default:K.attr({checked:!1}),L.attr({checked:!0})}M.attr({checked:p.enableSound}),T.reset(),P.reset(),document.addEventListener("keydown",V,!0),document.addEventListener("keyup",W,!0)}function l(){document.removeEventListener("keydown",V,!0),document.removeEventListener("keyup",W,!0)}function m(){switch(p.layout=T.layout,p.emulateLayout=T.emulateLayout,S.mode){case"_fieldset-mode-1":p.mode=ub.GUIDED;break;case"_fieldset-mode-2":p.mode=ub.IMPORT_WEBSITE;break;case"_fieldset-mode-3":p.mode=ub.IMPORT_TEXT}return p.lesson.capitals=w.is(":checked"),p.lesson.punctuators=x.is(":checked"),p.textConfig.url=y.val().trim(),p.textConfig.text=z.val().trim(),p.textConfig.mangle.simplify=A.is(":checked"),p.textConfig.mangle.lowercase=B.is(":checked"),p.speedUnit=K.is(":checked")?wb.WPM:wb.CPM,p.enableSound=M.is(":checked"),d(),n()}function n(){switch(p.mode){case ub.IMPORT_WEBSITE:if(0==p.textConfig.url.length)return R.reveal("_form-1"),S.reveal("_fieldset-mode-2"),y.focus(),!1;break;case ub.IMPORT_TEXT:if(0==p.textConfig.text.length)return R.reveal("_form-1"),S.reveal("_fieldset-mode-3"),z.focus(),!1}return!0}var o=function(){var a='Jabberwocky\n\n\'Twas brillig, and the slithy toves\nDid gyre and gimble in the wabe;\nAll mimsy were the borogoves,\nAnd the mome raths outgrabe.\n\n"Beware the Jabberwock, my son!\nThe jaws that bite, the claws that catch!\nBeware the Jubjub bird, and shun\nThe frumious Bandersnatch!"\n\nHe took his vorpal sword in hand:\nLong time the manxome foe he sought-\nSo rested he by the Tumtum tree,\nAnd stood awhile in thought.\n\nAnd as in uffish thought he stood,\nThe Jabberwock, with eyes of flame,\nCame whiffling through the tulgey wood,\nAnd burbled as it came!\n\nOne, two! One, two! and through and through\nThe vorpal blade went snicker-snack!\nHe left it dead, and with its head\nHe went galumphing back.\n\n"And hast thou slain the Jabberwock?\nCome to my arms, my beamish boy!\nO frabjous day! Callooh! Callay!"\nHe chortled in his joy.\n\n\'Twas brillig, and the slithy toves\nDid gyre and gimble in the wabe;\nAll mimsy were the borogoves,\nAnd the mome raths outgrabe.',b="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut egestas libero non laoreet scelerisque. Mauris nec sodales velit. Quisque mattis eu nulla varius accumsan. Sed interdum erat eu justo sodales, vel hendrerit diam pretium. Phasellus lacus libero, scelerisque quis enim eget, tempus elementum massa. Aenean elementum nec magna at fringilla. Nam nisl eros, viverra et luctus eget, placerat non velit. Cras ante velit, mattis quis porttitor nec, pellentesque eu sem. Aenean blandit consectetur metus ut bibendum. Aliquam in suscipit erat. Praesent non vulputate tortor, ac semper diam.",c="Imagine all human beings swept off the face of the earth, excepting one man. Imagine this man in some vast city, New York or London. Imagine him on the third or fourth day of his solitude sitting in a house and hearing a ring at the door-bell!";return{jabberwocky:a,loremipsum:b,story:c}}(),p=b.settings,q=b.database,r=$("#_form-1"),s=($("#_form-2"),$("#_form-3"),$("#_lesson-details")),t=$("#_lesson-example"),u=$("#_range-lesson-complexity"),v=$("#_range-lesson-length"),w=$("#_cb-enable-capitals"),x=$("#_cb-enable-punctuators"),y=$("#_url"),z=$("#_text"),A=$("#_cb-simplify"),B=$("#_cb-lowercase"),C=$("#_t0"),D=$("#_t1"),E=$("#_t2"),F=C.find(".field-list"),H=$("#_language-list"),I=$("#_layout-list"),J=$("#_cb-emulate-layout"),K=$("#_rb-speed-unit-wpm"),L=$("#_rb-speed-unit-cpm"),M=$("#_cb-enable-sound"),N=$(".speed-unit-text"),O=$(".speed-unit-title"),P=new fb(document.getElementById("_keyboard-demo")),R={$items:$("ul.menu > li"),$forms:$("form.settings"),init:function(){var a=this;this.$items.on("click",function(b){var c=$(b.target);a.reveal(c.data("for"))})},reveal:function(a){switch(this.$items.each(function(b,c){var d=$(c);d.data("for")==a?d.addClass("active"):d.removeClass("active")}),this.$forms.each(function(b,c){var d=$(c);c.id==a?d.show():d.hide()}),a){case"_form-1":e();break;case"_form-2":f();break;case"_form-3":g();break;default:throw new Error("unknown id: "+a)}}};R.init();var S={mode:null,$items:r.find("input[name=mode]"),$forms:r.find("fieldset"),init:function(){var a=this;this.$items.on("click",function(b){var c=$(b.target);a.mode=c.val(),a.reveal(c.val())})},reveal:function(a){switch(this.$items.each(function(b,c){var d=$(c);d.attr(d.val()==a?{checked:!0}:{checked:!1})}),this.$forms.each(function(b,c){var d=$(c);c.id==a?d.show():d.hide()}),a){case"_fieldset-mode-1":C.append(F),h();break;case"_fieldset-mode-2":D.append(F),i();break;case"_fieldset-mode-3":E.append(F),j();break;default:throw new Error("unknown id: "+a)}}};S.init();var T={map:Object.create(null),layout:null,emulateLayout:null,init:function(){var a=this;this.languageList=new Q.DropDown(H);for(var b in qb){var c=qb[b],d=c.lang,e=this.map[d.id];null==e&&(this.map[d.id]=e=[],this.languageList.add(d.name,d.id)),e.push(c)}this.languageList.change=function(b,c){a.switchLanguage(c)},J.on("click",function(){a.emulateLayout=J.is(":checked"),a.update()})},reset:function(){this.layout=p.layout,this.emulateLayout=p.emulateLayout,this.switchLanguage(this.layout.lang),this.update()},switchLanguage:function(a){var b=this;I.empty();var c=$();$.each(this.map[a],function(a,d){var e=$("<span></span>").addClass("ui radio").text(d.name);I.append($("<li></li>").append(e)),c=c.add(e),d==b.layout&&e.addClass("checked"),e.on("click",function(){c.removeClass("checked"),e.addClass("checked"),b.layout=d,b.update()})})},update:function(){var a=this;this.languageList.select(this.layout.lang),this.layout.config.emulate=this.emulateLayout,P.init(this.layout),J.each(function(b,c){c.disabled=a.layout.variantOf?!1:!0,c.checked=a.emulateLayout})}};T.init();var U,V=function(a){P.keyDown(new G(a))},W=function(a){P.keyUp(new G(a))};u.on("change",function(){p.lesson.complexity=u.val()/100,c(!1)}),v.on("change",function(){p.lesson.length=v.val()/100,c(!1)}),w.on("change",function(){p.lesson.capitals=w.is(":checked"),c(!0)}),x.on("change",function(){p.lesson.punctuators=x.is(":checked"),c(!0)}),d(),r.find("a.example-url").on("click",function(a){return y.val($(a.target).data("url")),!1}),r.find("a.example-text").on("click",function(a){return z.val(o[$(a.target).data("name")]),!1}),$("#submit").on("click",function(){return m()&&document.dispatchEvent(a("settings-changed",{detail:{settings:p},bubbles:!0,cancelable:!1}))?(p.persist(),Pb.loadLesson(p,function(a){b.start(a)}),!0):!1}),document.addEventListener("reveal-page",function(a){"#settings"==a.detail.url&&k()}),document.addEventListener("hide-page",function(a){"#settings"==a.detail.url&&l()})}function o(a){function b(){e.init(a.settings.layout)}function c(){}var d=document.getElementById("keyboard-example"),e=new fb(d);document.addEventListener("reveal-page",function(a){"#help"==a.detail.url?b():c()})}function p(a){function c(a){var b=new Date;b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0);for(var c=b.getTime(),d=[],e=0;e<a.length;e++){var f=a[e];f.timeStamp>c&&d.push(f)}return d}function d(a){for(var b=Object.create(null),c=0;c<a.length;c++){var d=a[c],e=new O(d.timeStamp),f=b[e];void 0===f&&(b[e]=f={date:e,list:[]}),f.list.push(d)}return g(b).sort(function(a,b){return a.timeStamp-b.timeStamp})}function e(a){var b=$(a),c=b.width(),d=b.height();return b.attr("width",c=b.parent().width()),{width:c,height:d}}function f(a,b){a.plain("Not enough data").font({size:"30px",anchor:"middle"}).x(b.x(b.width/2)).cy(b.y(b.height/2)).fill("#999999")}function h(){var a=new Hb,b=a.analyze(_.data);if(x.empty(),b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.list.length;e++){var f=d.list[e];if(f.id!=Eb.MAX_SPEED&&f.id!=Eb.MAX_SCORE){var g=$("<div></div>").addClass("badge");g.attr("title",f+" "+new Date(d.timeStamp).toLocaleString()),g.addClass(f.id),g.addClass(f.value),x.append(g)}}}function i(){function a(){n.rect(h.width,h.height).move(h.x(0),h.y(0)).attr("class","f");for(var a=0;a<i.length;a++){var b=i[a];n.plain(k(b)).font({anchor:"middle"}).x(h.x(0)-20).cy(h.y(a*m)+j/2).attr("class","l")}n.plain(String(_.data.length)).font({size:"10px",anchor:"middle"}).x(h.x(h.width)).y(h.y(h.height)+3)}function b(){for(var a=0;a<i.length;a++)for(var b=i[a],c=0;c<_.data.length;c++){var d=_.data[c],e=d.histogram,f=e[b.charCode];if(f){var k=Nb.confidenceLevel(f.t),n=Sb.confidenceColor(k);g.fillStyle=n.toString(),g.fillRect(h.x(c*l),h.y(a*m),l,j)}}}$(K).empty();var c=e(K),d=SVG(K);d.size(c.width,c.height),d.clear(),e(J);var g=J.getContext("2d");g.clearRect(0,0,c.width,c.height);var h=new Xb(c,40,50),i=Lb.sort(_.letters,Lb.SORT_BY_FREQUENCY),j=8,l=Math.min(h.width/_.data.length,30),m=(h.height-j)/(i.length-1),n=d.group();a(),_.data.length>2?b():f(n,h)}function j(){function c(){function a(a){var c=["Character '"+k(a)+"'"];return a.t?(c.push("Typing speed: "+b(s.fromTime(a.t),1)+s.id),c.push("Time to type: "+b(a.t,1)+"ms"),c.push("Confidence level: "+b(a.confidenceLevel,100))):c.push("Not calibrated"),c.join("; ")}F.empty();for(var c=0;c<r.length;c++){var e=r[c],f=_.forecast.map[e.charCode],g={charCode:e.charCode,f:e.f,t:f.meanTime(),confidenceLevel:f.confidenceLevel(),isConfident:f.isConfident(),isForced:!1,isBoosted:!1},h=$("<span></span>").addClass("key").css("background-color",String(Sb.confidenceColor(g.confidenceLevel))).text(k(e)).attr("title",a(g)).data("item",g);F.append(h),t[e.charCode]=h}var i=F.children();i.on("click",function(a){d(_.charCode=$(a.target).data("item").charCode)})}function d(a){function c(a){return j.x(a/f.length*j.width)}function d(a){return j.y(j.height-a/r*j.height)}for(var e in t)t[e].removeClass("current");t[a].addClass("current");var f,h=_.forecast.map[a],k=s.fromTime(Rb.MIN_TIME),l=null,r=0;if(f=q?h.st:h.t,f.length>0&&(l=C.linearRegression(f.map(function(a){return s.fromTime(a)})),r=Math.max(l.max,k)),n.plain(String(b(r,1))+s.id),o.plain(String(b(r/2,1))+s.id),p.plain(String(h.t.length)),i.clearRect(0,0,g.width,g.height),f.length>0){var u=h.learningRate(s),v="~"+String(b(u.perSample,1e3))+s.id+"/sample",w="~"+String(b(u.perHour,1))+s.id+"/hour";G.text(v+", "+w),m.y(d(k));for(var x=Math.max(Math.min(j.width/f.length,12),6),y=0;y<f.length;y++){var z=f[y];i.fillStyle="#6FB48C",i.beginPath(),i.arc(c(y),d(s.fromTime(z)),x,0,2*Math.PI,!0),i.closePath(),i.fill()}i.lineWidth=14,i.strokeStyle="rgba(111,180,140,0.7)",i.beginPath(),i.moveTo(c(0),d(l.fn(0))),i.lineTo(c(f.length),d(l.fn(f.length))),i.stroke()}else G.text("-"),m.y(j.y(0))}$(M).empty();var g=e(M),h=SVG(M);h.size(g.width,g.height),h.clear(),e(L);var i=L.getContext("2d");i.clearRect(0,0,g.width,g.height);var j=new Xb(g,40,50),l=h.group(),m=l.line(j.x(0),j.y(0),j.x(j.width),j.y(0)).attr("class","threshold");l.rect(j.width,j.height).move(j.x(0),j.y(0)).attr("class","f"),l.line(j.x(0),j.y(.25*j.height),j.x(j.width),j.y(.25*j.height)).attr("class","f"),l.line(j.x(0),j.y(.5*j.height),j.x(j.width),j.y(.5*j.height)).attr("class","f"),l.line(j.x(0),j.y(.75*j.height),j.x(j.width),j.y(.75*j.height)).attr("class","f"),l.line(j.x(0),j.y(0),j.x(j.height),j.y(0)).attr("class","f"),l.line(j.x(.25*j.width),j.y(0),j.x(.25*j.width),j.y(j.height)).attr("class","f"),l.line(j.x(.5*j.width),j.y(0),j.x(.5*j.width),j.y(j.height)).attr("class","f"),l.line(j.x(.75*j.width),j.y(0),j.x(.75*j.width),j.y(j.height)).attr("class","f"),l.line(j.x(-20),j.y(j.height),j.x(j.width+20),j.y(j.height)).attr("class","f axis"),l.line(j.x(0),j.y(-20),j.x(0),j.y(j.height+20)).attr("class","f axis");var n=l.plain("?").font({size:"10px",anchor:"end"}).x(j.x(0)-3).cy(j.y(0)),o=l.plain("?").font({size:"10px",anchor:"end"}).x(j.x(0)-3).cy(j.y(j.height/2)),p=l.plain("?").font({size:"10px",anchor:"middle"}).x(j.x(j.width)).y(j.y(j.height)+3),q=H.is(":checked"),r=Lb.sort(_.letters,Lb.SORT_BY_FREQUENCY),s=a.settings.speedUnit,t=Object.create(null);c(),_.data.length>2?(0==_.charCode&&(_.charCode=r[0].charCode),d(_.charCode)):(G.text("-"),f(l,j))}function l(){function c(a){return l.x(a/s.length*l.width)}function d(a){return l.y(l.height-a/u.max*l.height)}function g(a){return l.y(l.height-a/v.max*l.height)}function h(){for(var a=Math.max(Math.min(l.width/s.length,12),6),b=0;b<s.length;b++){var e=c(b),f=d(s[b]),h=g(t[b]),i=Math.abs(f-h)<1;k.fillStyle="rgba(172,113,208,1)",k.beginPath(),k.arc(e,f,i?a+1:a,0,2*Math.PI,!0),k.closePath(),k.fill(),k.fillStyle="rgba(111,180,140,1)",k.beginPath(),k.arc(e,h,i?a-1:a,0,2*Math.PI,!0),k.closePath(),k.fill()}k.lineWidth=14,k.strokeStyle="rgba(172,113,208,0.7)",k.beginPath(),k.moveTo(c(0),d(u.fn(0))),k.lineTo(c(s.length),d(u.fn(s.length))),k.stroke(),k.lineWidth=14,k.strokeStyle="rgba(111,180,140,0.7)",k.beginPath(),k.moveTo(c(0),g(v.fn(0))),k.lineTo(c(s.length),g(v.fn(s.length))),k.stroke()}$(P).empty();var i=e(P),j=SVG(P);j.size(i.width,i.height),j.clear(),e(N);var k=N.getContext("2d");k.clearRect(0,0,i.width,i.height);var l=new Xb(i,40,50),m=j.group();m.rect(l.width,l.height).move(l.x(0),l.y(0)).attr("class","f"),m.line(l.x(0),l.y(.25*l.height),l.x(l.width),l.y(.25*l.height)).attr("class","f"),m.line(l.x(0),l.y(.5*l.height),l.x(l.width),l.y(.5*l.height)).attr("class","f"),m.line(l.x(0),l.y(.75*l.height),l.x(l.width),l.y(.75*l.height)).attr("class","f"),m.line(l.x(0),l.y(0),l.x(l.height),l.y(0)).attr("class","f"),m.line(l.x(.25*l.width),l.y(0),l.x(.25*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(.5*l.width),l.y(0),l.x(.5*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(.75*l.width),l.y(0),l.x(.75*l.width),l.y(l.height)).attr("class","f"),m.line(l.x(-20),l.y(l.height),l.x(l.width+20),l.y(l.height)).attr("class","f axis"),m.line(l.x(0),l.y(-20),l.x(0),l.y(l.height+20)).attr("class","f axis");var n=m.plain("?").font({size:"10px",anchor:"end"}).x(l.x(0)-3).cy(l.y(0)),o=m.plain("?").font({size:"10px",anchor:"end"}).x(l.x(0)-3).cy(l.y(l.height/2)),p=m.plain("?").font({size:"10px",anchor:"middle"}).x(l.x(l.width)).y(l.y(l.height)+3),q=I.is(":checked"),r=a.settings.speedUnit,s=_.data.map(function(a){return a.score}),t=_.data.map(function(a){return r.measure(a.speed)});q&&(s=C.MovingMean.smooth(Rb.WINDOW_SIZE,s),t=C.MovingMean.smooth(Rb.WINDOW_SIZE,t));var u=C.linearRegression(s),v=C.linearRegression(t);n.plain(String(b(v.max,1))+r.id),o.plain(String(b(v.max/2,1))+r.id),p.plain(String(_.data.length)),_.data.length>2?h():f(m,l)}function m(){function c(){for(var a=0,b=0;b<j.length;b++){var c=j[b],d=_.forecast.map[c.charCode],e=d.meanTime();e&&(a=Math.max(a,l.fromTime(e)))}return a}function d(){for(var a=0;a<j.length;a++){var c,d=j[a],e=_.forecast.map[d.charCode],f=e.meanTime(),g=i.x(a*n);if(f){var h=l.fromTime(f),q=h/o*i.height;p.rect(n-m,q).move(g,i.y(i.height-q)).attr("class","b").title(String(b(h,1))+l.id),c="l"}else c="l empty";p.plain(k(j[a])).font({anchor:"middle"}).move(g+n/2-m/2,i.y(i.height)).attr("class",c)}}$(R).empty();var g=e(R),h=SVG(R);h.size(g.width,g.height),h.clear();var i=new Xb(g,40,50),j=Lb.sort(_.letters,Lb.SORT_BY_INDEX),l=a.settings.speedUnit,m=5,n=(i.width+m)/j.length,o=c(),p=h.group(),q=h.group();q.rect(i.width,i.height).move(i.x(0),i.y(0)).attr("class","f"),q.plain(String(b(o,1))+l.id).font({size:"10px",anchor:"end"}).x(i.x(0)-3).cy(i.y(0)),q.plain(String(b(o/2,1))+l.id).font({size:"10px",anchor:"end"}).x(i.x(0)-3).cy(i.y(i.height/2)),_.data.length>0?d():f(q,i)}function n(){$(S).empty();var a=e(S),c=SVG(S);c.size(a.width,a.height),c.clear();var d=new Xb(a,40,50),g=Lb.sort(_.letters,Lb.SORT_BY_INDEX),h=5,i=(d.width+h)/g.length,j=.5*d.height,l=.25*d.height-10,m=.25*d.height-10,n=c.group(),o=c.group();if(o.rect(d.width,j).move(d.x(0),d.y(0)).attr("class","f"),o.rect(d.width,l).move(d.x(0),d.y(j+10)).attr("class","f"),o.rect(d.width,m).move(d.x(0),d.y(j+l+20)).attr("class","f"),_.data.length>0)for(var p=0;p<g.length;p++){var q=d.x(p*i),r=_.histogram.map[g[p].charCode],s="l";if(r.h){var t=r.h/_.histogram.maxh*j,u=r.m/_.histogram.maxm*l,v=r.r/_.histogram.maxr*m;n.rect(i-h,t).move(q,d.y(j-t)).attr("class","b h").title(String(r.h)),n.rect(i-h,u).move(q,d.y(j+l-u+10)).attr("class","b m").title(String(r.m)),n.rect(i-h,v).move(q,d.y(j+l+m-v+20)).attr("class","b r").title(String(b(r.r,100))),s="l"}else s="l empty";n.plain(k(g[p])).font({anchor:"middle"}).move(q+i/2-h/2,d.y(d.height)).attr("class",s)}else f(o,d)}function o(){$(U).empty();var a=SVG(U);a.clear(),$(V).empty();var b=SVG(V);b.clear();for(var c,d=_.letters,e=_.histogram.minh,f=_.histogram.maxh,g=_.histogram.minm,h=_.histogram.maxm,i=f-e,j=h-g,k=0;k<d.length;k++){var l=d[k],m=_.modeKey.layout.keyCombo(l.charCode);if(m&&!m.deadKey){var n=Z.getKeyPoint(m.key.id),o=_.histogram.map[d[k].charCode];o.h&&(c=Math.round((o.h-e)/i*30)+20,a.circle(c).center(n.cx,n.cy).attr("class","h")),o.m&&(c=Math.round((o.m-g)/j*20)+5,b.circle(c).center(n.cx,n.cy).attr("class","m"))}}}function p(){for(var a=new O(Date.now()),b=Object.create(null),c=d(_.data),e=0;e<c.length;e++){var f=c[e],h=f.date.year+"-"+f.date.month,i=b[h];void 0===i&&(b[h]=i=new r(f.date.year,f.date.month));for(var j=0;j<f.list.length;j++)i.add(f.date.day,f.list[j])}var k=g(b).sort(function(a,b){return a.timeStamp-b.timeStamp});0==k.length&&k.push(new r(a.year,a.month));var l=$("#calendar");l.empty();for(var m=0;m<k.length;m++)l.append($(k[m].build()))}function q(a){this.day=a,this.count=0,this.time=0}function r(a,b){this.year=a,this.month=b,this.cell=[];var c=new Date(this.year,this.month-1,1,12,0,0,0);this.timeStamp=c.getTime(),this.dayOffset=0==c.getDay()?6:c.getDay()-1;for(var d=0;42>d;d++)if(d<this.dayOffset)this.cell[d]=null;else{var e=d-this.dayOffset,f=new Date(c.getTime()+1e3*e*60*60*24);this.cell[d]=c.getMonth()==f.getMonth()?new q(e+1):null}}function s(a){function b(a){return 10>a?"0"+a:a}var c=a/3600|0;a-=3600*c;var d=a/60|0;a-=60*d;var e=0|a;return b(c)+":"+b(d)+":"+b(e)}function t(){var d=a.settings.speedUnit,e=Mb.statistics(_.data);if(e.count){y.text(s(e.totalTime/1e3)),z.text(e.count),A.text(b(d.measure(e.topSpeed),1)),B.text(b(d.measure(e.avgSpeed),1));var f=Mb.statistics(c(_.data));E.text(f.count?b(d.measure(f.avgSpeed),1):"N/A")}else y.text(s(0)),z.text("0"),A.text("N/A"),B.text("N/A"),E.text("N/A");var g=_.data.length>Rb.WINDOW_SIZE;H.attr({checked:g}),H.attr({disabled:!g}),I.attr({checked:g}),I.attr({disabled:!g}),h(),i(),j(),l(),m(),n(),o(),p()}function u(){function b(a,b){var c=xb.get(a);d[a]={modeKey:c,data:b},Y.add(c.title,a)}var c=a.database.data,d=Object.create(null);Y.clear(),$.each(c,function(a,c){b(a,c)});var e=String(a.settings.modeKey);void 0===d[e]&&b(e,[]),Y.change=function(a,b){var c=d[b];Z.init(c.modeKey.layout),X.load(c.modeKey.layout,function(a){var b=c.modeKey.layout.filterLetters(a.letters);_={letters:b,modeKey:c.modeKey,data:c.data,forecast:new Ob(b,c.data),histogram:new Wb(b,c.data),charCode:0},t()})},Y.select(e)}function v(){bb&&(window.URL.revokeObjectURL(bb),bb=null),ab=null}var w=$("#group-list"),x=$("#achievements"),y=$("#g-s-total-time"),z=$("#g-s-total-samples"),A=$("#g-s-top-speed"),B=$("#g-s-avg-speed"),E=$("#g-s-avg-speed-today"),F=$("#key-list"),G=$("#g-learning-rate"),H=$("#cb-smooth-progress-details"),I=$("#cb-smooth-speed"),J=document.getElementById("canvas-chart-progress-overview"),K=document.getElementById("svg-chart-progress-overview"),L=document.getElementById("canvas-chart-progress-details"),M=document.getElementById("svg-chart-progress-details"),N=document.getElementById("canvas-chart-speed"),P=document.getElementById("svg-chart-speed"),R=document.getElementById("svg-histogram-key-speed"),S=document.getElementById("svg-histogram-key-frequency"),T=document.getElementById("svg-heatmap"),U=document.getElementById("svg-heat-map-overlay-h"),V=document.getElementById("svg-heat-map-overlay-m"),W=$("#download-data"),Y=new Q.DropDown(w),Z=new fb(T),_=null;q.prototype.add=function(a){this.count++,this.time+=a.time},q.prototype.className=function(){return this.count>30?"s3":this.count>20?"s2":this.count>10?"s1":this.count>0?"s0":"z"},r.prototype.add=function(a,b){this.cell[a+this.dayOffset-1].add(b)},r.prototype.build=function(){var a=D.el("div","calendar"),b=D.el("table"),c=D.el("caption",null,this.year+"/"+this.month);b.appendChild(c);var d=D.el("tr");d.appendChild(D.el("th",null,"M")),d.appendChild(D.el("th",null,"T")),d.appendChild(D.el("th",null,"W")),d.appendChild(D.el("th",null,"T")),d.appendChild(D.el("th",null,"F")),d.appendChild(D.el("th",null,"S")),d.appendChild(D.el("th",null,"S")),b.appendChild(d);for(var e=0;6>e;e++){for(var f=D.el("tr"),g=0;7>g;g++){var h,i=this.cell[7*e+g];null==i?h=D.el("td",null,null):(h=D.el("td",i.className(),i.day),i.count>0&&(h.title=i.count+" sample(s)")),f.appendChild(h)}b.appendChild(f)}return a.appendChild(b),a};var ab=null,bb=null;H.on("click",function(){j()}),I.on("click",function(){l()}),W.on("click",function(){return bb&&window.navigator.msSaveBlob?(window.navigator.msSaveBlob(ab,"typing-data.json"),!1):void 0}),document.addEventListener("reveal-page",function(a){"#profile"==a.detail.url?u():v()})}function q(a){function b(){f.text(i.modeKey.title),e.addClass("loading"),h.empty();var a=new XMLHttpRequest;a.onload=function(){e.removeClass("loading");var b=a.response;"string"==typeof b&&(b=JSON.parse(b)),c(b)},a.onerror=function(a){console.log(a)},a.open("GET","/highscores/table",!0),a.responseType="json",a.send()}function c(a){var b=i.mode,c=i.layout,d=i.speedUnit;h.empty();var e=c.xid+":"+b.type.xid,f=a.collection[e];if(f)for(var g=f.table,j=0;j<g.length;j++){var k=g[j],l="/res/image/person.png";k.user.external_id&&(l="https://graph.facebook.com/"+k.user.external_id+"/picture?type=small");var m=k.user.full_name||k.user.name,n=$("<tr></tr>");n.append($("<td></td>").addClass("position").text(String(j+1))),n.append($("<td></td>").addClass("avatar").append($("<img>").attr({src:l}))),n.append($("<td></td>").addClass("user").append($("<span></span>").text(m))),n.append($("<td></td>").addClass("speed").text(Math.round(d.measure(k.speed))+" "+d.id)),n.append($("<td></td>").addClass("score").text(Math.round(k.score))),n.append($("<td></td>").addClass("extra").text(String(k.length+"/"+k.complexity+"/"+k.errors))),h.append(n)}}function d(){}var e=$(".high-scores-wrap"),f=$("#high-scores-name"),g=$("#high-scores"),h=g.find("tbody"),i=a.settings;document.addEventListener("reveal-page",function(a){"#high-scores"==a.detail.url?b():d()})}function r(){function a(a){alert(a.message)}var b=$(document.body),c=$("#auth-error"),d=$("#facebook-login"),e=$("#persona-login"),f=$("#logout"),g=$(".js-user-name"),h=$(".js-user-email");if(Yb.init(),global.auth.id)b.addClass("named-user").removeClass("anonymous-user"),g.text(global.auth.name),h.text(global.auth.email),f.on("click",function(){Yb.logout()});else{b.addClass("anonymous-user").removeClass("named-user"),g.text(""),h.text("");var i=[];Yb.FACEBOOK.enabled?d.on("click",function(){Yb.login(Yb.FACEBOOK).fail(a)}):(d.attr({disabled:!0}),i.push("<p class='error'>Facebook API not available.\nDoes your browser block domain '<em>facebook.com</em>'?</p>")),Yb.PERSONA.enabled?e.on("click",function(){Yb.login(Yb.PERSONA).fail(a)}):(e.attr({disabled:!0}),i.push("<p class='error'>Mozilla Persona API not available.\nDoes your browser block domain '<em>persona.org</em>'?</p>")),i.length&&c.append(i)}}function s(b){function c(b){return document.dispatchEvent(a("hide-page",{detail:{url:b},bubbles:!0,cancelable:!0}))}function d(b){return document.dispatchEvent(a("reveal-page",{detail:{url:b},bubbles:!0,cancelable:!1}))}function e(b){return document.dispatchEvent(a("page-ready",{detail:{url:b},bubbles:!0,cancelable:!1}))}function f(a,b,c){b.detach(),a.append(c)}function g(a,b,c){function d(){b.off(h),k=!0,m&&g()}function f(){c.off(h),m=!0,k&&g()}function g(){b.detach(),j.detach(),c.detach(),$(document.body).removeClass("animating"),b.removeClass("anim-page-out"),c.removeClass("anim-page-in"),a.append(c),e(l.url)}var h=i.eventName("animation-end"),j=$("<div>").addClass("backstage"),k=!1,m=!1;$(document.body).addClass("animating"),b.addClass("anim-page-out").on(h,d),c.addClass("anim-page-in").on(h,f),j.append(c),a.append(j)}var h=this,i=new D.AnimationSupport;b=!!b&&i.supported;var j=$("#perspective"),k=$("section.page"),l={url:"#null",$page:j.children(),$links:$()},m=null,n=Object.create(null);this.reveal=function(a){if(a=a||m,l.url!=a){var h=n[a];h&&c(l.url)&&(b?g(j,l.$page,h.$page):f(j,l.$page,h.$page),l.$page.removeClass("current"),l.$links.removeClass("current"),h.$page.addClass("current"),h.$links.addClass("current"),l=h,d(l.url),b||e(l.url))}},this.init=function(){k.each(function(a,b){var c=$(b),d=c.data("url");if(d){d="#"+d;var e=$("a[href="+d+"]");n[d]={url:d,$page:c,$links:e},e.on("click",function(a){a.isDefaultPrevented()||(a.preventDefault(),l.url!=d&&(window.history.pushState(null,"",d),h.reveal(d)))}),m=m||d}}),k.detach(),window.addEventListener("popstate",function(){h.reveal(window.location.hash)}),h.reveal(window.location.hash)}}function t(){function a(){b.hide()}var b=$("#cws-install"),c=window;c.chrome&&c.chrome.app&&c.chrome.webstore?c.chrome.app.isInstalled?b.hide():b.on("click",function(){try{c.chrome.webstore.install("",a,a)}catch(b){console.log(b)}return!1}):b.hide()}function u(){var a=document;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?a.exitFullscreen?a.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullscreen&&a.webkitExitFullscreen():a.documentElement.requestFullscreen?a.documentElement.requestFullscreen():a.documentElement.msRequestFullscreen?a.documentElement.msRequestFullscreen():a.documentElement.mozRequestFullScreen?a.documentElement.mozRequestFullScreen():a.documentElement.webkitRequestFullscreen&&a.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function v(){$(".button.full-screen").on("click",function(){u()})}function w(a){var b=S.buildPages(".tour-page"),c={onStart:function(){$(document.body).addClass("tour"),a.pause()},onStop:function(){$(document.body).removeClass("tour"),a.unpause()}};return new S(b,c)}function x(a,b){v(),r();var c=new yb(a);b.url&&c.importUrl(b.url);var d=new Vb(c);n(d),o(d),p(d),q(d),m(d),d.init(function(){new s(b.flag("animate")).init(),Pb.loadLesson(c,function(a){d.start(a)})});var e=w(d);$(".button.tour").on("click",function(){return e.start(),!1});var f=c.newSettings;document.addEventListener("hide-page",function(a){"#game"==a.detail.url&&e.stop()}),document.addEventListener("page-ready",function(a){"#game"==a.detail.url&&f&&(f=!1,e.start())}),t()}function y(a,b,c,d){if(-1!=b.indexOf("keybr.com")){var e={userAgent:String(window.navigator.userAgent),message:String(a),uri:String(b),line:c,column:d};if(null!=Zb&&Zb.userAgent==e.userAgent&&Zb.message==e.message&&Zb.uri==e.uri&&Zb.line==e.line&&Zb.column==e.column);else{var f=new XMLHttpRequest;f.open("POST","/log",!0),f.setRequestHeader("Content-Type","application/json"),f.send(JSON.stringify(e))}Zb=e}}function z(a){$("#perspective").empty().html(['<div class="veil">',"<div>",a,"</div>","</div>"].join("\n"))}function A(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}SVG.ForeignObject=function(){this.constructor.call(this,SVG.create("foreignObject")),this.type="foreignObject"},SVG.ForeignObject.prototype=new SVG.Shape,SVG.extend(SVG.ForeignObject,{appendChild:function(a,b){var c="string"==typeof a?document.createElement(a):a;if("object"==typeof b)for(var d in b)c[d]=b[d];return this.node.appendChild(c),this},getChild:function(a){return this.node.childNodes[a]}}),SVG.extend(SVG.Container,{foreignObject:function(a,b){return this.put(new SVG.ForeignObject).size(null==a?100:a,null==b?100:b)}}),SVG.extend(SVG.Element,{title:function(a){var b=SVG.create("title");return b.textContent=a,this.node.insertBefore(b,this.node.firstChild),this}}),SVG.defaults.attrs["font-family"]=null,function(a,b){"use strict";
function c(a,b){this.container=a,this.options=b,this.init()}function d(b,c){this.widget=b,this.options=a.extend({},c),this.detectService(),this.service&&this.init()}function e(a){function b(a,b){return b.toUpper()}var c={},d=a.data();for(var e in d){var f=d[e];"yes"===f?f=!0:"no"===f&&(f=!1),c[e.replace(/-(\w)/g,b)]=f}return c}function f(a,b){return g(a,b,encodeURIComponent)}function g(a,b,c){return a.replace(/\{([^\}]+)\}/g,function(a,d){return d in b?c?c(b[d]):b[d]:a})}function h(a,b){var c=l+a;return c+" "+c+"_"+b}function i(b,c){function d(g){"keydown"===g.type&&27!==g.which||a(g.target).closest(b).length||(b.removeClass(m),e.off(f,d),a.isFunction(c)&&c())}var e=a(document),f="click touchstart keydown";e.on(f,d)}function j(a){var b=10;if(document.documentElement.getBoundingClientRect){var c=parseInt(a.css("left"),10),d=parseInt(a.css("top"),10),e=a[0].getBoundingClientRect();e.left<b?a.css("left",b-e.left+c):e.right>window.innerWidth-b&&a.css("left",window.innerWidth-e.right-b+c),e.top<b?a.css("top",b-e.top+d):e.bottom>window.innerHeight-b&&a.css("top",window.innerHeight-e.bottom-b+d)}a.addClass(m)}var k="social-likes",l=k+"__",m=k+"_opened",n="https:"===location.protocol?"https:":"http:",o={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(a){return a.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"https://cdn.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"https://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){return/[\.:\-–—]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},plusone:{counterUrl:"http:"===n?"http://share.yandex.ru/gpp.xml?url={url}":b,counter:function(b,c){var d=o.plusone;return d._?void c.reject():(window.services||(window.services={}),window.services.gplus={cb:function(a){d._.resolve(a)}},d._=c,void a.getScript(f(b)).fail(c.reject))},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:n+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:n+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},p={promises:{},fetch:function(b,c,d){p.promises[b]||(p.promises[b]={});var e=p.promises[b];if(!d.forceUpdate&&e[c])return e[c];var g=a.extend({},o[b],d),h=a.Deferred(),i=g.counterUrl&&f(g.counterUrl,{url:c});return i&&a.isFunction(g.counter)?g.counter(i,h):g.counterUrl?a.getJSON(i).done(function(b){try{var c=b;a.isFunction(g.convertNumber)&&(c=g.convertNumber(b)),h.resolve(c)}catch(d){h.reject()}}).fail(h.reject):h.reject(),e[c]=h.promise(),e[c]}};a.fn.socialLikes=function(b){return this.each(function(){var d=a(this),f=d.data(k);f?a.isPlainObject(b)&&f.update(b):(f=new c(d,a.extend({},a.fn.socialLikes.defaults,b,e(d))),d.data(k,f))})},a.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:!1,zeroes:!1,wait:500,popupCheckInterval:500,singleTitle:"Share"},c.prototype={init:function(){this.container.addClass(k),this.single=this.container.hasClass(k+"_single"),this.initUserButtons(),this.number=0,this.container.on("counter."+k,a.proxy(this.updateCounter,this));var b=this.container.children();this.countersLeft=b.length,this.makeSingleButton(),this.buttons=[],b.each(a.proxy(function(b,c){this.buttons.push(new d(a(c),this.options))},this)),this.options.counters?this.timer=setTimeout(a.proxy(this.appear,this),this.options.wait):this.appear()},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&a.extend(!0,o,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){if(this.single){var b=this.container;b.addClass(k+"_vertical"),b.wrap(a("<div>",{class:k+"_single-w"})),b.wrapInner(a("<div>",{class:k+"__single-container"}));var c=b.parent(),d=a("<div>",{class:h("widget","single")}),e=a(g('<div class="{buttonCls}"><span class="{iconCls}"></span>{title}</div>',{buttonCls:h("button","single"),iconCls:h("icon","single"),title:this.options.singleTitle}));d.append(e),c.append(d),d.click(function(){var a=k+"__widget_active";return d.toggleClass(a),d.hasClass(a)?(b.css({left:-(b.width()-d.width())/2,top:-b.height()}),j(b),i(b,function(){d.removeClass(a)})):b.removeClass(m),!1}),this.widget=d}},update:function(b){if(b.forceUpdate||b.url!==this.options.url){this.number=0,this.countersLeft=this.buttons.length,this.widget&&this.widget.find("."+k+"__counter").remove(),a.extend(this.options,b);for(var c=0;c<this.buttons.length;c++)this.buttons[c].update(b)}},updateCounter:function(a,b,c){c&&(this.number+=c,this.single&&this.getCounterElem().text(this.number)),this.countersLeft--,0===this.countersLeft&&(this.appear(),this.container.addClass(k+"_ready"),this.container.trigger("ready."+k,this.number))},appear:function(){this.container.addClass(k+"_visible")},getCounterElem:function(){var b=this.widget.find("."+l+"counter_single");return b.length||(b=a("<span>",{class:h("counter","single")}),this.widget.append(b)),b}},d.prototype={init:function(){this.detectParams(),this.initHtml(),this.initCounter()},update:function(b){a.extend(this.options,{forceUpdate:!1},b),this.widget.find("."+k+"__counter").remove(),this.initCounter()},detectService:function(){var b=this.widget.data("service");if(!b){for(var c=this.widget[0],d=c.classList||c.className.split(" "),e=0;e<d.length;e++){var f=d[e];if(o[f]){b=f;break}}if(!b)return}this.service=b,a.extend(this.options,o[b])},detectParams:function(){var a=this.widget.data();if(a.counter){var b=parseInt(a.counter,10);isNaN(b)?this.options.counterUrl=a.counter:this.options.counterNumber=b}a.title&&(this.options.title=a.title),a.url&&(this.options.url=a.url)},initHtml:function(){var b=this.options,c=this.widget,d=c.find("a");d.length&&this.cloneDataAttrs(d,c);var e=a("<span>",{class:this.getElementClassNames("button"),text:c.text()});if(b.clickUrl){var g=f(b.clickUrl,{url:b.url,title:b.title}),h=a("<a>",{href:g});this.cloneDataAttrs(c,h),c.replaceWith(h),this.widget=c=h}else c.click(a.proxy(this.click,this));c.removeClass(this.service),c.addClass(this.getElementClassNames("widget")),e.prepend(a("<span>",{class:this.getElementClassNames("icon")})),c.empty().append(e),this.button=e},initCounter:function(){if(this.options.counters)if(this.options.counterNumber)this.updateCounter(this.options.counterNumber);else{var b={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};p.fetch(this.service,this.options.url,b).always(a.proxy(this.updateCounter,this))}},cloneDataAttrs:function(a,b){var c=a.data();for(var d in c)c.hasOwnProperty(d)&&b.data(d,c[d])},getElementClassNames:function(a){return h(a,this.service)},updateCounter:function(b){b=parseInt(b,10)||0;var c={class:this.getElementClassNames("counter"),text:b};b||this.options.zeroes||(c["class"]+=" "+k+"__counter_empty",c.text="");var d=a("<span>",c);this.widget.append(d),this.widget.trigger("counter."+k,[this.service,b])},click:function(b){var c=this.options,d=!0;if(a.isFunction(c.click)&&(d=c.click.call(this,b)),d){var e=f(c.popupUrl,{url:c.url,title:c.title});e=this.addAdditionalParamsToUrl(e),this.openPopup(e,{width:c.popupWidth,height:c.popupHeight})}return!1},addAdditionalParamsToUrl:function(b){var c=a.param(a.extend(this.widget.data(),this.options.data));if(a.isEmptyObject(c))return b;var d=-1===b.indexOf("?")?"?":"&";return b+d+c},openPopup:function(b,c){var d=Math.round(screen.width/2-c.width/2),e=0;screen.height>c.height&&(e=Math.round(screen.height/3-c.height/2));var f=window.open(b,"sl_"+this.service,"left="+d+",top="+e+",width="+c.width+",height="+c.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(f){f.focus(),this.widget.trigger("popup_opened."+k,[this.service,f]);var g=setInterval(a.proxy(function(){f.closed&&(clearInterval(g),this.widget.trigger("popup_closed."+k,this.service))},this),this.options.popupCheckInterval)}else location.href=b}},a(function(){a("."+k).socialLikes()})}(jQuery),function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.indexOf(a,b)===b}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){b=b||this.length,b-=a.length;var c=this.lastIndexOf(a);return-1!==c&&c===b}}),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame,window.URL=window.URL||window.webkitURL,Storage.prototype.getObject=function(a){try{return JSON.parse(this.getItem(a))}catch(b){return null}},Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))}}();var B;!function(a){function b(a,b){a=void 0!==a?a:0,b=void 0!==b?b:1;var c=Math.sqrt(3*b*b),d=2*c,e=Math.random()*d-c,f=Math.random()*d-c,g=Math.random()*d-c,h=Math.random()*d-c,i=Math.random()*d-c;return a+(e+f+g+h+i)/5*2.23606797749979}function c(a){return Math.floor(Math.random()*a)}a.normal=b,a.int=c}(B||(B={}));var C;!function(a){function b(a){var b,c,d=a.length,e=.5*(d+1),f=0,g=0,h=0;for(b=0;d>b;b++)c=a[b],h+=c,0==b?(f=c,g=c):(f=Math.min(f,c),g=Math.max(g,c));var i=h/d,j=0;for(b=0;d>b;b++)c=a[b]-i,j+=c*c;var k=Math.sqrt(j/(d-1)),l=0,m=0;for(b=0;d>b;b++)c=b-e,l+=c*(a[b]-i),m+=c*c;var n=l/m,o=i-n*e;return{min:f,max:g,mean:i,stdDev:k,alpha:o,beta:n,fn:function(a){return o+a*n}}}a.linearRegression=b;var c=function(){function a(){this.n=0,this.mean=0,this.m2=0,this.variance=null}return a.prototype.add=function(a){this.n++;var b=a-this.mean;this.mean+=b/this.n,this.m2+=b*(a-this.mean),this.n>1&&(this.variance=this.m2/(this.n-1))},a.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},a}();a.Mean=c;var d=function(){function a(a,b){"undefined"==typeof b&&(b=[]),this.size=a,this.sink=b,this.data=[],this.sum=0,this.mean=null,this.min=null,this.max=null}return a.prototype.add=function(a){var b=a/this.size;this.data.push(b),this.sum+=b,this.data.length==this.size&&(this.mean=this.sum,this.min=null===this.min?this.mean:Math.min(this.min,this.mean),this.max=null===this.max?this.mean:Math.max(this.max,this.mean),this.sink.push(this.mean),this.sum-=this.data.shift())},a.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},a.smooth=function(b,c){var d=[];return new a(b,d).addAll(c),d},a}();a.MovingMean=d}(C||(C={}));var D;!function(a){function b(a,b,c){if("object"==typeof a){var d=a;a=d.tagName,b=d.className,c=d.text}var e=document.createElement(a);if(b)if(b instanceof Array)for(var f=0;f<b.length;f++)e.classList.add(b[f]);else e.classList.add(b);return c&&(e.textContent=c),e}function c(){function a(a,b){return function(c){return a+b(c)}}this.supported=!1,this.id="standard",this.domName=d.toPascalCase,this.styleName=d.toCamelCase,this.eventName=d.toSimple;var b=[{id:"webkit",domName:a("Webkit",d.toPascalCase),styleName:a("webkit",d.toPascalCase),eventName:a("webkit",d.toPascalCase)},{id:"moz",domName:a("Moz",d.toPascalCase),styleName:a("moz",d.toPascalCase),eventName:a("moz",d.toPascalCase)},{id:"ms",domName:a("MS",d.toPascalCase),styleName:a("ms",d.toPascalCase),eventName:a("MS",d.toPascalCase)}],c=document.body;if(void 0!==c.style.animationName)this.supported=!0;else for(var e=0;e<b.length;e++){var f=b[e];if(void 0!==c.style[f.domName("animation-name")]){this.supported=!0,this.id=f.id,this.domName=f.domName,this.styleName=f.styleName,this.eventName=f.eventName;break}}}a.classList={contains:function(a,b){if(a.classList)return a.classList.contains(b);var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);return-1!=d},add:function(a,b){if(a.classList)a.classList.add(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1==d&&(c.push(b),a.className.baseVal=c.join(" "))}},remove:function(a,b){if(a.classList)a.classList.remove(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className.baseVal=c.join(" "))}},toggle:function(a,b){if(a.classList)a.classList.toggle(b);else{var c=a.className.baseVal.split(/\s+/),d=c.indexOf(b);-1!=d?c.splice(d,1):c.push(b),a.className.baseVal=c.join(" ")}}},a.el=b;var d={toSimple:function(a){return a.split("-").map(function(a){return a.toLowerCase()}).join("")},toPascalCase:function(a){return a.split("-").map(function(a){return a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}).join("")},toCamelCase:function(a){return a.split("-").map(function(a,b){return 0==b?a.toLowerCase():a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}).join("")}};a.AnimationSupport=c}(D||(D={}));var E;!function(a){function b(a){return h(document.cookie)[a]}function c(b,c,d){return d=e(d),d.expires=f(void 0===c?-1:d.expires,null),document.cookie=g(b,c,d),a}function d(b,c){return this.set(b,void 0,c),a}function e(b){return{path:b&&b.path||a.defaults.path,domain:b&&b.domain||a.defaults.domain,expires:b&&b.expires||a.defaults.expires,secure:b&&void 0!==b.secure?b.secure:a.defaults.secure}}function f(a,b){switch(b=b||new Date,typeof a){case"number":a=new Date(b.getTime()+1e3*a);break;case"string":a=new Date(a)}return a}function g(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),c=c||{path:"/"};var d=a+"="+b;return c.path&&(d+=";path="+c.path),c.domain&&(d+=";domain="+c.domain),c.expires&&(d+=";expires="+c.expires.toUTCString()),c.secure&&(d+=";secure"),d}function h(a){for(var b={},c=a?a.split("; "):[],d=0;d<c.length;d++){var e=i(c[d]);void 0===b[e.key]&&(b[e.key]=e.value)}return b}function i(a){var b=a.indexOf("=");return b=-1===b?a.length:b,{key:decodeURIComponent(a.substring(0,b)),value:decodeURIComponent(a.substring(b+1))}}a.defaults={path:"/"},a.get=b,a.set=c,a.expire=d}(E||(E={}));var F;!function(a){a[a.BACK_SPACE=8]="BACK_SPACE",a[a.TAB=9]="TAB",a[a.CLEAR=12]="CLEAR",a[a.RETURN=13]="RETURN",a[a.SHIFT=16]="SHIFT",a[a.CONTROL=17]="CONTROL",a[a.ALT=18]="ALT",a[a.PAUSE=19]="PAUSE",a[a.CAPS_LOCK=20]="CAPS_LOCK",a[a.ESCAPE=27]="ESCAPE",a[a.SPACE=32]="SPACE",a[a.PAGE_UP=33]="PAGE_UP",a[a.PAGE_DOWN=34]="PAGE_DOWN",a[a.END=35]="END",a[a.HOME=36]="HOME",a[a.LEFT=37]="LEFT",a[a.UP=38]="UP",a[a.RIGHT=39]="RIGHT",a[a.DOWN=40]="DOWN",a[a.PRINT_SCREEN=44]="PRINT_SCREEN",a[a.INSERT=45]="INSERT",a[a.DELETE=46]="DELETE",a[a.N0=48]="N0",a[a.N1=49]="N1",a[a.N2=50]="N2",a[a.N3=51]="N3",a[a.N4=52]="N4",a[a.N5=53]="N5",a[a.N6=54]="N6",a[a.N7=55]="N7",a[a.N8=56]="N8",a[a.N9=57]="N9",a[a.A=65]="A",a[a.B=66]="B",a[a.C=67]="C",a[a.D=68]="D",a[a.E=69]="E",a[a.F=70]="F",a[a.G=71]="G",a[a.H=72]="H",a[a.I=73]="I",a[a.J=74]="J",a[a.K=75]="K",a[a.L=76]="L",a[a.M=77]="M",a[a.N=78]="N",a[a.O=79]="O",a[a.P=80]="P",a[a.Q=81]="Q",a[a.R=82]="R",a[a.S=83]="S",a[a.T=84]="T",a[a.U=85]="U",a[a.V=86]="V",a[a.W=87]="W",a[a.X=88]="X",a[a.Y=89]="Y",a[a.Z=90]="Z",a[a.CONTEXT_MENU=93]="CONTEXT_MENU",a[a.NUMPAD0=96]="NUMPAD0",a[a.NUMPAD1=97]="NUMPAD1",a[a.NUMPAD2=98]="NUMPAD2",a[a.NUMPAD3=99]="NUMPAD3",a[a.NUMPAD4=100]="NUMPAD4",a[a.NUMPAD5=101]="NUMPAD5",a[a.NUMPAD6=102]="NUMPAD6",a[a.NUMPAD7=103]="NUMPAD7",a[a.NUMPAD8=104]="NUMPAD8",a[a.NUMPAD9=105]="NUMPAD9",a[a.MULTIPLY=106]="MULTIPLY",a[a.ADD=107]="ADD",a[a.SEPARATOR=108]="SEPARATOR",a[a.SUBTRACT=109]="SUBTRACT",a[a.DECIMAL=110]="DECIMAL",a[a.DIVIDE=111]="DIVIDE",a[a.F1=112]="F1",a[a.F2=113]="F2",a[a.F3=114]="F3",a[a.F4=115]="F4",a[a.F5=116]="F5",a[a.F6=117]="F6",a[a.F7=118]="F7",a[a.F8=119]="F8",a[a.F9=120]="F9",a[a.F10=121]="F10",a[a.F11=122]="F11",a[a.F12=123]="F12",a[a.F13=124]="F13",a[a.F14=125]="F14",a[a.F15=126]="F15",a[a.F16=127]="F16",a[a.NUM_LOCK=144]="NUM_LOCK",a[a.SCROLL_LOCK=145]="SCROLL_LOCK",a[a.SEMICOLON=186]="SEMICOLON",a[a.EQUALS=187]="EQUALS",a[a.COMMA=188]="COMMA",a[a.DASH=189]="DASH",a[a.PERIOD=190]="PERIOD",a[a.SLASH=191]="SLASH",a[a.BACK_QUOTE=192]="BACK_QUOTE",a[a.OPEN_BRACKET=219]="OPEN_BRACKET",a[a.BACK_SLASH=220]="BACK_SLASH",a[a.CLOSE_BRACKET=221]="CLOSE_BRACKET",a[a.QUOTE=222]="QUOTE",a[a.META=224]="META",a[a.OEM_102=226]="OEM_102",a[a.ALT_SEMICOLON=59]="ALT_SEMICOLON",a[a.ALT_EQUALS=61]="ALT_EQUALS",a[a.ALT_HYPHEN_MINUS=173]="ALT_HYPHEN_MINUS"}(F||(F={}));var G=function(){function a(a){return this.ev=a,this.type=a.type,this.timeStamp=a.timeStamp,this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.location=a.location,this.keyCode=c(a.keyCode),Object.defineProperty(this,"eventPhase",{configurable:!1,enumerable:!0,get:function(){return a.eventPhase}}),Object.defineProperty(this,"bubbles",{configurable:!1,enumerable:!0,get:function(){return a.bubbles}}),Object.defineProperty(this,"cancelable",{configurable:!1,enumerable:!0,get:function(){return a.cancelable}}),Object.defineProperty(this,"defaultPrevented",{configurable:!1,enumerable:!0,get:function(){return a.defaultPrevented}}),Object.defineProperty(this,"cancelBubble",{configurable:!1,enumerable:!0,get:function(){return a.cancelBubble},set:function(b){a.cancelBubble=b}}),Object.freeze(this)}return a.prototype.getModifierState=function(a){return this.ev.getModifierState(a)},a.prototype.preventDefault=function(){this.ev.preventDefault()},a.prototype.stopPropagation=function(){this.ev.stopPropagation()},a}(),H=function(){function a(){}return a.isValidCodePoint=function(b){return b>=a.MIN_CODE_POINT&&b<=a.MAX_CODE_POINT},a.isBmpCodePoint=function(a){return a>>>16==0},a.isSupplementaryCodePoint=function(b){return b>=a.MIN_SUPPLEMENTARY_CODE_POINT&&b<=a.MAX_CODE_POINT},a.isHighSurrogate=function(b){return b>=a.MIN_HIGH_SURROGATE&&b<=a.MAX_HIGH_SURROGATE},a.isLowSurrogate=function(b){return b>=a.MIN_LOW_SURROGATE&&b<=a.MAX_LOW_SURROGATE},a.isSurrogate=function(b){return b>=a.MIN_SURROGATE&&b<=a.MAX_SURROGATE},a.isSurrogatePair=function(b,c){return a.isHighSurrogate(b)&&a.isLowSurrogate(c)},a.isCombining=function(b){return a.isCombiningDiacriticalMark(b)},a.isCombiningDiacriticalMark=function(b){return b>=a.COMBINING_DIACRITICAL_MARK_MIN&&b<=a.COMBINING_DIACRITICAL_MARK_MAX},a.combine=function(b,c){var d=a.COMBINER_MAP[c];return d?d.combine(b):b},a.uncombine=function(b){for(var c=0;c<a.COMBINER_MAP.length;c++){var d=a.COMBINER_MAP[c];if(d){var e=d.uncombine(b);if(e!=b)return e}}return b},a.combinerImage=function(b){var c=a.COMBINER_MAP[b];return c?c.image:b},a.isWs=function(a){return"string"==typeof a&&(a=a.charCodeAt(0)),32==a||9==a||10==a||13==a||160==a||8192==a||8193==a||8194==a||8195==a||8232==a||8233==a},a.isNl=function(a){return"string"==typeof a&&(a=a.charCodeAt(0)),10==a||13==a||8232==a||8233==a},a.MIN_HIGH_SURROGATE=55296,a.MAX_HIGH_SURROGATE=56319,a.MIN_LOW_SURROGATE=56320,a.MAX_LOW_SURROGATE=57343,a.MIN_SURROGATE=55296,a.MAX_SURROGATE=57343,a.MIN_SUPPLEMENTARY_CODE_POINT=65536,a.MIN_CODE_POINT=0,a.MAX_CODE_POINT=1114111,a.COMBINING_DIACRITICAL_MARK_MIN=768,a.COMBINING_DIACRITICAL_MARK_MAX=879,a.DIACRITIC_ACUTE=180,a.COMBINING_DIACRITIC_ACUTE=769,a.DIACRITIC_DOUBLE_ACUTE=733,a.COMBINING_DIACRITIC_DOUBLE_ACUTE=779,a.DIACRITIC_BREVE=728,a.COMBINING_DIACRITIC_BREVE=774,a.DIACRITIC_CARON=711,a.COMBINING_DIACRITIC_CARON=780,a.DIACRITIC_CEDILLA=184,a.COMBINING_DIACRITIC_CEDILLA=807,a.DIACRITIC_CIRCUMFLEX=710,a.COMBINING_DIACRITIC_CIRCUMFLEX=770,a.DIACRITIC_DIAERESIS=168,a.COMBINING_DIACRITIC_DIAERESIS=776,a.DIACRITIC_GRAVE=96,a.COMBINING_DIACRITIC_GRAVE=768,a.DIACRITIC_TILDE=126,a.COMBINING_DIACRITIC_TILDE=771,a.COMBINER_MAP=[],a}(),I=function(){function a(a,b,c,d){if(c.length!=d.length)throw new Error;for(var e=0;e<d.length;e++)if(H.isCombining(d.charCodeAt(e)))throw new Error;return this.combiner=a,this.image=b,this.from=c,this.to=d,Object.freeze(this)}return a.prototype.combine=function(a){for(var b=0;b<this.from.length;b++)if(this.from.charCodeAt(b)==a)return this.to.charCodeAt(b);return a},a.prototype.uncombine=function(a){for(var b=0;b<this.to.length;b++)if(this.to.charCodeAt(b)==a)return this.from.charCodeAt(b);return a},a}();f(H.COMBINER_MAP);var J,K=function(){function a(){}return a.fromCode=function(a,b,c){for(var d in a){var e=a[d];if(e.id===b)return e}if(void 0===c)throw new Error;return c},a.fromXCode=function(a,b,c){for(var d in a){var e=a[d];if(e.xid===b)return e}if(void 0===c)throw new Error;return c},a}(),L=function(){function a(a){this.map=Object.create(null),this.producer=a}return a.prototype.get=function(a){var b=this.map[a];return null==b&&(b=this.map[a]=this.producer(a)),b},a.prototype.pub=function(a,b){this.map[a]=b},a}(),M=function(){function a(){var a=this,b=window.location.search;b.startsWith("?")&&(b=b.substring(1)),b.split("&").map(function(b){var c,d=b.split("="),e=decodeURIComponent(d[0]);c=void 0==d[1]?null:decodeURIComponent(d[1]),a[e]=c},this)}return a.prototype.flag=function(a,b){return b=!!b,a in this?"false"!=this[a]:b},a}(),N=function(){function a(a){if(3==arguments.length)return this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],this;if("number"==typeof a){var b=0|a;return this.r=b>>16&255,this.g=b>>8&255,this.b=255&b,this}if("string"==typeof a){a.startsWith("#")&&(a=a.substring(1));var c=parseInt(a,16);return this.r=c>>16&255,this.g=c>>8&255,this.b=255&c,this}if("array"==typeof a)return this.r=0|a[0],this.g=0|a[1],this.b=0|a[2],this;if("object"==typeof a)return this.r=0|a.r,this.g=0|a.g,this.b=0|a.b,this;throw new Error}return a.prototype.shade=function(a){function b(a,b){return a+=b,a>255?255:0>a?0:a}return this.r=b(this.r,a),this.g=b(this.g,a),this.b=b(this.b,a),this},a.prototype.toHex=function(){function a(a){return 16>a?"0"+a.toString(16):a.toString(16)}return"#"+a(this.r)+a(this.g)+a(this.b)},a.prototype.toRgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},a.prototype.toString=function(){return this.toHex()},a}(),O=function(){function a(a){return"number"==typeof a&&(a=new Date(a)),this.year=a.getFullYear(),this.month=a.getMonth()+1,this.day=a.getDate(),Object.freeze(this)}return a.prototype.toString=function(){return this.year+"-"+this.month+"-"+this.day},a}();!function(a){var b=function(){function a(b,c){this.buffer=b,this.position=0,this.length=a.align(this.buffer.length,c)}return a.prototype.more=function(){return this.position<this.length},a.prototype.getUint32=function(){var a=this.getUint8(),b=this.getUint8(),c=this.getUint8(),d=this.getUint8();return a<<24|b<<16|c<<8|d<<0},a.prototype.putUint32=function(a){this.putUint8(a>>>24&255),this.putUint8(a>>>16&255),this.putUint8(a>>>8&255),this.putUint8(a>>>0&255)},a.prototype.getUint8=function(){var a;if(this.position<this.buffer.length)a=this.buffer[this.position];else{if(!(this.position<this.length))throw new Error;a=0}return this.position++,a},a.prototype.putUint8=function(a){if(this.position<this.buffer.length)this.buffer[this.position++]=a;else{if(!(this.position<this.length))throw new Error;this.position++}},a.align=function(a,b){return a+(b-1)&-b},a}();a.Cursor=b,function(a){function b(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);b+=128>d?1:2048>d?2:3}return b}function c(a,b,c){for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b.setUint8(c++,127&e|0):2048>e?(b.setUint8(c++,e>>6&31|192),b.setUint8(c++,e>>0&63|128)):(b.setUint8(c++,e>>12&15|224),b.setUint8(c++,e>>6&63|128),b.setUint8(c++,e>>0&63|128))}return c}function d(a,b,c){for(var d,e,f,g="",h=b+c;h>b;)if(d=a.getUint8(b++),128>d)g+=String.fromCharCode(d);else if(224>d){if(b+1>h)throw new Error("Truncated UTF-8 stream");e=a.getUint8(b++),g+=String.fromCharCode((31&d)<<6|(63&e)<<0)}else{if(b+2>h)throw new Error("Truncated UTF-8 stream");e=a.getUint8(b++),f=a.getUint8(b++),g+=String.fromCharCode((15&d)<<12|(63&e)<<6|(63&f)<<0)}return g}a.size=b,a.encode=c,a.decode=d}(a.UTF8||(a.UTF8={}));a.UTF8;!function(b){var c=function(){function b(){this.d=[]}return b.prototype.putString=function(b){return this.d.push({value:b,tag:"string",size:a.UTF8.size(b)}),this},b.prototype.putInt8=function(a){return this.d.push({value:a,tag:"int8"}),this},b.prototype.putUint8=function(a){return this.d.push({value:a,tag:"uint8"}),this},b.prototype.putInt16=function(a){return this.d.push({value:a,tag:"int16"}),this},b.prototype.putUint16=function(a){return this.d.push({value:a,tag:"uint16"}),this},b.prototype.putInt32=function(a){return this.d.push({value:a,tag:"int32"}),this},b.prototype.putUint32=function(a){return this.d.push({value:a,tag:"uint32"}),this},b.prototype.putFloat32=function(a){return this.d.push({value:a,tag:"float32"}),this},b.prototype.putFloat64=function(a){return this.d.push({value:a,tag:"float64"}),this},b.prototype.size=function(){for(var a=0,b=0;b<this.d.length;b++){var c=this.d[b];switch(c.tag){case"string":a+=2+c.size;break;case"int8":a+=1;break;case"uint8":a+=1;break;case"int16":a+=2;break;case"uint16":a+=2;break;case"int32":a+=4;break;case"uint32":a+=4;break;case"float32":a+=4;break;case"float64":a+=8;break;default:throw new Error}}return a},b.prototype.get=function(){for(var b=new ArrayBuffer(this.size()),c=new DataView(b),d=0,e=0;e<this.d.length;e++){var f=this.d[e];switch(f.tag){case"string":c.setUint16(d,f.size),d+=2,d=a.UTF8.encode(f.value,c,d);break;case"int8":c.setInt8(d,f.value),d+=1;break;case"uint8":c.setUint8(d,f.value),d+=1;break;case"int16":c.setInt16(d,f.value),d+=2;break;case"uint16":c.setUint16(d,f.value),d+=2;break;case"int32":c.setInt32(d,f.value),d+=4;break;case"uint32":c.setInt32(d,f.value),d+=4;break;case"float32":c.setFloat32(d,f.value),d+=4;break;case"float64":c.setFloat64(d,f.value),d+=8;break;default:throw new Error}}return b},b}();b.Writer=c;var d=function(){function b(a){this.p=0,this.data=new DataView(a)}return b.prototype.getString=function(){var b=this.data.getUint16(this.p);this.p+=2;var c=a.UTF8.decode(this.data,this.p,b);return this.p+=b,c},b.prototype.getInt8=function(){var a=this.data.getInt8(this.p);return this.p+=1,a},b.prototype.getUint8=function(){var a=this.data.getUint8(this.p);return this.p+=1,a},b.prototype.getInt16=function(){var a=this.data.getInt16(this.p);return this.p+=2,a},b.prototype.getUint16=function(){var a=this.data.getUint16(this.p);return this.p+=2,a},b.prototype.getInt32=function(){var a=this.data.getInt32(this.p);return this.p+=4,a},b.prototype.getUint32=function(){var a=this.data.getUint32(this.p);return this.p+=4,a},b.prototype.getFloat32=function(){var a=this.data.getFloat32(this.p);return this.p+=4,a},b.prototype.getFloat64=function(){var a=this.data.getFloat64(this.p);return this.p+=8,a},b}();b.Reader=d}(a.IO||(a.IO={}));a.IO}(J||(J={}));var J;!function(a){function b(a){for(var b=4294967295,c=0;c<a.length;c++)b=b>>>8^e[255&(b^a[c])];return 4294967295^b}function c(){for(var a=[],b=0;256>b;b++){for(var c=b,d=0;8>d;d++)c=1&c?3988292384^c>>>1:c>>>1;a[b]=c}return a}var d=function(){function a(){}return a}();a.CRC32=d;var e=c();a.crc32=b}(J||(J={}));var J;!function(a){function b(a){function b(){return i<a.length?a[i++]:i==a.length?(i++,128):(i++,0)}function e(){if(h-1>j){var c=b(),d=b(),e=b(),f=b(),g=c<<24|d<<16|e<<8|f;return j++,g}return j==h-1?(j++,8*a.length):(i++,0)}for(var f=a.length+1+8,g=f+63>>>6,h=g<<4,i=0,j=0,k=[1518500249,1859775393,2400959708,3395469782],l=1732584193,m=4023233417,n=2562383102,o=271733878,p=3285377520,q=new Array(80),r=0;g>r;r++){for(var s=0;16>s;s++)q[s]=e();for(var s=16;80>s;s++)q[s]=d(q[s-3]^q[s-8]^q[s-14]^q[s-16],1);for(var t=l,u=m,v=n,w=o,x=p,s=0;80>s;s++){var y=s/20|0,z=d(t,5)+c(y,u,v,w)+x+k[y]+q[s]&4294967295;x=w,w=v,v=d(u,30),u=t,t=z}l=l+t&4294967295,m=m+u&4294967295,n=n+v&4294967295,o=o+w&4294967295,p=p+x&4294967295}var A=new ArrayBuffer(20),B=new DataView(A);return B.setUint32(0,l),B.setUint32(4,m),B.setUint32(8,n),B.setUint32(12,o),B.setUint32(16,p),new Uint8Array(A)}function c(a,b,c,d){switch(a){case 0:return b&c^~b&d;case 1:return b^c^d;case 2:return b&c^b&d^c&d;case 3:return b^c^d}throw new Error}function d(a,b){return a<<b|a>>>32-b}var e=function(){function a(){}return a}();a.SHA1=e,a.sha1=b}(J||(J={}));var J;!function(a){!function(a){function b(a,b){var c,d,e,f=[];for(c=0;256>c;c++)f[c]=c;for(d=0,c=0;256>c;c++)d=(d+f[c]+a[c%a.length])%256,e=f[c],f[c]=f[d],f[d]=e;c=0,d=0;for(var g=0;g<b.length;g++)c=(c+1)%256,d=(d+f[c])%256,e=f[c],f[c]=f[d],f[d]=e,b[g]^=f[(f[c]+f[d])%256]}function c(a,c){var d=f();return b(g(d,a),c),g(d,c)}function d(a,c){var d=new Uint8Array(c.buffer,0,4),e=new Uint8Array(c.buffer,4);return b(g(d,a),e),e}function e(a){var b=new Uint8Array(4);return b[0]=a>>>24&255,b[1]=a>>>16&255,b[2]=a>>>8&255,b[3]=a>>>0&255,b}function f(){var a=Math.floor(4294967295*Math.random()),b=new Uint8Array(4);return b[0]=a>>>24&255,b[1]=a>>>16&255,b[2]=a>>>8&255,b[3]=a>>>0&255,b}function g(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a,0),c.set(b,a.length),c}a.rc4=b,a.encode=c,a.decode=d,a.key=e}(a.RC4||(a.RC4={}));a.RC4}(J||(J={}));var J;!function(a){var b=function(){function b(c){if(c.length!=2*b.BLOCK_SIZE)throw new Error;this.key=[],this.y=0,this.z=0;var d=new a.Cursor(c,b.BLOCK_SIZE);this.key.push(d.getUint32()),this.key.push(d.getUint32()),this.key.push(d.getUint32()),this.key.push(d.getUint32())}return b.prototype.encryptBlock=function(){for(var a=0,b=0;32>b;b++)this.y+=(this.z<<4^this.z>>>5)+this.z^a+this.key[3&a],a+=2654435769,this.z+=(this.y<<4^this.y>>>5)+this.y^a+this.key[a>>>11&3]},b.prototype.decryptBlock=function(){for(var a=3337565984,b=0;32>b;b++)this.z-=(this.y<<4^this.y>>>5)+this.y^a+this.key[a>>>11&3],a-=2654435769,this.y-=(this.z<<4^this.z>>>5)+this.z^a+this.key[3&a]},b.prototype.encrypt=function(c){var d=new Uint8Array(a.Cursor.align(c.length,b.BLOCK_SIZE)+b.BLOCK_SIZE),e=new a.Cursor(c,b.BLOCK_SIZE),f=new a.Cursor(d,b.BLOCK_SIZE),g=4294967295*Math.random()>>>0,h=4294967295*Math.random()>>>0;for(f.putUint32(g),f.putUint32(h),this.y=0,this.z=0;e.more();)this.y=e.getUint32()^g,this.z=e.getUint32()^h,this.encryptBlock(),f.putUint32(g=this.y),f.putUint32(h=this.z);return d},b.prototype.decrypt=function(c){var d=new Uint8Array(a.Cursor.align(c.length,b.BLOCK_SIZE)-b.BLOCK_SIZE),e=new a.Cursor(c,b.BLOCK_SIZE),f=new a.Cursor(d,b.BLOCK_SIZE),g=e.getUint32(),h=e.getUint32();for(this.y=0,this.z=0;e.more();){var i=this.y=e.getUint32(),j=this.z=e.getUint32();this.decryptBlock(),f.putUint32(this.y^g),f.putUint32(this.z^h),g=i,h=j}return d},b.BLOCK_SIZE=8,b}();a.XTea=b}(J||(J={}));var P;!function(a){function b(){return new n}function c(a){return b().resolve(a).promise()}function d(a){return b().reject(a).promise()}function e(a,c){var d=b(),e=new Array;return f(e,d,a,c),d.promise()}function f(a,b,c,d){var e=c(d);if(!e)return void b.resolve(a);for(;e.next&&2==e.promise.status;)if(a.push(e.promise.result),e=c(e.next),!e)return void b.resolve(a);e.promise.done(function(d){a.push(d),e.next?f(a,b,c,e.next):b.resolve(a)}).fail(function(a){b.reject(a)})}function g(){for(var a=[],c=0;c<arguments.length-0;c++)a[c]=arguments[c+0];var d=b();if(!a.length)return d.resolve([]).promise();var e=0,f=[];return a.forEach(function(b,c){b.done(function(b){f[c]=b,++e,e===a.length&&1!==d.status&&d.resolve(f)}).fail(function(){1!==d.status&&d.reject(new Error("when: one or more promises were rejected"))})}),d.promise()}function h(a){return function(){return i(a())}}function i(a){return new o(a)}function j(a,c){var d=b();return k(d,a(),c),d.promise()}function k(a,b,c){b.advance().done(function(d){return d?(c(b.current),void k(a,b,c)):void a.resolve({})}).fail(function(b){return a.reject(b)})}function l(a){return"undefined"==typeof a}a.defer=b,a.resolve=c,a.reject=d,a.unfold=e,function(a){a[a.Unfulfilled=0]="Unfulfilled",a[a.Rejected=1]="Rejected",a[a.Resolved=2]="Resolved"}(a.Status||(a.Status={}));a.Status;a.when=g;var m=function(){function a(a){this.deferred=a}return Object.defineProperty(a.prototype,"status",{get:function(){return this.deferred.status},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"result",{get:function(){return this.deferred.result},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"error",{get:function(){return this.deferred.error
},enumerable:!0,configurable:!0}),a.prototype.done=function(a){return this.deferred.done(a),this},a.prototype.fail=function(a){return this.deferred.fail(a),this},a.prototype.always=function(a){return this.deferred.always(a),this},a.prototype.then=function(a){return this.deferred.then(a)},a}(),n=function(){function a(){this._resolved=function(){},this._rejected=function(){},this._status=0,this._error={message:""},this._promise=new m(this)}return a.prototype.promise=function(){return this._promise},Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"result",{get:function(){if(2!=this._status)throw new Error("Promise: result not available");return this._result},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"error",{get:function(){if(1!=this._status)throw new Error("Promise: rejection reason not available");return this._error},enumerable:!0,configurable:!0}),a.prototype.then=function(a){var c=b();return this.done(function(b){var d=a(b);if(d instanceof m){var e=d;return e.done(function(a){return c.resolve(a)}).fail(function(a){return c.reject(a)}),e}c.resolve(d)}).fail(function(a){return c.reject(a)}),c.promise()},a.prototype.done=function(a){if(2===this.status)return a(this._result),this;if(0!==this.status)return this;var b=this._resolved;return this._resolved=function(c){b(c),a(c)},this},a.prototype.fail=function(a){if(1===this.status)return a(this._error),this;if(0!==this.status)return this;var b=this._rejected;return this._rejected=function(c){b(c),a(c)},this},a.prototype.always=function(a){return this.done(function(b){return a(b)}).fail(function(b){return a(null,b)}),this},a.prototype.resolve=function(a){if(0!==this._status)throw new Error("tried to resolve a fulfilled promise");return this._result=a,this._status=2,this._resolved(a),this.detach(),this},a.prototype.reject=function(a){if(0!==this._status)throw new Error("tried to reject a fulfilled promise");return this._error=a,this._status=1,this._rejected(a),this.detach(),this},a.prototype.detach=function(){this._resolved=function(){},this._rejected=function(){}},a}();a.generator=h,a.iterator=i;var o=function(){function a(a){this.f=a,this.current=void 0}return a.prototype.advance=function(){var a=this,b=this.f();return b.then(function(b){return l(b)?!1:(a.current=b,!0)})},a}();a.each=j,a.isUndefined=l}(P||(P={}));var Q;!function(a){var b=function(){function a(a){var b=this;this.$el=a,this.$placeholder=this.$el.children("span"),0==this.$placeholder.length&&this.$el.append(this.$placeholder=$("<span></span>")),this.$list=this.$el.children("ul"),0==this.$list.length&&this.$el.append(this.$list=$('<ul tabindex="1"></ul>')),this.$el.on("click",function(){return b.$el.toggleClass("active"),!1}),this.clear()}return a.prototype.clear=function(){this.value=null,this.map=Object.create(null),this.$list.empty(),this.$placeholder.text("-")},a.prototype.add=function(a,b){var c=this;b=b||a;var d=$('<a href="#"></a>').data("value",b).text(a),e=$("<li></li>").append(d);d.on("click",function(){return c.$el.removeClass("active"),c.select(b),!1}),this.$list.append(e),this.map[b]={text:a,value:b}},a.prototype.select=function(a){var b=this.map[a];b?(this.value=b.value,this.$placeholder.text(b.text),"function"==typeof this.change&&this.change(this,b.value)):(this.value=null,this.$placeholder.text("-"))},a.prototype.getValue=function(){return this.value},a}();a.DropDown=b,$(document).on("click",function(){$(".ui.dropdown").removeClass("active")})}(Q||(Q={}));var R,S=function(){function a(b,c){if(0==b.length)throw new Error;this.pages=b,this.config=$.extend(a.defaultConfig,c),this.$root=$("body"),this.$tour=null,this.$progress=null,this.pageIndex=this.config.pageIndex,this.create()}return a.buildPages=function(a){var b=[];return $(a).each(function(a,c){var d=$(c);b.push({selection:$(d.data("query")),content:d.html(),position:d.data("position")})}),b},a.prototype.create=function(){var a=this,b=['<div class="tour-block vertical flex">','<a href="#" class="tour-close"></a>','<div class="tour-content fill article"></div>','<div class="tour-progress-wrapper horizontal flex align-center">','<div class="tour-progress-bar horizontal flex align-center fill"></div>','<a href="#" class="tour-prev"></a>','<a href="#" class="tour-next"></a>',"</div>","</div>"].join(""),c=$(b);c.find(".tour-close").on("click",function(b){b.preventDefault(),a.stop()}),c.find(".tour-prev").on("click",function(b){b.preventDefault(),a.prev()}),c.find(".tour-next").on("click",function(b){b.preventDefault(),a.next()}),c.hide(),this.$tour=c,this.$progress=c.find(".tour-progress-bar");for(var d=0;d<this.pages.length;d++)this.$progress.append($("<span class='pi'></span>"));this.$root.append(this.$tour)},a.prototype.bindEvents=function(){var a=this;$(window).on("resize.Tour",function(b){a.resizeEvent.call(a,b)}),$(window.document).on("keydown.Tour",function(b){a.keyEvent.call(a,b)})},a.prototype.unbindEvents=function(){$(window).off("resize.Tour"),$(window.document).off("keydown.Tour")},a.prototype.resizeEvent=function(){this.run()},a.prototype.keyEvent=function(a){switch(a.keyCode){case 27:a.preventDefault(),this.stop();break;case 37:case 38:a.preventDefault(),this.prev();break;case 39:case 40:a.preventDefault(),this.next()}},a.prototype.next=function(){this.isLast()?this.stop():this.canGoNext()&&(this.increaseIndex(),this.run(),this.callCallback())},a.prototype.prev=function(){this.isFirst()||this.canGoPrev()&&(this.decreaseIndex(),this.run(),this.callCallback())},a.prototype.run=function(){var a=this.pages[this.pageIndex];this.showCurrentPage(a),this.config.onChange(this.pageIndex,a)},a.prototype.showCurrentPage=function(a){"string"==typeof a.selection&&(a.selection=$(a.selection)),this.updateTourBlock(a),this.showTourBlock(a)},a.prototype.isFirst=function(){return 0===this.pageIndex},a.prototype.isLast=function(){return this.pageIndex===this.pages.length-1},a.prototype.callCallback=function(){var a=this.pages[this.pageIndex].callback;"function"==typeof a&&a(this.pageIndex)},a.prototype.canGoPrev=function(){var a=this.pages[this.pageIndex],b=a.canGoPrev||this.config.canGoPrev;return b?b(a):!0},a.prototype.canGoNext=function(){var a=this.pages[this.pageIndex],b=a.canGoNext||this.config.canGoNext;return b?b(a):!0},a.prototype.increaseIndex=function(){this.pageIndex<this.pages.length-1&&this.pageIndex++},a.prototype.decreaseIndex=function(){this.pageIndex>0&&this.pageIndex--},a.prototype.updateTourBlock=function(a){var b=this.$tour,c=this.$progress,d=a.prevLabel||this.config.prevLabel,e=a.nextLabel||this.config.nextLabel,f=a.finishLabel||this.config.finishLabel,g=c.children();g.removeClass("current"),$(g[this.pageIndex]).addClass("current"),b.find(".tour-content").html(a.content),b.find(".tour-prev").html(d).toggle(!this.isFirst()),b.find(".tour-next").html(this.isLast()?f:e).toggle(!0),b.removeClass("slide s n e w"),b.addClass(a.selection.length?a.position:"slide"),this.setTourBlockPosition(a,"left"),this.setTourBlockPosition(a,"top")},a.prototype.setTourBlockPosition=function(a,b){var c=this.$tour,d=a.selection,e=d.offset(),f=$(window).width(),g=$(window).height(),h=d.outerWidth(),i=d.outerHeight(),j=c.outerWidth(),k=c.outerHeight(),l=10,m=10,n=0,o=0;switch(a.position){case"e":n=e.left+h+m,o=e.top-(k-i)/2;break;case"s":n=e.left+(h-j)/2,o=e.top+i+l;break;case"w":n=e.left-(m+j),o=e.top-(k-i)/2;break;case"n":n=e.left+(h-j)/2,o=e.top-l-k;break;default:n=(f-j)/2,o=(g-k)/2}c.css("left"===b?{left:n}:{top:o})},a.prototype.showTourBlock=function(){this.$tour.show();var a=$(window).height(),b=$(window).scrollTop(),c=this.$tour.offset().top,d=100;b+a>c&&c>=b||this.$root.animate({scrollTop:c-d},"slow")},a.prototype.hideTourBlock=function(){var a=this.$tour;a.fadeOut("slow",function(){a.removeClass("slide s n e w"),a.find(".tour-content").empty()})},a.prototype.start=function(){this.config.onStart(),this.bindEvents(),this.run()},a.prototype.stop=function(){this.unbindEvents(),this.hideTourBlock(),this.pageIndex=this.config.pageIndex,this.config.onStop()},a.defaultConfig={pageIndex:0,nextLabel:"Next",prevLabel:"Back",finishLabel:"Close",canGoNext:function(){return!0},canGoPrev:function(){return!0},onStart:$.noop,onStop:$.noop,onChange:$.noop},a}(),T=(j("0123456789"),j("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~")),U=function(){function a(a){this.text=a,this.reset()}return a.prototype.reset=function(){this.offset=0,this.next=null},a.prototype.nextWord=function(b){for(b=b||15;;){var c=this.next,d=this.nextWordImpl(b);if(null==d){if(null==c)return"empty";this.reset(),c!=a.SPLIT&&(this.next=a.SPLIT)}else{if(null==c&&d==a.SPLIT)continue;if(null==c&&"\n"==d)continue;if(c==a.SPLIT&&d==a.SPLIT){this.next=a.SPLIT;continue}if(c==a.SPLIT&&"\n"==d){this.next=a.SPLIT;continue}if("\n"==c&&d==a.SPLIT){this.next=a.SPLIT;continue}if("\n"==c&&"\n"==d){this.next="\n";continue}this.next=d}if(null!=c)return c}},a.prototype.nextWordImpl=function(b){if(this.skipWs())return"\n";if(this.offset==this.text.length)return null;for(var c=this.offset;this.offset<this.text.length&&this.offset-c<b;){var d=this.text.charCodeAt(this.offset);if(H.isWs(d))break;this.offset++}var e=this.text.substring(c,this.offset);return e==a.SPLIT&&this.skipWs(),e},a.prototype.skipWs=function(){for(var a=!1;this.offset<this.text.length;){var b=this.text.charCodeAt(this.offset);if(!H.isWs(b))break;H.isNl(b)&&(a=!0),this.offset++}return a},a.SPLIT=">>>",a}(),V=function(){function a(a){this.text=a}return a.prototype.generate=function(){return this.text},a}(),W=function(){function a(a,b,c){this.wordLimit=20,this.fragmentLimit=80,a=b.simplify?i(a,c.characters,T):i(a,c.characters),b.lowercase&&(a=a.toLowerCase()),this.text=a,this.parser=new U(this.text),this.nextWord()}return a.prototype.generate=function(){for(var a="",b=0,c=" ";this.word!=U.SPLIT&&5>b;){if(""==a)"\n"!=this.word&&(a=this.word);else if("\n"==this.word)c="\n",b++;else{if(a.length+this.word.length+1>this.fragmentLimit)break;a=a+c+this.word,c=" "}this.nextWord()}for(;this.word==U.SPLIT;)this.nextWord();return a},a.prototype.nextWord=function(){return this.word=this.parser.nextWord(this.wordLimit)},a}(),X=function(){function a(a,b){this.letters=[],this.wordLimit=8,this.fragmentLimit=80,this.enableCapitals=!1,this.enablePunctuators=!1,this.punctuators=["."],this.letters=a,this.generator=b}return a.prototype.getBoostFactor=function(a){for(var b=0,c=null,d=0;d<this.letters.length;d++){var e=this.letters[d];e.charCode==a&&(c=e.f),b=Math.max(b,e.f)}if(null==c)throw new Error;return b/c},a.prototype.generate=function(){this.generator.reset();for(var a="",b="";;){var c=b=this.nextWord(b);if(this.enableCapitals&&(c=c.substring(0,1).toUpperCase()+c.substring(1)),this.enablePunctuators){var d=this.punctuators[Math.floor(Math.random()*this.punctuators.length)];switch(d){case null:break;case"-":c=c+"-"+this.nextWord(b);break;case"(":c="("+c+")";break;case"[":c="["+c+"]";break;case'"':c='"'+c+'"';break;case"'":c=c+"'"+this.nextWord(b);break;default:c+=d}}if(0==a.length){if(a=c,a.length>this.fragmentLimit)break}else{if(a.length+1+c.length>this.fragmentLimit)break;a+=" "+c}}return a},a.prototype.nextWord=function(a){try{for(;;){var b=this.generator.next(this.filter,this.boost,this.wordLimit);if(b!=a)return b}}catch(c){return"x"}},a.create=function(b){function c(){for(var a=new Uint8Array(b,0),c=9,d=a[c++],e=0;d>e;e++)m+=String.fromCharCode(256*a[c++]+a[c++]);l=a[c++]-1;var f=c,g=f+2*Math.pow(m.length,l);n=new Uint8Array(b,f,g-f),o=new Uint8Array(b,g)}function d(a,b){for(var c=m.length,d=0,e=1,f=0;l>f;f++)d+=e*b[l-f-1],e*=c;d*=2,d=n[d]<<8|n[d+1];var g=[],h=0;if(65535!=d){var i=o[d]>>4&15,j=15&o[d];for(d++;;){for(;i>0;){var k=m.charCodeAt(h),p=o[d];(32==k||null==a||-1!=a.indexOf(k))&&g.push(new Y(h,k,p)),d++,h++,i--}if(h+=j,h==c)break;i=o[d]>>>4&15,j=15&o[d],d++}}return g}function e(a,b){for(var c=0;c<b.length;c++){var d=m.charCodeAt(b[c]);if(d>32&&-1==a.indexOf(d))return!1}return!0}function f(a,b){var c=p[b];if(null==c)throw new Error;if(a){for(var d=[],f=0;f<c.length;f++){var g=c[f];e(a,g)&&d.push(g)}if(d.length>0)return d}return c}function g(){for(var a=Object.create(null),b=0;b<m.length;b++){var c=m.charCodeAt(b);a[c]=0,p[c]=[]}return a}function h(a,b,c,e){for(var f=0;f<m.length;f++)if(a[b]=f,l-1>b)h(a,b+1,c,e||0==b&&0==f);else for(var g=d(null,a),i=0;i<g.length;i++){var j=g[i],k=c[j.charCode];if(k+=j.weight,c[j.charCode]=k,e){var n=p[j.charCode],o=a.slice(0);o.push(j.index),o.shift(),n.push(o)}}}function i(a){for(var b=0,c=0;c<m.length;c++){var d=m.charCodeAt(c);d>32&&(b+=a[d])}for(var e=[],c=0;c<m.length;c++){var d=m.charCodeAt(c);d>32&&e.push(new Lb(d,a[d]/b))}return e}function j(a){for(var b=0;l>b;b++)a[b]=0}function k(a,b,c){function e(){if(j(s),g="",h){if(!h.length)throw new Error;s=h[Math.floor(Math.random()*h.length)].slice(0);for(var a=0;l>a;a++){var b=m.charCodeAt(s[a]);b>32&&(g+=String.fromCharCode(b))}}}var g,h;for(b&&(h=f(a,b.charCode)),e();;){var i=d(a,s);if(0==i.length)e();else{var k=Y.pickRandom(i);if(s.push(k.index),s.shift(),32==k.charCode){if(!(g.length<3))return g;e()}else g.length==c?e():g+=String.fromCharCode(k.charCode)}}}var l=0,m="",n=null,o=null,p=Object.create(null);c();var q=g();h(new Array(l),0,q,!1);var r=i(q),s=new Array(l);return new a(r,{reset:function(){j(s)},next:function(a,b,c){return k(a,b,c)}})},a.load=function(b,c){b.lang&&(b=b.lang);var d=a.CACHE.get(b);d.done(function(b){c(a.create(b))})},a.CACHE=new L(function(a){var b=P.defer(),c=new XMLHttpRequest;return c.onload=function(){b.resolve(c.response)},c.onerror=function(a){b.reject(a)},c.open("GET","/data/lang-"+a+".data",!0),c.responseType="arraybuffer",c.send(),b.promise()}),a}(),Y=function(){function a(a,b,c){this.index=a,this.charCode=b,this.weight=c}return a.boost=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e.charCode==b)return e.weight=Math.round(e.weight*c),!0}return!1},a.weight=function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];b+=d.weight}return b},a.pickRandom=function(b){for(var c=a.weight(b),d=Math.floor(Math.random()*(c+1)),e=0;e<b.length;e++){var f=b[e];if(d<=f.weight)return f;d-=f.weight}throw new Error},a}(),Z=function(){function a(a,b,c){return this.id=a,this.xid=b,this.name=c,Object.freeze(this)}return a.prototype.valueOf=function(){return this.id},a.prototype.toString=function(){return this.id},a}(),_={EN:new Z("en",jb,"English"),DE:new Z("de",kb,"German"),FR:new Z("fr",lb,"French"),IT:new Z("it",mb,"Italian"),ES:new Z("es",nb,"Spanish"),PT:new Z("pt",ob,"Portuguese"),RU:new Z("ru",pb,"Russian")},ab=function(){function a(a,b,c,d,e,f){function g(a){return String.fromCharCode(a).toUpperCase()}return this.id=a,this.keyCode=b,this.primary=c||0,this.primaryShift=d||0,this.secondary=e||0,this.secondaryShift=f||0,this.alpha=this.primary>0&&this.primaryShift>0&&g(this.primary)==g(this.primaryShift),Object.freeze(this)}return a.prototype.charCode=function(a,b){function c(a,b,c,d){return d>0?d:c>0?c:b>0?b:a}return b?a?c(this.primary,this.primaryShift,this.secondary,this.secondaryShift):c(this.primary,this.secondary,0,0):a?c(this.primary,this.primaryShift,0,9):this.primary},a}(),bb=function(){function a(a,b,c,d,e,f,g){function h(a,b,c,d,e){var f=1;return a&&f++,b&&f++,c&&(f++,d&&f++,e&&f++),f}return this.charCode=a,this.key=b,this.shift=c,this.alt=d,this.deadKey=e,this.deadShift=f,this.deadAlt=g,this.complexity=h(c,d,e,f,g),Object.freeze(this)}return a.prototype.applyDeadKey=function(b,c,d,e){return new a(b,this.key,this.shift,this.alt,c,d,e)},a}(),cb=function(){function a(a,b,c,d,e,f,g){function h(a){var b=l.comboMap[a.charCode];if(b){if(b.deadKey&&a.deadKey)throw new Error;b.deadKey&&!a.deadKey&&(l.comboMap[a.charCode]=a)}else l.comboMap[a.charCode]=a;l.characters.push(a.charCode)}function i(a,b,c,d){a>0&&!H.isCombining(a)&&(m.push(a),h(new bb(a,b,c,d)))}function j(a,b,c,d){if(a>0&&H.isCombining(a))for(var e=0;e<m.length;e++){var f=m[e],g=H.combine(f,a);if(g!=f){var i=l.comboMap[f];h(i.applyDeadKey(g,b,c,d))}}}this.id=a,this.xid=b,this.name=c,this.lang=d,this.config={emulate:!1},this.byKeyCodeMap={},this.byIdMap={},this.comboMap={},this.characters=[],this.id=a,this.xid=b,this.name=c,this.lang=d,this.geometryMap=f,this.variantOf=g;for(var a in e){var k=e[a];this.byKeyCodeMap[k.keyCode]=this.byIdMap[a]=new ab(a,k.keyCode,k.a,k.b,k.c,k.d)}var l=this,m=[];for(var a in this.byIdMap){var n=this.byIdMap[a];i(n.primary,n,!1,!1),i(n.primaryShift,n,!0,!1),i(n.secondary,n,!1,!0),i(n.secondaryShift,n,!0,!0)}for(var a in this.byIdMap){var n=this.byIdMap[a];j(n.primary,n,!1,!1),j(n.primaryShift,n,!0,!1),j(n.secondary,n,!1,!0),j(n.secondaryShift,n,!0,!0)}return this.characters.sort(),Object.freeze(this)}return a.prototype.configure=function(a){this.config.emulate=a.emulateLayout},a.prototype.createEventHandler=function(a){return new db(this,a)},a.prototype.keyCombo=function(a){return this.comboMap[a]},a.prototype.complexity=function(a){for(var b=0,c=[],d=0;d<a.length;d++){var e=a.charCodeAt(d);if(-1==c.indexOf(e)){c.push(e);var f=this.keyCombo(e);f?b+=f.complexity:b++}}return b},a.prototype.filterLetters=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.keyCombo(d.charCode);e&&!e.deadKey&&b.push(d)}return b},a.prototype.getKeyId=function(a){var b=(KeyboardEvent.DOM_KEY_LOCATION_LEFT||1,KeyboardEvent.DOM_KEY_LOCATION_RIGHT||2),c=KeyboardEvent.DOM_KEY_LOCATION_NUMPAD||3;if(a.location==c)switch(a.keyCode){case 8:return"numpad-backspace";case 13:return R[R.KPEN];case 45:return R[R.KP0];case 46:return R[R.KPDL];case 35:return R[R.KP1];case 40:return R[R.KP2];case 34:return R[R.KP3];case 37:return R[R.KP4];case 12:return R[R.KP5];case 39:return R[R.KP6];case 36:return R[R.KP7];case 38:return R[R.KP8];case 33:return R[R.KP9]}switch(a.keyCode){case 16:return R[a.location==b?R.RTSH:R.LFSH];case 17:return R[a.location==b?R.RCTL:R.LCTL];case 18:return R[a.location==b?R.RALT:R.LALT];case 8:return R[R.BKSP];case 9:return R[R.TAB];case 13:return R[R.RTRN];case 20:return R[R.CAPS];case 32:return R[R.SPCE]}if(this.config.emulate)return R[a.keyCode];var d=this.byKeyCodeMap[a.keyCode];return d?d.id:R[a.keyCode]},a}(),db=function(){function a(a,b){this.layout=a,this.sink=b,this.last=0}return a.prototype.keyDown=function(a){if(!a.ctrlKey&&!a.metaKey){var b=0;switch(a.keyCode){case 8:b=8;break;case 9:b=9;break;case 13:b=10;break;case 32:b=32;break;case 106:b=42;break;case 107:b=43;break;case 109:b=45;break;case 110:b=46;break;case 111:b=47;break;case 96:b=48;break;case 97:b=49;break;case 98:b=50;break;case 99:b=51;break;case 100:b=52;break;case 101:b=53;break;case 102:b=54;break;case 103:b=55;break;case 104:b=56;break;case 105:b=57}if(b)this.sink(this.last=b);else{var c;if(c=this.layout.config.emulate?this.layout.byIdMap[R[a.keyCode]]:this.layout.byKeyCodeMap[a.keyCode],c&&(b=a.altKey?a.shiftKey?c.secondaryShift:c.secondary:a.shiftKey?c.primaryShift:c.primary))return H.isCombining(b)?this.last=b:this.sink(H.isCombining(this.last)?this.last=H.combine(b,this.last):this.last=b),!0}}return!1},a.prototype.keyUp=function(){},a}(),eb=function(){function a(a,b,c){this.layout=a,this.key=b,this.geometry=c,this.$root=new SVG.Element(fb.cloneNode(this.geometry.shape));var d=this.$root.node,e=d.querySelector(".symbol"),f=d.querySelector(".symbol-primary-shift"),g=d.querySelector(".symbol-primary"),h=d.querySelector(".symbol-secondary-shift"),i=d.querySelector(".symbol-secondary");this.key&&(this.key.alpha?(e.textContent=fb.label(this.key.primary).toUpperCase(),d.removeChild(f),d.removeChild(g),d.removeChild(h),d.removeChild(i)):(d.removeChild(e),this.key.primaryShift?f.textContent=fb.label(this.key.primaryShift):d.removeChild(f),this.key.primary?g.textContent=fb.label(this.key.primary):d.removeChild(g),this.key.secondaryShift?h.textContent=fb.label(this.key.secondaryShift):d.removeChild(h),this.key.secondary?i.textContent=fb.label(this.key.secondary):d.removeChild(i))),this.$root.move(this.geometry.x,this.geometry.y),this.geometry.zone&&D.classList.add(d,this.geometry.zone)}return a.prototype.pressed=function(a){a?D.classList.add(this.$root.node,"down"):D.classList.remove(this.$root.node,"down")},a}(),fb=function(){function a(a){var b=a.querySelector(".layout");this.$layout=b.instance||new SVG.Container(b);var c=a.querySelector(".overlay");this.$overlay=c.instance||new SVG.Container(c)}return a.prototype.init=function(a,b){this.layout=a,this.keyUiMap=Object.create(null),this.$layout.clear(),this.$overlay.clear(),this.addSection(this.layout.geometryMap),b&&(this.addSection(gb.CURSOR),this.addSection(gb.NUMPAD))},a.prototype.addSection=function(a){for(var b in a){var c=a[b],d=new eb(this.layout,this.layout.byIdMap[b],c);this.keyUiMap[b]=d,this.$layout.add(d.$root)}},a.prototype.getKeyPoint=function(a){var b=this.layout.geometryMap[a];if(b){var c=this.keyUiMap[a].$root.bbox(),d=b.x+c.width/2,e=b.y+c.height/2;return{cx:d,cy:e}}return null},a.prototype.keyDown=function(a){var b=this.layout.getKeyId(a),c=this.keyUiMap[b];c&&c.pressed(!0),this.unpressSpecial(a)},a.prototype.keyUp=function(a){var b=this.layout.getKeyId(a),c=this.keyUiMap[b];c&&c.pressed(!1),this.unpressSpecial(a)},a.prototype.unpressSpecial=function(a){a.ctrlKey||(this.keyUiMap[R[R.LCTL]].pressed(!1),this.keyUiMap[R[R.RCTL]].pressed(!1)),a.altKey||(this.keyUiMap[R[R.LALT]].pressed(!1),this.keyUiMap[R[R.RALT]].pressed(!1)),a.shiftKey||(this.keyUiMap[R[R.LFSH]].pressed(!1),this.keyUiMap[R[R.RTSH]].pressed(!1))},a.prototype.highlight=function(a){if(this.$overlay.clear(),a){{this.layout.geometryMap}switch(a){case 8:return void this._highlight(R[R.TAB]);case 10:return void this._highlight(R[R.RTRN]);case 32:return void this._highlight(R[R.SPCE])}var b=this.layout.keyCombo(a);b&&(this._highlight(b.key.id),b.shift&&(this._highlight(R[R.LFSH]),this._highlight(R[R.RTSH])),b.alt&&this._highlight(R[R.RALT]),b.deadKey&&(this._highlight(b.deadKey.id),b.deadShift&&!b.shift&&(this._highlight(R[R.LFSH]),this._highlight(R[R.RTSH])),b.deadAlt&&!b.alt&&this._highlight(R[R.RALT])))}},a.prototype._highlight=function(b){var c=this.keyUiMap[b],d=c.$root.bbox(),e=c.geometry.x+d.width/2,f=c.geometry.y+d.height/2,g=new SVG.Element(a.cloneNode("key-hl"));this.$overlay.add(g),g.move(e,f)},a.prototype.reset=function(){for(var a in this.keyUiMap)this.keyUiMap[a].pressed(!1)},a.prototype.createAnimation=function(){var a=[];for(var b in this.keyUiMap)a.push(this.keyUiMap[b].$root.node);return new Jb(a)},a.cloneNode=function(a){return"string"==typeof a&&(a=document.getElementById(a)),a=a.cloneNode(!0),a.setAttribute("id",SVG.eid("x")),a},a.label=function(a){return H.isCombining(a)&&(a=H.combinerImage(a)),String.fromCharCode(a)},a}(),gb=function(){var a=Object.freeze({TLDE:{x:0,y:0,shape:"key",zone:"z1"},AE01:{x:42,y:0,shape:"key",zone:"z1"},AE02:{x:84,y:0,shape:"key",zone:"z2"},AE03:{x:126,y:0,shape:"key",zone:"z3"},AE04:{x:168,y:0,shape:"key",zone:"z4"},AE05:{x:210,y:0,shape:"key",zone:"z4"},AE06:{x:252,y:0,shape:"key",zone:"z5"},AE07:{x:294,y:0,shape:"key",zone:"z5"},AE08:{x:336,y:0,shape:"key",zone:"z6"},AE09:{x:378,y:0,shape:"key",zone:"z7"},AE10:{x:420,y:0,shape:"key",zone:"z8"},AE11:{x:462,y:0,shape:"key",zone:"z8"},AE12:{x:504,y:0,shape:"key",zone:"z8"},BKSP:{x:546,y:0,shape:"key-backspace",zone:""},TAB:{x:0,y:42,shape:"key-tab",zone:""},AD01:{x:65,y:42,shape:"key",zone:"z1"},AD02:{x:107,y:42,shape:"key",zone:"z2"},AD03:{x:149,y:42,shape:"key",zone:"z3"},AD04:{x:191,y:42,shape:"key",zone:"z4"},AD05:{x:233,y:42,shape:"key",zone:"z4"},AD06:{x:275,y:42,shape:"key",zone:"z5"},AD07:{x:317,y:42,shape:"key",zone:"z5"},AD08:{x:359,y:42,shape:"key",zone:"z6"},AD09:{x:401,y:42,shape:"key",zone:"z7"},AD10:{x:443,y:42,shape:"key",zone:"z8"},AD11:{x:485,y:42,shape:"key",zone:"z8"},AD12:{x:527,y:42,shape:"key",zone:"z8"},CAPS:{x:0,y:84,shape:"key-caps-lock",zone:""},AC01:{x:72,y:84,shape:"key",zone:"z1"},AC02:{x:114,y:84,shape:"key",zone:"z2"},AC03:{x:156,y:84,shape:"key",zone:"z3"},AC04:{x:198,y:84,shape:"key",zone:"z4"},AC05:{x:240,y:84,shape:"key",zone:"z4"},AC06:{x:282,y:84,shape:"key",zone:"z5"},AC07:{x:324,y:84,shape:"key",zone:"z5"},AC08:{x:366,y:84,shape:"key",zone:"z6"},AC09:{x:408,y:84,shape:"key",zone:"z7"},AC10:{x:450,y:84,shape:"key",zone:"z8"},AC11:{x:492,y:84,shape:"key",zone:"z8"},BKSL:{x:534,y:84,shape:"key",zone:"z8"},RTRN:{x:569,y:42,shape:"key-enter",zone:""},LFSH:{x:0,y:126,shape:"key-left-shift",zone:""},AB01:{x:94,y:126,shape:"key",zone:"z1"},AB02:{x:136,y:126,shape:"key",zone:"z2"},AB03:{x:178,y:126,shape:"key",zone:"z3"},AB04:{x:220,y:126,shape:"key",zone:"z4"},AB05:{x:262,y:126,shape:"key",zone:"z4"},AB06:{x:304,y:126,shape:"key",zone:"z5"},AB07:{x:346,y:126,shape:"key",zone:"z5"},AB08:{x:388,y:126,shape:"key",zone:"z6"},AB09:{x:430,y:126,shape:"key",zone:"z7"},AB10:{x:472,y:126,shape:"key",zone:"z8"},RTSH:{x:514,y:126,shape:"key-right-shift",zone:""},LCTL:{x:0,y:168,shape:"key-ctrl",zone:""},LALT:{x:65,y:168,shape:"key-alt",zone:""},SPCE:{x:130,y:168,shape:"key-space",zone:""},RALT:{x:501,y:168,shape:"key-alt",zone:""},RCTL:{x:566,y:168,shape:"key-ctrl",zone:""}}),b=Object.freeze({TLDE:{x:0,y:0,shape:"key",zone:"z1"},AE01:{x:42,y:0,shape:"key",zone:"z1"},AE02:{x:84,y:0,shape:"key",zone:"z2"},AE03:{x:126,y:0,shape:"key",zone:"z3"},AE04:{x:168,y:0,shape:"key",zone:"z4"},AE05:{x:210,y:0,shape:"key",zone:"z4"},AE06:{x:252,y:0,shape:"key",zone:"z5"},AE07:{x:294,y:0,shape:"key",zone:"z5"},AE08:{x:336,y:0,shape:"key",zone:"z6"},AE09:{x:378,y:0,shape:"key",zone:"z7"},AE10:{x:420,y:0,shape:"key",zone:"z8"},AE11:{x:462,y:0,shape:"key",zone:"z8"},AE12:{x:504,y:0,shape:"key",zone:"z8"},BKSP:{x:546,y:0,shape:"key-backspace",zone:""},TAB:{x:0,y:42,shape:"key-tab",zone:""},AD01:{x:65,y:42,shape:"key",zone:"z1"},AD02:{x:107,y:42,shape:"key",zone:"z2"},AD03:{x:149,y:42,shape:"key",zone:"z3"},AD04:{x:191,y:42,shape:"key",zone:"z4"},AD05:{x:233,y:42,shape:"key",zone:"z4"},AD06:{x:275,y:42,shape:"key",zone:"z5"},AD07:{x:317,y:42,shape:"key",zone:"z5"},AD08:{x:359,y:42,shape:"key",zone:"z6"},AD09:{x:401,y:42,shape:"key",zone:"z7"},AD10:{x:443,y:42,shape:"key",zone:"z8"},AD11:{x:485,y:42,shape:"key",zone:"z8"},AD12:{x:527,y:42,shape:"key",zone:"z8"},CAPS:{x:0,y:84,shape:"key-caps-lock",zone:""},AC01:{x:72,y:84,shape:"key",zone:"z1"},AC02:{x:114,y:84,shape:"key",zone:"z2"},AC03:{x:156,y:84,shape:"key",zone:"z3"},AC04:{x:198,y:84,shape:"key",zone:"z4"},AC05:{x:240,y:84,shape:"key",zone:"z4"},AC06:{x:282,y:84,shape:"key",zone:"z5"},AC07:{x:324,y:84,shape:"key",zone:"z5"},AC08:{x:366,y:84,shape:"key",zone:"z6"},AC09:{x:408,y:84,shape:"key",zone:"z7"},AC10:{x:450,y:84,shape:"key",zone:"z8"},AC11:{x:492,y:84,shape:"key",zone:"z8"},BKSL:{x:534,y:84,shape:"key",zone:"z8"},RTRN:{x:569,y:42,shape:"key-enter",zone:""},LFSH:{x:0,y:126,shape:"key-left-shift-small",zone:""},LSGT:{x:52,y:126,shape:"key",zone:"z1"},AB01:{x:94,y:126,shape:"key",zone:"z1"},AB02:{x:136,y:126,shape:"key",zone:"z2"},AB03:{x:178,y:126,shape:"key",zone:"z3"},AB04:{x:220,y:126,shape:"key",zone:"z4"},AB05:{x:262,y:126,shape:"key",zone:"z4"},AB06:{x:304,y:126,shape:"key",zone:"z5"},AB07:{x:346,y:126,shape:"key",zone:"z5"},AB08:{x:388,y:126,shape:"key",zone:"z6"},AB09:{x:430,y:126,shape:"key",zone:"z7"},AB10:{x:472,y:126,shape:"key",zone:"z8"},RTSH:{x:514,y:126,shape:"key-right-shift",zone:""},LCTL:{x:0,y:168,shape:"key-ctrl",zone:""},LALT:{x:65,y:168,shape:"key-alt",zone:""},SPCE:{x:130,y:168,shape:"key-space",zone:""},RALT:{x:501,y:168,shape:"key-alt-gr",zone:""},RCTL:{x:566,y:168,shape:"key-ctrl",zone:""}}),c=Object.freeze({TLDE:{x:0,y:0,shape:"key",zone:"z1"},AE01:{x:42,y:0,shape:"key",zone:"z1"},AE02:{x:84,y:0,shape:"key",zone:"z2"},AE03:{x:126,y:0,shape:"key",zone:"z3"},AE04:{x:168,y:0,shape:"key",zone:"z4"},AE05:{x:210,y:0,shape:"key",zone:"z4"},AE06:{x:252,y:0,shape:"key",zone:"z5"},AE07:{x:294,y:0,shape:"key",zone:"z5"},AE08:{x:336,y:0,shape:"key",zone:"z6"},AE09:{x:378,y:0,shape:"key",zone:"z7"},AE10:{x:420,y:0,shape:"key",zone:"z8"},AE11:{x:462,y:0,shape:"key",zone:"z8"},AE12:{x:504,y:0,shape:"key",zone:"z8"},BKSP:{x:546,y:0,shape:"key-backspace",zone:""},TAB:{x:0,y:42,shape:"key-tab",zone:""},AD01:{x:65,y:42,shape:"key",zone:"z1"},AD02:{x:107,y:42,shape:"key",zone:"z2"},AD03:{x:149,y:42,shape:"key",zone:"z3"},AD04:{x:191,y:42,shape:"key",zone:"z4"},AD05:{x:233,y:42,shape:"key",zone:"z4"},AD06:{x:275,y:42,shape:"key",zone:"z5"},AD07:{x:317,y:42,shape:"key",zone:"z5"},AD08:{x:359,y:42,shape:"key",zone:"z6"},AD09:{x:401,y:42,shape:"key",zone:"z7"},AD10:{x:443,y:42,shape:"key",zone:"z8"},AD11:{x:485,y:42,shape:"key",zone:"z8"},AD12:{x:527,y:42,shape:"key",zone:"z8"},BKSL:{x:569,y:42,shape:"key-wide",zone:"z8"},CAPS:{x:0,y:84,shape:"key-caps-lock",zone:""},AC01:{x:72,y:84,shape:"key",zone:"z1"},AC02:{x:114,y:84,shape:"key",zone:"z2"},AC03:{x:156,y:84,shape:"key",zone:"z3"},AC04:{x:198,y:84,shape:"key",zone:"z4"},AC05:{x:240,y:84,shape:"key",zone:"z4"},AC06:{x:282,y:84,shape:"key",zone:"z5"},AC07:{x:324,y:84,shape:"key",zone:"z5"},AC08:{x:366,y:84,shape:"key",zone:"z6"},AC09:{x:408,y:84,shape:"key",zone:"z7"},AC10:{x:450,y:84,shape:"key",zone:"z8"},AC11:{x:492,y:84,shape:"key",zone:"z8"},RTRN:{x:534,y:84,shape:"key-enter-small",zone:""},LFSH:{x:0,y:126,shape:"key-left-shift",zone:""},AB01:{x:94,y:126,shape:"key",zone:"z1"},AB02:{x:136,y:126,shape:"key",zone:"z2"},AB03:{x:178,y:126,shape:"key",zone:"z3"},AB04:{x:220,y:126,shape:"key",zone:"z4"},AB05:{x:262,y:126,shape:"key",zone:"z4"},AB06:{x:304,y:126,shape:"key",zone:"z5"},AB07:{x:346,y:126,shape:"key",zone:"z5"},AB08:{x:388,y:126,shape:"key",zone:"z6"},AB09:{x:430,y:126,shape:"key",zone:"z7"},AB10:{x:472,y:126,shape:"key",zone:"z8"},RTSH:{x:514,y:126,shape:"key-right-shift",zone:""},LCTL:{x:0,y:168,shape:"key-ctrl",zone:""},LALT:{x:65,y:168,shape:"key-alt",zone:""},SPCE:{x:130,y:168,shape:"key-space",zone:""},RALT:{x:501,y:168,shape:"key-alt",zone:""},RCTL:{x:566,y:168,shape:"key-ctrl",zone:""}}),d=Object.freeze({INS:{x:648,y:0,shape:"key-insert"},HOME:{x:690,y:0,shape:"key-home"},PGUP:{x:732,y:0,shape:"key-page-up"},DELE:{x:648,y:42,shape:"key-delete"},END:{x:690,y:42,shape:"key-end"},PGDN:{x:732,y:42,shape:"key-page-down"},UP:{x:690,y:126,shape:"key-up"},LEFT:{x:648,y:168,shape:"key-left"},DOWN:{x:690,y:168,shape:"key-down"},RGHT:{x:732,y:168,shape:"key-right"}}),e=Object.freeze({NMLK:{x:792,y:0,shape:"key-np-num-lock"},KPDV:{x:834,y:0,shape:"key-np-divide"},KPMU:{x:876,y:0,shape:"key-np-multiply"},KPSU:{x:918,y:0,shape:"key-np-subtract"},KP7:{x:792,y:42,shape:"key-np-7"},KP8:{x:834,y:42,shape:"key-np-8"},KP9:{x:876,y:42,shape:"key-np-9"},KPAD:{x:918,y:42,shape:"key-np-add"},KP4:{x:792,y:84,shape:"key-np-4"},KP5:{x:834,y:84,shape:"key-np-5"},KP6:{x:876,y:84,shape:"key-np-6"},KP1:{x:792,y:126,shape:"key-np-1"},KP2:{x:834,y:126,shape:"key-np-2"},KP3:{x:876,y:126,shape:"key-np-3"},KPEN:{x:918,y:126,shape:"key-np-enter"},KP0:{x:792,y:168,shape:"key-np-0"},KPDL:{x:876,y:168,shape:"key-np-decimal"}});return Object.freeze({TYPE_A:a,TYPE_B:b,TYPE_C:c,CURSOR:d,NUMPAD:e})}(),hb=function(){var a=Object.freeze({TLDE:{keyCode:192,a:96,b:126,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:35,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:null,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:219,a:91,b:123,c:null,d:null},AD12:{keyCode:221,a:93,b:125,c:null,d:null},BKSL:{keyCode:220,a:92,b:124,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:186,a:59,b:58,c:null,d:null},AC11:{keyCode:222,a:39,b:34,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null}}),b=Object.freeze({TLDE:{keyCode:192,a:96,b:172,c:166,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:34,c:null,d:null},AE03:{keyCode:51,a:51,b:163,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:8364,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:201,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:218,d:null},AD08:{keyCode:73,a:105,b:73,c:205,d:null},AD09:{keyCode:79,a:111,b:79,c:211,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:219,a:91,b:123,c:null,d:null},AD12:{keyCode:221,a:93,b:125,c:null,d:null},BKSL:{keyCode:220,a:35,b:126,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:193,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:186,a:59,b:58,c:null,d:null},AC11:{keyCode:222,a:39,b:64,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null},LSGT:{keyCode:226,a:92,b:124,c:null,d:null}}),c=Object.freeze({TLDE:{keyCode:192,a:96,b:126,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:163,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:201,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:219,a:91,b:123,c:null,d:null},AD12:{keyCode:221,a:93,b:125,c:null,d:null},BKSL:{keyCode:220,a:92,b:124,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:186,a:59,b:58,c:null,d:null},AC11:{keyCode:222,a:39,b:34,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null}}),d=Object.freeze({TLDE:{keyCode:192,a:96,b:126,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:35,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:219,a:91,b:123,c:null,d:null},AE12:{keyCode:221,a:93,b:125,c:null,d:null},AD01:{keyCode:222,a:39,b:34,c:null,d:null},AD02:{keyCode:188,a:44,b:60,c:null,d:null},AD03:{keyCode:190,a:46,b:62,c:null,d:null},AD04:{keyCode:80,a:112,b:80,c:null,d:null},AD05:{keyCode:89,a:121,b:89,c:null,d:null},AD06:{keyCode:70,a:102,b:70,c:null,d:null},AD07:{keyCode:71,a:103,b:71,c:null,d:null},AD08:{keyCode:67,a:99,b:67,c:null,d:null},AD09:{keyCode:82,a:114,b:82,c:null,d:null},AD10:{keyCode:76,a:108,b:76,c:null,d:null},AD11:{keyCode:191,a:47,b:63,c:null,d:null},AD12:{keyCode:187,a:61,b:43,c:null,d:null},BKSL:{keyCode:220,a:92,b:124,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:79,a:111,b:79,c:null,d:null},AC03:{keyCode:69,a:101,b:69,c:null,d:null},AC04:{keyCode:85,a:117,b:85,c:null,d:null},AC05:{keyCode:73,a:105,b:73,c:null,d:null},AC06:{keyCode:68,a:100,b:68,c:null,d:null},AC07:{keyCode:72,a:104,b:72,c:null,d:null},AC08:{keyCode:84,a:116,b:84,c:null,d:null},AC09:{keyCode:78,a:110,b:78,c:null,d:null},AC10:{keyCode:83,a:115,b:83,c:null,d:null},AC11:{keyCode:189,a:45,b:95,c:null,d:null},AB01:{keyCode:186,a:59,b:58,c:null,d:null},AB02:{keyCode:81,a:113,b:81,c:null,d:null},AB03:{keyCode:74,a:106,b:74,c:null,d:null},AB04:{keyCode:75,a:107,b:75,c:null,d:null},AB05:{keyCode:88,a:120,b:88,c:null,d:null},AB06:{keyCode:66,a:98,b:66,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:87,a:119,b:87,c:null,d:null},AB09:{keyCode:86,a:118,b:86,c:null,d:null},AB10:{keyCode:90,a:122,b:90,c:null,d:null}}),e=Object.freeze({TLDE:{keyCode:192,a:96,b:126,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:35,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:70,a:102,b:70,c:null,d:null},AD04:{keyCode:80,a:112,b:80,c:null,d:null},AD05:{keyCode:71,a:103,b:71,c:null,d:null},AD06:{keyCode:74,a:106,b:74,c:null,d:null},AD07:{keyCode:76,a:108,b:76,c:null,d:null},AD08:{keyCode:85,a:117,b:85,c:null,d:null},AD09:{keyCode:89,a:121,b:89,c:null,d:null},AD10:{keyCode:186,a:59,b:58,c:null,d:null},AD11:{keyCode:219,a:91,b:123,c:null,d:null},AD12:{keyCode:221,a:93,b:125,c:null,d:null},BKSL:{keyCode:220,a:92,b:124,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:82,a:114,b:82,c:null,d:null},AC03:{keyCode:83,a:115,b:83,c:null,d:null},AC04:{keyCode:84,a:116,b:84,c:null,d:null},AC05:{keyCode:68,a:100,b:68,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:78,a:110,b:78,c:null,d:null},AC08:{keyCode:69,a:101,b:69,c:null,d:null},AC09:{keyCode:73,a:105,b:73,c:null,d:null},AC10:{keyCode:79,a:111,b:79,c:null,d:null},AC11:{keyCode:222,a:39,b:34,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:75,a:107,b:75,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null}}),f=Object.freeze({TLDE:{keyCode:192,a:96,b:126,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:35,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:94,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:68,a:100,b:68,c:null,d:null},AD03:{keyCode:82,a:114,b:82,c:null,d:null},AD04:{keyCode:87,a:119,b:87,c:null,d:null},AD05:{keyCode:66,a:98,b:66,c:null,d:null},AD06:{keyCode:74,a:106,b:74,c:null,d:null},AD07:{keyCode:70,a:102,b:70,c:null,d:null},AD08:{keyCode:85,a:117,b:85,c:null,d:null},AD09:{keyCode:80,a:112,b:80,c:null,d:null},AD10:{keyCode:186,a:59,b:58,c:null,d:null},AD11:{keyCode:219,a:91,b:123,c:null,d:null},AD12:{keyCode:221,a:93,b:125,c:null,d:null},BKSL:{keyCode:220,a:92,b:124,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:72,a:104,b:72,c:null,d:null},AC04:{keyCode:84,a:116,b:84,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:89,a:121,b:89,c:null,d:null},AC07:{keyCode:78,a:110,b:78,c:null,d:null},AC08:{keyCode:69,a:101,b:69,c:null,d:null},AC09:{keyCode:79,a:111,b:79,c:null,d:null},AC10:{keyCode:73,a:105,b:73,c:null,d:null},AC11:{keyCode:222,a:39,b:34,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:77,a:109,b:77,c:null,d:null},AB04:{keyCode:67,a:99,b:67,c:null,d:null},AB05:{keyCode:86,a:118,b:86,c:null,d:null},AB06:{keyCode:75,a:107,b:75,c:null,d:null},AB07:{keyCode:76,a:108,b:76,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null}}),g=Object.freeze({TLDE:{keyCode:220,a:770,b:176,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:34,c:178,d:null},AE03:{keyCode:51,a:51,b:167,c:179,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:38,c:null,d:null},AE07:{keyCode:55,a:55,b:47,c:123,d:null},AE08:{keyCode:56,a:56,b:40,c:91,d:null},AE09:{keyCode:57,a:57,b:41,c:93,d:null},AE10:{keyCode:48,a:48,b:61,c:125,d:null},AE11:{keyCode:219,a:223,b:63,c:92,d:null},AE12:{keyCode:221,a:769,b:768,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:64,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:90,a:122,b:90,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:186,a:252,b:220,c:null,d:null},AD12:{keyCode:187,a:43,b:42,c:771,d:null},BKSL:{keyCode:191,a:35,b:39,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:192,a:246,b:214,c:null,d:null},AC11:{keyCode:222,a:228,b:196,c:null,d:null},AB01:{keyCode:89,a:121,b:89,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:181,d:null},AB08:{keyCode:188,a:44,b:59,c:null,d:null},AB09:{keyCode:190,a:46,b:58,c:null,d:null},AB10:{keyCode:189,a:45,b:95,c:null,d:null},LSGT:{keyCode:226,a:60,b:62,c:124,d:null}}),h=Object.freeze({TLDE:{keyCode:191,a:167,b:176,c:null,d:null},AE01:{keyCode:49,a:49,b:43,c:166,d:null},AE02:{keyCode:50,a:50,b:34,c:64,d:null},AE03:{keyCode:51,a:51,b:42,c:35,d:null},AE04:{keyCode:52,a:52,b:231,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:38,c:172,d:null},AE07:{keyCode:55,a:55,b:47,c:124,d:null},AE08:{keyCode:56,a:56,b:40,c:162,d:null},AE09:{keyCode:57,a:57,b:41,c:null,d:null},AE10:{keyCode:48,a:48,b:61,c:null,d:null},AE11:{keyCode:219,a:39,b:63,c:769,d:null},AE12:{keyCode:221,a:770,b:768,c:771,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:90,a:122,b:90,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:186,a:252,b:232,c:91,d:null},AD12:{keyCode:192,a:776,b:33,c:93,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:222,a:246,b:233,c:null,d:null},AC11:{keyCode:220,a:228,b:224,c:123,d:null},BKSL:{keyCode:223,a:36,b:163,c:125,d:null},AB01:{keyCode:89,a:121,b:89,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:59,c:null,d:null},AB09:{keyCode:190,a:46,b:58,c:null,d:null},AB10:{keyCode:189,a:45,b:95,c:null,d:null},LSGT:{keyCode:226,a:60,b:62,c:92,d:null}}),i=Object.freeze({TLDE:{keyCode:222,a:178,b:null,c:null,d:null},AE01:{keyCode:49,a:38,b:49,c:null,d:null},AE02:{keyCode:50,a:233,b:50,c:771,d:null},AE03:{keyCode:51,a:34,b:51,c:35,d:null},AE04:{keyCode:52,a:39,b:52,c:123,d:null},AE05:{keyCode:53,a:40,b:53,c:91,d:null},AE06:{keyCode:54,a:45,b:54,c:124,d:null},AE07:{keyCode:55,a:232,b:55,c:768,d:null},AE08:{keyCode:56,a:95,b:56,c:92,d:null},AE09:{keyCode:57,a:231,b:57,c:94,d:null},AE10:{keyCode:48,a:224,b:48,c:64,d:null},AE11:{keyCode:219,a:41,b:176,c:93,d:null},AE12:{keyCode:187,a:61,b:43,c:125,d:null},AD01:{keyCode:65,a:97,b:65,c:null,d:null},AD02:{keyCode:90,a:122,b:90,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:221,a:770,b:776,c:null,d:null},AD12:{keyCode:186,a:36,b:163,c:null,d:null},BKSL:{keyCode:220,a:42,b:181,c:null,d:null},AC01:{keyCode:81,a:113,b:81,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:77,a:109,b:77,c:null,d:null},AC11:{keyCode:192,a:249,b:37,c:null,d:null},AB01:{keyCode:87,a:119,b:87,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:188,a:44,b:63,c:null,d:null},AB08:{keyCode:190,a:59,b:46,c:null,d:null},AB09:{keyCode:191,a:58,b:47,c:null,d:null},AB10:{keyCode:223,a:33,b:167,c:null,d:null},LSGT:{keyCode:226,a:60,b:62,c:null,d:null}}),j=Object.freeze({TLDE:{keyCode:222,a:47,b:92,c:124,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:64,c:null,d:null},AE03:{keyCode:51,a:51,b:35,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:164,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:63,c:null,d:null},AE07:{keyCode:55,a:55,b:38,c:123,d:null},AE08:{keyCode:56,a:56,b:42,c:125,d:null},AE09:{keyCode:57,a:57,b:40,c:91,d:null},AE10:{keyCode:48,a:48,b:41,c:93,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:172,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:219,a:770,b:776,c:768,d:null},AD12:{keyCode:221,a:231,b:199,c:771,d:null},BKSL:{keyCode:220,a:224,b:192,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:186,a:59,b:58,c:176,d:null},AC11:{keyCode:192,a:232,b:200,c:null,d:null},AB01:{keyCode:90,a:122,b:90,c:171,d:null},AB02:{keyCode:88,a:120,b:88,c:187,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:39,c:60,d:null},AB09:{keyCode:190,a:46,b:34,c:62,d:null},AB10:{keyCode:191,a:233,b:201,c:null,d:null},LSGT:{keyCode:226,a:249,b:217,c:null,d:null}}),k=Object.freeze({TLDE:{keyCode:191,a:167,b:176,c:null,d:null},AE01:{keyCode:49,a:49,b:43,c:166,d:null},AE02:{keyCode:50,a:50,b:34,c:64,d:null},AE03:{keyCode:51,a:51,b:42,c:35,d:null},AE04:{keyCode:52,a:52,b:231,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:38,c:172,d:null},AE07:{keyCode:55,a:55,b:47,c:124,d:null},AE08:{keyCode:56,a:56,b:40,c:162,d:null},AE09:{keyCode:57,a:57,b:41,c:null,d:null},AE10:{keyCode:48,a:48,b:61,c:null,d:null},AE11:{keyCode:219,a:39,b:63,c:769,d:null},AE12:{keyCode:221,a:770,b:768,c:771,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:90,a:122,b:90,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:186,a:232,b:252,c:91,d:null},AD12:{keyCode:192,a:776,b:33,c:93,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:222,a:233,b:246,c:null,d:null},AC11:{keyCode:220,a:224,b:228,c:123,d:null},BKSL:{keyCode:223,a:36,b:163,c:125,d:null},AB01:{keyCode:89,a:121,b:89,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:59,c:null,d:null},AB09:{keyCode:190,a:46,b:58,c:null,d:null},AB10:{keyCode:189,a:45,b:95,c:null,d:null},LSGT:{keyCode:226,a:60,b:62,c:92,d:null}}),l=Object.freeze({TLDE:{keyCode:220,a:92,b:124,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:34,c:null,d:null},AE03:{keyCode:51,a:51,b:163,c:null,d:null},AE04:{keyCode:52,a:52,b:36,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:8364,d:null},AE06:{keyCode:54,a:54,b:38,c:null,d:null},AE07:{keyCode:55,a:55,b:47,c:null,d:null},AE08:{keyCode:56,a:56,b:40,c:null,d:null},AE09:{keyCode:57,a:57,b:41,c:null,d:null},AE10:{keyCode:48,a:48,b:61,c:null,d:null},AE11:{keyCode:219,a:39,b:63,c:null,d:null},AE12:{keyCode:221,a:236,b:94,c:null,d:null},AD01:{keyCode:81,a:113,b:81,c:null,d:null},AD02:{keyCode:87,a:119,b:87,c:null,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:186,a:232,b:233,c:91,d:123},AD12:{keyCode:187,a:43,b:42,c:93,d:125},BKSL:{keyCode:191,a:249,b:167,c:null,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:192,a:242,b:231,c:64,d:null},AC11:{keyCode:222,a:224,b:176,c:35,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:59,c:null,d:null},AB09:{keyCode:190,a:46,b:58,c:null,d:null},AB10:{keyCode:189,a:45,b:95,c:null,d:null},LSGT:{keyCode:226,a:60,b:62,c:null,d:null}}),m=Object.freeze({TLDE:{keyCode:192,a:39,b:34,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:185,d:null},AE02:{keyCode:50,a:50,b:64,c:178,d:null},AE03:{keyCode:51,a:51,b:35,c:179,d:null},AE04:{keyCode:52,a:52,b:36,c:163,d:null},AE05:{keyCode:53,a:53,b:37,c:162,d:null},AE06:{keyCode:54,a:54,b:776,c:172,d:null},AE07:{keyCode:55,a:55,b:38,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:167,d:null},AD01:{keyCode:81,a:113,b:81,c:47,d:null},AD02:{keyCode:87,a:119,b:87,c:63,d:null},AD03:{keyCode:69,a:101,b:69,c:8364,d:null},AD04:{keyCode:82,a:114,b:82,c:null,d:null},AD05:{keyCode:84,a:116,b:84,c:null,d:null},AD06:{keyCode:89,a:121,b:89,c:null,d:null},AD07:{keyCode:85,a:117,b:85,c:null,d:null},AD08:{keyCode:73,a:105,b:73,c:null,d:null},AD09:{keyCode:79,a:111,b:79,c:null,d:null},AD10:{keyCode:80,a:112,b:80,c:null,d:null},AD11:{keyCode:219,a:769,b:768,c:null,d:null},AD12:{keyCode:221,a:91,b:123,c:170,d:null},AC01:{keyCode:65,a:97,b:65,c:null,d:null},AC02:{keyCode:83,a:115,b:83,c:null,d:null},AC03:{keyCode:68,a:100,b:68,c:null,d:null},AC04:{keyCode:70,a:102,b:70,c:null,d:null},AC05:{keyCode:71,a:103,b:71,c:null,d:null},AC06:{keyCode:72,a:104,b:72,c:null,d:null},AC07:{keyCode:74,a:106,b:74,c:null,d:null},AC08:{keyCode:75,a:107,b:75,c:null,d:null},AC09:{keyCode:76,a:108,b:76,c:null,d:null},AC10:{keyCode:186,a:231,b:199,c:null,d:null},AC11:{keyCode:222,a:771,b:770,c:null,d:null},BKSL:{keyCode:220,a:93,b:125,c:186,d:null},AB01:{keyCode:90,a:122,b:90,c:null,d:null},AB02:{keyCode:88,a:120,b:88,c:null,d:null},AB03:{keyCode:67,a:99,b:67,c:null,d:null},AB04:{keyCode:86,a:118,b:86,c:null,d:null},AB05:{keyCode:66,a:98,b:66,c:null,d:null},AB06:{keyCode:78,a:110,b:78,c:null,d:null},AB07:{keyCode:77,a:109,b:77,c:null,d:null},AB08:{keyCode:188,a:44,b:60,c:null,d:null},AB09:{keyCode:190,a:46,b:62,c:null,d:null},AB10:{keyCode:191,a:59,b:58,c:null,d:null},LSGT:{keyCode:226,a:92,b:124,c:null,d:null}}),n=Object.freeze({TLDE:{keyCode:192,a:1105,b:1025,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:34,c:null,d:null},AE03:{keyCode:51,a:51,b:8470,c:null,d:null},AE04:{keyCode:52,a:52,b:59,c:null,d:null},AE05:{keyCode:53,a:53,b:37,c:null,d:null},AE06:{keyCode:54,a:54,b:58,c:null,d:null},AE07:{keyCode:55,a:55,b:63,c:null,d:null},AE08:{keyCode:56,a:56,b:42,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:1081,b:1049,c:null,d:null},AD02:{keyCode:87,a:1094,b:1062,c:null,d:null},AD03:{keyCode:69,a:1091,b:1059,c:null,d:null},AD04:{keyCode:82,a:1082,b:1050,c:null,d:null},AD05:{keyCode:84,a:1077,b:1045,c:null,d:null},AD06:{keyCode:89,a:1085,b:1053,c:null,d:null},AD07:{keyCode:85,a:1075,b:1043,c:null,d:null},AD08:{keyCode:73,a:1096,b:1064,c:null,d:null},AD09:{keyCode:79,a:1097,b:1065,c:null,d:null},AD10:{keyCode:80,a:1079,b:1047,c:null,d:null},AD11:{keyCode:219,a:1093,b:1061,c:null,d:null},AD12:{keyCode:221,a:1098,b:1066,c:null,d:null},BKSL:{keyCode:220,a:92,b:47,c:null,d:null},AC01:{keyCode:65,a:1092,b:1060,c:null,d:null},AC02:{keyCode:83,a:1099,b:1067,c:null,d:null},AC03:{keyCode:68,a:1074,b:1042,c:null,d:null},AC04:{keyCode:70,a:1072,b:1040,c:null,d:null},AC05:{keyCode:71,a:1087,b:1055,c:null,d:null},AC06:{keyCode:72,a:1088,b:1056,c:null,d:null},AC07:{keyCode:74,a:1086,b:1054,c:null,d:null},AC08:{keyCode:75,a:1083,b:1051,c:null,d:null},AC09:{keyCode:76,a:1076,b:1044,c:null,d:null},AC10:{keyCode:186,a:1078,b:1046,c:null,d:null},AC11:{keyCode:222,a:1101,b:1069,c:null,d:null},AB01:{keyCode:90,a:1103,b:1071,c:null,d:null},AB02:{keyCode:88,a:1095,b:1063,c:null,d:null},AB03:{keyCode:67,a:1089,b:1057,c:null,d:null},AB04:{keyCode:86,a:1084,b:1052,c:null,d:null},AB05:{keyCode:66,a:1080,b:1048,c:null,d:null},AB06:{keyCode:78,a:1090,b:1058,c:null,d:null},AB07:{keyCode:77,a:1100,b:1068,c:null,d:null},AB08:{keyCode:188,a:1073,b:1041,c:null,d:null},AB09:{keyCode:190,a:1102,b:1070,c:null,d:null},AB10:{keyCode:191,a:46,b:44,c:null,d:null}}),o=Object.freeze({TLDE:{keyCode:192,a:93,b:91,c:null,d:null},AE01:{keyCode:49,a:49,b:33,c:null,d:null},AE02:{keyCode:50,a:50,b:34,c:null,d:null},AE03:{keyCode:51,a:51,b:8470,c:null,d:null},AE04:{keyCode:52,a:52,b:37,c:null,d:null},AE05:{keyCode:53,a:53,b:58,c:null,d:null},AE06:{keyCode:54,a:54,b:44,c:null,d:null},AE07:{keyCode:55,a:55,b:46,c:null,d:null},AE08:{keyCode:56,a:56,b:59,c:null,d:null},AE09:{keyCode:57,a:57,b:40,c:null,d:null},AE10:{keyCode:48,a:48,b:41,c:null,d:null},AE11:{keyCode:189,a:45,b:95,c:null,d:null},AE12:{keyCode:187,a:61,b:43,c:null,d:null},AD01:{keyCode:81,a:1081,b:1049,c:null,d:null},AD02:{keyCode:87,a:1094,b:1062,c:null,d:null},AD03:{keyCode:69,a:1091,b:1059,c:null,d:null},AD04:{keyCode:82,a:1082,b:1050,c:null,d:null},AD05:{keyCode:84,a:1077,b:1045,c:null,d:null},AD06:{keyCode:89,a:1085,b:1053,c:null,d:null},AD07:{keyCode:85,a:1075,b:1043,c:null,d:null},AD08:{keyCode:73,a:1096,b:1064,c:null,d:null},AD09:{keyCode:79,a:1097,b:1065,c:null,d:null},AD10:{keyCode:80,a:1079,b:1047,c:null,d:null},AD11:{keyCode:219,a:1093,b:1061,c:null,d:null},AD12:{keyCode:221,a:1098,b:1066,c:null,d:null},BKSL:{keyCode:220,a:1105,b:1025,c:null,d:null},AC01:{keyCode:65,a:1092,b:1060,c:null,d:null},AC02:{keyCode:83,a:1099,b:1067,c:null,d:null},AC03:{keyCode:68,a:1074,b:1042,c:null,d:null},AC04:{keyCode:70,a:1072,b:1040,c:null,d:null},AC05:{keyCode:71,a:1087,b:1055,c:null,d:null},AC06:{keyCode:72,a:1088,b:1056,c:null,d:null},AC07:{keyCode:74,a:1086,b:1054,c:null,d:null},AC08:{keyCode:75,a:1083,b:1051,c:null,d:null},AC09:{keyCode:76,a:1076,b:1044,c:null,d:null},AC10:{keyCode:186,a:1078,b:1046,c:null,d:null},AC11:{keyCode:222,a:1101,b:1069,c:null,d:null},AB01:{keyCode:90,a:1103,b:1071,c:null,d:null},AB02:{keyCode:88,a:1095,b:1063,c:null,d:null},AB03:{keyCode:67,a:1089,b:1057,c:null,d:null},AB04:{keyCode:86,a:1084,b:1052,c:null,d:null},AB05:{keyCode:66,a:1080,b:1048,c:null,d:null},AB06:{keyCode:78,a:1090,b:1058,c:null,d:null},AB07:{keyCode:77,a:1100,b:1068,c:null,d:null},AB08:{keyCode:188,a:1073,b:1041,c:null,d:null},AB09:{keyCode:190,a:1102,b:1070,c:null,d:null},AB10:{keyCode:191,a:47,b:63,c:null,d:null}});
return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD_WIN:b,ENGLISH_UK_STANDARD_MAC:c,ENGLISH_US_DVORAK:d,ENGLISH_US_COLEMAK:e,ENGLISH_US_WORKMAN:f,GERMAN_STANDARD:g,GERMAN_SWITZERLAND:h,FRENCH_STANDARD:i,FRENCH_CANADA:j,FRENCH_SWITZERLAND:k,ITALIAN_STANDARD:l,PORTUGUESE_BRAZIL:m,RUSSIAN_WIN:n,RUSSIAN_MAC:o})}();!function(a){a[a.TLDE=192]="TLDE",a[a.AE01=49]="AE01",a[a.AE02=50]="AE02",a[a.AE03=51]="AE03",a[a.AE04=52]="AE04",a[a.AE05=53]="AE05",a[a.AE06=54]="AE06",a[a.AE07=55]="AE07",a[a.AE08=56]="AE08",a[a.AE09=57]="AE09",a[a.AE10=48]="AE10",a[a.AE11=189]="AE11",a[a.AE12=187]="AE12",a[a.BKSP=8]="BKSP",a[a.TAB=9]="TAB",a[a.AD01=81]="AD01",a[a.AD02=87]="AD02",a[a.AD03=69]="AD03",a[a.AD04=82]="AD04",a[a.AD05=84]="AD05",a[a.AD06=89]="AD06",a[a.AD07=85]="AD07",a[a.AD08=73]="AD08",a[a.AD09=79]="AD09",a[a.AD10=80]="AD10",a[a.AD11=219]="AD11",a[a.AD12=221]="AD12",a[a.BKSL=220]="BKSL",a[a.RTRN=13]="RTRN",a[a.CAPS=20]="CAPS",a[a.AC01=65]="AC01",a[a.AC02=83]="AC02",a[a.AC03=68]="AC03",a[a.AC04=70]="AC04",a[a.AC05=71]="AC05",a[a.AC06=72]="AC06",a[a.AC07=74]="AC07",a[a.AC08=75]="AC08",a[a.AC09=76]="AC09",a[a.AC10=186]="AC10",a[a.AC11=222]="AC11",a[a.LFSH=16]="LFSH",a[a.LSGT=226]="LSGT",a[a.AB01=90]="AB01",a[a.AB02=88]="AB02",a[a.AB03=67]="AB03",a[a.AB04=86]="AB04",a[a.AB05=66]="AB05",a[a.AB06=78]="AB06",a[a.AB07=77]="AB07",a[a.AB08=188]="AB08",a[a.AB09=190]="AB09",a[a.AB10=191]="AB10",a[a.RTSH=1016]="RTSH",a[a.LCTL=17]="LCTL",a[a.LALT=18]="LALT",a[a.SPCE=32]="SPCE",a[a.RALT=1018]="RALT",a[a.RCTL=1017]="RCTL",a[a.INS=45]="INS",a[a.HOME=36]="HOME",a[a.PGUP=33]="PGUP",a[a.DELE=46]="DELE",a[a.END=35]="END",a[a.PGDN=34]="PGDN",a[a.UP=38]="UP",a[a.LEFT=37]="LEFT",a[a.DOWN=40]="DOWN",a[a.RGHT=39]="RGHT",a[a.NMLK=144]="NMLK",a[a.KPDV=111]="KPDV",a[a.KPMU=106]="KPMU",a[a.KPSU=109]="KPSU",a[a.KP7=103]="KP7",a[a.KP8=104]="KP8",a[a.KP9=105]="KP9",a[a.KPAD=107]="KPAD",a[a.KP4=100]="KP4",a[a.KP5=101]="KP5",a[a.KP6=102]="KP6",a[a.KP1=97]="KP1",a[a.KP2=98]="KP2",a[a.KP3=99]="KP3",a[a.KPEN=1013]="KPEN",a[a.KP0=96]="KP0",a[a.KPDL=110]="KPDL"}(R||(R={}));var ib,jb=16,kb=32,lb=48,mb=64,nb=64,ob=96,pb=112,qb=function(){var a=new cb("us",0|jb,"English/US",_.EN,hb.ENGLISH_US_STANDARD,gb.TYPE_C),b=new cb("us-dvorak",8|jb,"English/US - Dvorak",_.EN,hb.ENGLISH_US_DVORAK,gb.TYPE_C,a),c=new cb("us-colemak",9|jb,"English/US - Colemak",_.EN,hb.ENGLISH_US_COLEMAK,gb.TYPE_C,a),d=new cb("us-workman",10|jb,"English/US - Workman",_.EN,hb.ENGLISH_US_WORKMAN,gb.TYPE_C,a),e=new cb("de",0|kb,"German/Germany",_.DE,hb.GERMAN_STANDARD,gb.TYPE_B),f=new cb("de-ch",1|kb,"German/Switzerland",_.DE,hb.GERMAN_SWITZERLAND,gb.TYPE_B),g=new cb("fr",0|lb,"French/France",_.FR,hb.FRENCH_STANDARD,gb.TYPE_B),h=new cb("fr-ca",1|lb,"French/Canada",_.FR,hb.FRENCH_CANADA,gb.TYPE_B),i=new cb("fr-ch",2|lb,"French/Switzerland",_.FR,hb.FRENCH_SWITZERLAND,gb.TYPE_B),j=new cb("it",0|mb,"Italian/Italy",_.IT,hb.ITALIAN_STANDARD,gb.TYPE_B),k=new cb("pt-br",0|ob,"Portuguese/Brazil",_.PT,hb.PORTUGUESE_BRAZIL,gb.TYPE_B),l=navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)?!0:!1;if(l){var m=new cb("uk",1|jb,"English/UK",_.EN,hb.ENGLISH_UK_STANDARD_MAC,gb.TYPE_C),n=new cb("ru",0|pb,"Cyrillic/Russia (Mac)",_.RU,hb.RUSSIAN_MAC,gb.TYPE_C);return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD:m,ENGLISH_US_DVORAK:b,ENGLISH_US_COLEMAK:c,ENGLISH_US_WORKMAN:d,RUSSIAN:n})}var o=new cb("uk",1|jb,"English/UK",_.EN,hb.ENGLISH_UK_STANDARD_WIN,gb.TYPE_B),p=new cb("ru",0|pb,"Cyrillic/Russia (Win)",_.RU,hb.RUSSIAN_WIN,gb.TYPE_A);return Object.freeze({ENGLISH_US_STANDARD:a,ENGLISH_UK_STANDARD:o,ENGLISH_US_DVORAK:b,ENGLISH_US_COLEMAK:c,ENGLISH_US_WORKMAN:d,GERMAN_STANDARD:e,GERMAN_SWITZERLAND:f,FRENCH_STANDARD:g,FRENCH_CANADA:h,FRENCH_SWITZERLAND:i,ITALIAN_STANDARD:j,PORTUGUESE_BRAZIL:k,RUSSIAN:p})}(),rb=function(){function a(a,b,c){return this.id=a,this.xid=b,this.title=c,Object.freeze(this)}return a}(),sb=Object.freeze({AUTO:new rb("auto",1,"Computer-generated lessons"),CUSTOM:new rb("custom",2,"User-provided lessons")}),tb=function(){function a(a,b,c){return this.id=a,this.xid=b,this.type=c,Object.freeze(this)}return a}(),ub=Object.freeze({GUIDED:new tb("guided",1,sb.AUTO),IMPORT_WEBSITE:new tb("import_website",2,sb.CUSTOM),IMPORT_TEXT:new tb("import_text",3,sb.CUSTOM)}),vb=function(){function a(a,b,c,d){return this.id=a,this.xid=b,this.title=c,this.measure=d,Object.freeze(this)}return a.prototype.fromTime=function(a){return this.measure(6e4/a)},a}(),wb=Object.freeze({WPM:new vb("wpm",1,"Words per minute",function(a){return a/5}),CPM:new vb("cpm",2,"Characters per minute",function(a){return a})}),xb=function(){function a(a,b){this.layout=a,this.modeType=b,this.key=this.layout.id+":"+this.modeType.id,this.title=this.modeType.title+" / "+this.layout.name}return a.prototype.toString=function(){return this.key},a.get=function(b){var c=b.indexOf(":");if(-1==c)throw new Error;var d=b.substring(0,c),e=b.substring(c+1);return a.get1(d,e)},a.get1=function(b,c){return a.get2(K.fromCode(qb,b),K.fromCode(sb,c))},a.get2=function(b,c){var d=b.id+":"+c.id,e=a.MAP[d];return null==e&&(e=a.MAP[d]=new a(b,c)),e},a.MAP=Object.create(null),a}(),yb=function(){function a(b,c){this.cid=b,this.layout=a.DEFAULT_LAYOUT,this.emulateLayout=!1,this.mode=a.DEFAULT_MODE,this.lesson={complexity:1,length:1,capitals:!1,punctuators:!1},this.speedUnit=wb.WPM,this.enableSound=!1,this.textConfig={url:"",text:"",mangle:{simplify:!0,lowercase:!0}},this.newSettings=!0,(void 0===c||c)&&(this.reload(),this.newSettings&&this.persist())}return Object.defineProperty(a.prototype,"modeKey",{get:function(){return xb.get2(this.layout,this.mode.type)},enumerable:!0,configurable:!0}),a.prototype.importUrl=function(a){this.mode=ub.IMPORT_WEBSITE,this.textConfig.url=a},a.prototype.reload=function(){function b(a,b){return null==a?!!b:!!a}var c=window.localStorage.getObject("settings");null==c?c={}:this.newSettings=!1,c.layout=c.layout||"",c.mode=c.mode||"",c.lesson=c.lesson||{},c.text=c.text||{},c.text.mangle=c.text.mangle||{},this.layout=K.fromCode(qb,c.layout,a.DEFAULT_LAYOUT),this.emulateLayout=b(c.emulateLayout,!1),this.mode=K.fromCode(ub,c.mode,a.DEFAULT_MODE),this.lesson.complexity=Math.max(0,Math.min(1,parseFloat(c.lesson.complexity)||0)),this.lesson.length=Math.max(0,Math.min(1,parseFloat(c.lesson.length)||0)),this.lesson.capitals=b(c.lesson.capitals,!1),this.lesson.punctuators=b(c.lesson.punctuators,!1),this.speedUnit=K.fromCode(wb,c.speedUnit,wb.WPM),this.enableSound=b(c.enableSound,!1),this.textConfig.url=c.text.url||"",this.textConfig.text=c.text.text||"",this.textConfig.mangle.simplify=b(c.text.mangle.simplify,!0),this.textConfig.mangle.lowercase=b(c.text.mangle.lowercase,!0)},a.prototype.persist=function(){window.localStorage.setObject("settings",{layout:this.layout.id,emulateLayout:this.emulateLayout,mode:this.mode.id,lesson:{complexity:this.lesson.complexity,length:this.lesson.length,capitals:this.lesson.capitals,punctuators:this.lesson.punctuators},speedUnit:this.speedUnit.id,enableSound:this.enableSound,text:{mangle:{simplify:this.textConfig.mangle.simplify,lowercase:this.textConfig.mangle.lowercase},url:this.textConfig.url,text:this.textConfig.text}})},a.prototype.remove=function(){window.localStorage.removeItem("settings")},a.DEFAULT_LAYOUT=qb.ENGLISH_US_STANDARD,a.DEFAULT_MODE=ub.GUIDED,a}(),zb=function(){function a(){}return a.prototype.init=function(a){function b(a){return[c+a+".ogg",c+a+".mp3",c+a+".wav"]}var c="/res/sound/";if(a.enableSound){if(null==this.library){this.library=Object.create(null);for(var d=["click","blip","correct","wrong","tada"],e=0;e<d.length;e++)this.library[d[e]]=new Howl({urls:b(d[e])})}}else this.library=null},a.prototype.play=function(a){if(this.library){var b=this.library[a];if(!b)throw new Error;b.stop(),b.play()}},a}(),Ab=new zb,Bb=function(){function a(a){this.id=a,this.data=Object.create(null)}return a.prototype.get=function(a){var b=this.data[String(a)];return null==b&&(b=this.data[String(a)]=[]),b},a.prototype.add=function(a,b){this.get(a.modeKey);if(this.id){var c=new Cb(this.id);c.add(a),c.send(function(){}),b(a)}else this.writeLocal(a,function(){b(a)})},a.prototype.open=function(a){var b=this;try{var c=window.indexedDB.open("history",1);c.onerror=function(c){console.error("Cannot open indexed db",c),b.init(a)},c.onblocked=function(c){console.error("Indexed db is blocked",c),b.init(a)},c.onupgradeneeded=function(){{var a=c.result;a.createObjectStore("history",{autoIncrement:!0})}},c.onsuccess=function(){b.db=c.result,b.init(a)}}catch(d){console.error("Cannot open indexed db",d),this.init(a)}},a.prototype.init=function(a){var b=this;this.id?this.loadRemote(function(c){c.length>0?(b.data=Mb.group(c),a()):b.readLocal(function(c){if(c.length>0){var d=new Cb(b.id);d.addAll(c),d.send(function(){b.data=Mb.group(c),a()})}else a()})}):this.readLocal(function(c){b.data=Mb.group(c),a()})},a.prototype.loadRemote=function(a){var b=new Cb(this.id);b.receive(function(b){b.sort(Mb.SORT_BY_TS),a(b)})},a.prototype.readLocal=function(a){this.db?this.readLocalImpl(a):a([])},a.prototype.readLocalImpl=function(a){var b=[],c=this.db.transaction("history"),d=c.objectStore("history"),e=d.openCursor();e.onerror=function(c){console.error("Cannot open cursor",c),a(b)},e.onsuccess=function(){var c=e.result;if(c){var d=c.value;try{d.tx&&(d.n=d.tx.length),"string"==typeof d.l&&"string"==typeof d.m&&b.push(Mb.fromJson(d))}catch(f){}c.continue()}else a(b)}},a.prototype.writeLocal=function(a,b){this.db?this.writeLocalImpl(a,b):b(a)},a.prototype.writeLocalImpl=function(a,b){var c=this.db.transaction("history","readwrite"),d=c.objectStore("history"),e=Mb.toJson(a),f=d.add(e);f.onerror=function(c){console.error("Cannot store result",c),b(a)},f.onsuccess=function(){b(a)}},a}(),Cb=function(){function a(a){this.id=a,this.data=[]}return a.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},a.prototype.add=function(a){this.data.push(a)},a.prototype.send=function(a){var b=new Db([],null);b.addAll(this.data);var c=b.format();c=J.RC4.encode(J.RC4.key(this.id),c);var d=new XMLHttpRequest;d.onload=function(){a()},d.onerror=function(){console.log("error sending message")},d.open("POST","/sync",!0),d.setRequestHeader("Content-Type","application/octet-stream"),d.send(c)},a.prototype.receive=function(a){var b=new XMLHttpRequest;b.onload=function(){var c=b.response,d=new Db(null,new DataView(c)),e=d.parse();a(e)},b.onerror=function(){console.log("error receiving data")},b.open("GET","/sync",!0),b.responseType="arraybuffer",b.setRequestHeader("Cache-Control","no-cache"),b.send()},a.MESSAGE_SIGNATURE=1262836034,a.MESSAGE_VERSION=1,a.FILE_SIGNATURE=1262836034,a.FILE_VERSION=1,a}(),Db=function(){function a(a,b){this.data=a,this.dataView=b}return a.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},a.prototype.add=function(a){this.data.push(a)},a.prototype.format=function(){for(var b=0,c=0;c<this.data.length;c++)b+=a.L0+a.L1*Object.keys(this.data[c].histogram).length;var d=new ArrayBuffer(12+b+4);this.dataView=new DataView(d),this.dataView.setUint32(0,Cb.MESSAGE_SIGNATURE),this.dataView.setUint32(4,Cb.MESSAGE_VERSION),this.dataView.setUint32(8,this.data.length);for(var e=12,c=0;c<this.data.length;c++)e=this.formatRecord(e,this.data[c]);return this.dataView.setUint32(e,J.crc32(new Uint8Array(d,0,e))),new Uint8Array(d)},a.prototype.formatRecord=function(b,c){var d=Object.keys(c.histogram),e=d.length,f=c.timeStamp/1e3|0,g=c.timeStamp-1e3*f|0;this.dataView.setUint8(b+0,c.modeKey.layout.xid),this.dataView.setUint8(b+1,c.modeKey.modeType.xid),this.dataView.setUint32(b+2,f),this.dataView.setUint16(b+6,g),this.dataView.setUint16(b+8,c.time),this.dataView.setUint8(b+10,c.length),this.dataView.setUint8(b+11,c.errors),this.dataView.setUint8(b+12,c.complexity),this.dataView.setUint8(b+13,e),b+=a.L0;for(var h=0;e>h;h++){var i=parseInt(d[h]),j=c.histogram[i];this.dataView.setUint16(b+0,i),this.dataView.setUint8(b+2,j.h),this.dataView.setUint8(b+3,j.m),this.dataView.setUint32(b+4,Math.round(1e3*j.t)),b+=a.L1}return b},a.prototype.parse=function(){if(this.data=[],this.dataView.byteLength>8&&this.dataView.getUint32(0)==Cb.FILE_SIGNATURE&&this.dataView.getUint32(4)==Cb.FILE_VERSION)for(var a=8;a<this.dataView.byteLength;)a=this.parseRecord(a);return this.data},a.prototype.parseRecord=function(b){var c=this.dataView.getUint8(b+0),d=this.dataView.getUint8(b+1),e=this.dataView.getUint32(b+2),f=this.dataView.getUint16(b+6),g=this.dataView.getUint16(b+8),h=this.dataView.getUint8(b+10),i=this.dataView.getUint8(b+11),j=this.dataView.getUint8(b+12),k=this.dataView.getUint8(b+13);b+=a.L0;for(var l=Object.create(null),m=0;k>m;m++){var n=this.dataView.getUint16(b+0),o=this.dataView.getUint8(b+2),p=this.dataView.getUint8(b+3),q=this.dataView.getUint32(b+4)/1e3;l[n]={h:o,m:p,t:q},b+=a.L1}var r=xb.get2(K.fromXCode(qb,c),K.fromXCode(sb,d)),s=Math.round(1e3*e+f),t=new Mb(r,s,h,g,i,j,l);return t.time>0&&t.speed>0&&t.speed<=750&&this.data.push(t),b},a.L0=14,a.L1=8,a}(),Eb=Object.freeze({MAX_SPEED:"max-speed",MAX_SCORE:"max-score",SPEED_STREAK:"speed-streak",SCORE_STREAK:"score-streak",ERRORS_STREAK:"errors-streak"}),Fb=Object.freeze({SILVER:"silver",BRONZE:"gold",GOLD:"gold",RUBY:"ruby"}),Gb=function(){function a(a,b){this.id=a,this.value=b}return a.prototype.description=function(){switch(this.id){case Eb.MAX_SPEED:return"Top speed so far";case Eb.MAX_SCORE:return"Best score so far";case Eb.SPEED_STREAK:return"Increasing speed sequence";case Eb.SCORE_STREAK:return"Increasing score sequence";case Eb.ERRORS_STREAK:return"Sequence without errors"}throw new Error},a.prototype.equals=function(a){return this.id===a.id&&this.value===a.value},a.prototype.toString=function(){return this.value?"["+this.value+"] "+this.description():this.description()},a}(),Hb=function(){function a(){this.last=null,this.maxSpeed=0,this.maxScore=0,this.speedStreak=0,this.scoreStreak=0,this.errorsStreak=0,this.count=0,this.reset()}return a.prototype.reset=function(){this.last=null,this.maxSpeed=0,this.maxScore=0,this.speedStreak=0,this.scoreStreak=0,this.errorsStreak=0,this.count=0},a.prototype.add=function(a){var b=[];return this.last&&(a.speed>=this.last.speed?(this.speedStreak++,7==this.speedStreak?b.push(new Gb(Eb.SPEED_STREAK,Fb.GOLD)):5==this.speedStreak?b.push(new Gb(Eb.SPEED_STREAK,Fb.BRONZE)):3==this.speedStreak&&b.push(new Gb(Eb.SPEED_STREAK,Fb.SILVER))):this.speedStreak=0,a.score>=this.last.score?(this.scoreStreak++,7==this.scoreStreak?b.push(new Gb(Eb.SCORE_STREAK,Fb.GOLD)):3==this.scoreStreak?b.push(new Gb(Eb.SCORE_STREAK,Fb.BRONZE)):5==this.scoreStreak&&b.push(new Gb(Eb.SCORE_STREAK,Fb.SILVER))):this.scoreStreak=0),0==a.errors?(this.errorsStreak++,17==this.errorsStreak?b.push(new Gb(Eb.ERRORS_STREAK,Fb.RUBY)):12==this.errorsStreak?b.push(new Gb(Eb.ERRORS_STREAK,Fb.GOLD)):8==this.errorsStreak?b.push(new Gb(Eb.ERRORS_STREAK,Fb.BRONZE)):5==this.errorsStreak&&b.push(new Gb(Eb.ERRORS_STREAK,Fb.SILVER))):this.errorsStreak=0,this.count>=10&&(a.speed>this.maxSpeed&&(this.maxSpeed=a.speed,b.push(new Gb(Eb.MAX_SPEED,null))),a.score>this.maxScore&&(this.maxScore=a.score,b.push(new Gb(Eb.MAX_SCORE,null)))),this.last=a,this.count++,b.length>0?{modeKey:a.modeKey,timeStamp:a.timeStamp,list:b}:null},a.prototype.analyze=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.add(d);e&&b.push(e)}return b},a}(),Ib=function(){function a(a){this.a=a}return a.prototype.start=function(){this.init(),this.schedule()},a.prototype.cancel=function(){this.unschedule(),this.reset()},a.prototype.schedule=function(){var a=this;this.timer=window.requestAnimationFrame(function(b){a.step(b)})},a.prototype.unschedule=function(){this.timer&&(window.cancelAnimationFrame(this.timer),this.timer=null)},a.prototype.init=function(){this.started=null;for(var a=0;a<this.a.length;a++)this.a[a].init()},a.prototype.step=function(a){var b;null==this.started&&(this.started=a),b=a-this.started;for(var c=0;c<this.a.length;c++)this.a[c].step(b);this.schedule()},a.prototype.reset=function(){for(var a=0;a<this.a.length;a++)this.a[a].reset()},a}(),Jb=(function(){function a(){}return a.prototype.init=function(){},a.prototype.step=function(){},a.prototype.reset=function(){},a}(),function(){function a(a){this.elements=a}return a.prototype.init=function(){this.t=0,this.f=!0},a.prototype.step=function(a){if(this.t+350<a){this.t=a;for(var b=0;b<this.elements.length;b++){var c=this.elements[b];c.style.visibility=this.f?"hidden":""}this.f=!this.f}},a.prototype.reset=function(){for(var a=0;a<this.elements.length;a++){var b=this.elements[a];b.style.visibility=""}},a}()),Kb=(function(){function a(a){this.elements=a}return a.prototype.init=function(){function a(a,b){return a+B.int(b-a+1)}for(var b=0;b<this.elements.length;b++){{var c=this.elements[b];c.__anim={x:c.offsetLeft,y:c.offsetTop,rx:a(5,20)*(a(0,1)>0?1:-1),ry:a(5,20)*(a(0,1)>0?1:-1),sx:a(80,200),sy:a(80,200)}}c.style.position="absolute"}},a.prototype.step=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b],d=c.__anim,e=d.x+Math.sin(a/d.sx)*d.rx,f=d.y+Math.cos(a/d.sy)*d.ry;c.style.left=e+"px",c.style.top=f+"px"}},a.prototype.reset=function(){for(var a=0;a<this.elements.length;a++){var b=this.elements[a];delete b.__anim,b.style.position="",b.style.left="",b.style.top=""}},a}(),function(){return window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return Date.now()}}()),Lb=function(){function a(a,b){return this.charCode=a,this.f=b,Object.freeze(this)}return a.prototype.valueOf=function(){return this.charCode},a.SORT_BY_INDEX=function(a,b){return a.charCode-b.charCode},a.SORT_BY_FREQUENCY=function(a,b){return b.f-a.f},a.sort=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);return c.sort(b),c},a.PUNCTUATORS=l(".,:;!?-([\"'",function(b,c){return new a(c,0)}),a}(),Mb=function(){function a(a,b,c,d,e,f,g){return this.modeKey=a,this.timeStamp=b,this.length=c,this.time=d,this.errors=e,this.complexity=f,this.histogram=g,this.speed=this.length/(this.time/1e3)*60,this.score=this.speed*this.complexity/(this.errors+1)*(this.length/50),Object.freeze(this)}return a.toJson=function(a){return{l:a.modeKey.layout.id,m:a.modeKey.modeType.id,ts:a.timeStamp,n:a.length,t:a.time,e:a.errors,c:a.complexity,h:a.histogram}},a.fromJson=function(b){return new a(xb.get1(b.l,b.m),b.ts,b.n,b.t,b.e,b.c,b.h)},a.group=function(a){for(var b=Object.create(null),c=0;c<a.length;c++){var d=a[c],e=d.modeKey,f=b[String(e)];null==f&&(f=b[String(e)]=[]),f.push(d)}return b},a.statistics=function(a){var b=0,c=0,d=0,e=0,f=0,g=0;if(a.length>0){for(var h=0;h<a.length;h++){var i=a[h];b+=i.time,c=Math.max(c,i.speed),d+=i.speed,e=Math.max(e,i.score),f+=i.score,g+=i.errors}d/=a.length,f/=a.length,g/=a.length}return{count:a.length,totalTime:b,topSpeed:c,avgSpeed:d,topScore:e,avgScore:f,avgErrors:g}},a.SORT_BY_TS=function(a,b){return a.timeStamp-b.timeStamp},a}(),Nb=function(){function a(a){this.charCode=a,this.t=[],this.st=[],this.learningTime=0,this.mean=new C.Mean,this.movingMean=new C.MovingMean(Rb.WINDOW_SIZE,this.st)}return a.prototype.add=function(a){var b=a.histogram[this.charCode];b&&b.t>0&&(this.t.push(b.t),this.learningTime+=a.time,this.mean.add(b.t),this.movingMean.add(b.t))},a.prototype.meanTime=function(){return this.movingMean.mean||this.mean.mean||null},a.prototype.confidenceLevel=function(){return a.confidenceLevel(this.meanTime())},a.confidenceLevel=function(a){return null==a?null:(a=Math.max(a,Rb.MIN_TIME),a=Math.min(a,Rb.MAX_TIME),1-(a-Rb.MIN_TIME)/(Rb.MAX_TIME-Rb.MIN_TIME))},a.prototype.isConfident=function(){return a.isConfident(this.meanTime())},a.isConfident=function(a){return null==a?!1:a<=Rb.MIN_TIME},a.prototype.learningRate=function(a){var b=C.linearRegression(this.t.map(function(b){return a.fromTime(b)}));return{unit:a,lr:b,perSample:b.beta,perHour:60*b.beta*60*1e3/(this.learningTime/this.t.length)}},a}(),Ob=function(){function a(a,b){this.letters=a,this.data=b,this.letters=a,this.data=b,this.map=Object.create(null);for(var c=0;c<this.letters.length;c++){var d=this.letters[c];this.map[d.charCode]=new Nb(d.charCode)}for(var c=0;c<this.data.length;c++){var e=this.data[c];this._add(e)}}return a.prototype.add=function(a){this.data.push(a),this._add(a)},a.prototype._add=function(a){for(var b=0;b<this.letters.length;b++){var c=this.letters[b];this.map[c.charCode].add(a)}},a}(),Pb=function(){function a(){}return a.loadLesson=function(b,c){switch(b.mode){case ub.GUIDED:a.guided(b,c);break;case ub.IMPORT_WEBSITE:a.importUrl(b,c);break;case ub.IMPORT_TEXT:a.importText(b,c);break;default:throw new Error}},a.guided=function(a,b){X.load(a.layout,function(c){b(new Rb(a,c))})},a.importUrl=function(a,b){var c="/fetch?url="+encodeURIComponent(a.textConfig.url),d=new XMLHttpRequest;d.onload=function(){b(new Qb(a,new W(d.responseText,a.textConfig.mangle,a.layout)))},d.onerror=function(){b(new Qb(a,new V("cannot load text")))},d.open("GET",c,!0),d.send()},a.importText=function(a,b){b(new Qb(a,new W(a.textConfig.text,a.textConfig.mangle,a.layout)))},a}(),Qb=function(){function a(a,b){this.settings=a,this.generator=b,this.letters=[]}return a.prototype.generate=function(){return this.generator.generate()},a.prototype.update=function(){},a}(),Rb=function(){function a(a,b){this.settings=a,this.generator=b,this.includeKeys=[],this.excludeKeys=[];var c=this.settings.layout;this.letters=c.filterLetters(this.generator.letters).sort(Lb.SORT_BY_FREQUENCY),this.generator.punctuators=c.filterLetters(Lb.PUNCTUATORS).map(function(a){return String.fromCharCode(a.charCode)})}return a.prototype.generate=function(){return this.generator.filter=this.includeKeys.length?this.includeKeys.map(function(a){return a.charCode}):null,this.generator.boost=this.boost,this.generator.wordLimit=5+Math.round(4*this.settings.lesson.length),this.generator.fragmentLimit=50+Math.round(100*this.settings.lesson.length),this.generator.enableCapitals=this.settings.lesson.capitals,this.generator.enablePunctuators=this.settings.lesson.punctuators,this.generator.generate()},a.prototype.update=function(b){this.update1(b,a.MIN_SIZE)},a.prototype.update1=function(a,b){var c=b+Math.round((this.letters.length-b)*this.settings.lesson.complexity);this.update2(a,b,c)},a.prototype.update2=function(a,b,c){this.includeKeys=[],this.excludeKeys=[],this.boost=null;for(var d=[],e=0,f=0;f<this.letters.length;f++){var g=this.letters[f],h=a.map[g.charCode],i={charCode:g.charCode,f:g.f,t:h.meanTime(),confidenceLevel:h.confidenceLevel(),isConfident:h.isConfident(),isForced:f>=b&&c>f,isBoosted:!1};b>f?(this.includeKeys.push(i),i.isConfident||e++):i.isConfident?this.includeKeys.push(i):d.push(i)}for(d.length>0&&1>e&&(i=d.shift(),this.includeKeys.push(i));d.length>0;)i=d.shift(),i.isForced?this.includeKeys.push(i):this.excludeKeys.push(i);var j=this.includeKeys.filter(function(a){return null==a.confidenceLevel||a.confidenceLevel<1});j.length>0&&(j.sort(function(a,b){var c=a.confidenceLevel||0,d=b.confidenceLevel||0;return c==d?b.f-a.f:c-d}),i=j.shift(),i.isBoosted=!0,this.boost={charCode:i.charCode,factor:this.generator.getBoostFactor(i.charCode)})},a.MIN_SIZE=6,a.MIN_TIME=340,a.MAX_TIME=1e3,a.WINDOW_SIZE=20,a}(),Sb=function(){function a(a){this.$root=a}return a.confidenceColor=function(b){if(null==b)return new N(14540253);var c=a.COLOR_MIN_CONFIDENCE,d=a.COLOR_MAX_CONFIDENCE;return new N(Math.round((d.r-c.r)*b+c.r),Math.round((d.g-c.g)*b+c.g),Math.round((d.b-c.b)*b+c.b))},a.prototype.update=function(c,d){function e(a){var d=["Character '"+k(a)+"'"];if(a.t?(d.push("Typing speed: "+b(f.fromTime(a.t),1)+f.id),d.push("Time to type: "+b(a.t,1)+"ms"),d.push("Confidence level: "+b(a.confidenceLevel,100))):d.push("Not calibrated"),a.isBoosted){var e=c.map[a.charCode];if(e.t.length>=10){var g=e.learningRate(f),h="~"+String(b(g.perSample,1e3))+f.id+"/sample",i="~"+String(b(g.perHour,1))+f.id+"/hour";d.push("Learning rate: "+h+", "+i)}d.push("Boosted frequency")}return a.isForced&&d.push("Added by user"),d.join("; ")}var f=d.settings.speedUnit;if(this.$root.empty(),d.includeKeys&&d.excludeKeys){if(d.includeKeys.length){for(var g=$("<span></span>").addClass("include"),h=0;h<d.includeKeys.length;h++){var i=d.includeKeys[h],j=$("<span></span>").addClass("key").css("background-color",String(a.confidenceColor(i.confidenceLevel))).text(k(i)).attr("title",e(i)).data("item",i);i.isForced&&j.addClass("forced"),i.isBoosted&&j.addClass("boosted"),g.append(j)}this.$root.append(g)}if(d.excludeKeys.length){for(var l=$("<span></span>").addClass("exclude"),h=0;h<d.excludeKeys.length;h++){var i=d.excludeKeys[h],j=$("<span></span>").addClass("key").css("background-color","#F3F3F3").text(k(i)).attr("title",e(i)).data("item",i);l.append(j)}this.$root.append(l)}}else this.$root.append($("<span></span>").text("manual mode"))},a.COLOR_MIN_CONFIDENCE=new N(13369344),a.COLOR_MAX_CONFIDENCE=new N(7334996),a}(),Tb=function(){function a(a,b){this.modeKey=a,this.lesson=b,this.text=this.lesson.generate(),this.complexity=this.modeKey.layout.complexity(this.text),this.reset()}return a.prototype.reset=function(){this.started=null,this.finished=null,this.errors=0,this.position=0,this.buffer=[],this.errorPos=[],this.histogram=Object.create(null),this.lastKeyTime=0,this.keyTimesMap=Object.create(null),this.result=null},a.prototype.put=function(a){if(0==this.position&&(13==a||32==a))return!1;var b=this.position;if(8==a)this.back();else{null==this.started&&(this.started=this.getTime());var c=this.advance(a);c===!0&&Ab.play("click"),c===!1&&Ab.play("blip")}if(this.isCompleted()){this.finished=this.getTime();for(var d in this.histogram){var e=this.histogram[d],f=this.keyTimesMap[d];if(f){for(var g=0,h=0;h<f.length;h++)g+=f[h];g/=f.length,e.t=Math.round(1e3*g)/1e3}}var i=this.finished-this.started;this.result=new Mb(this.modeKey,this.started,this.text.length,i,this.errors,this.complexity,this.histogram)}return b!=this.position},a.prototype.getTime=function(){return Date.now()},a.prototype.isCompleted=function(){return this.position==this.text.length},a.prototype.nextChar=function(){return this.position<this.text.length?this.text.charCodeAt(this.position):0},a.prototype.back=function(){this.lastKeyTime=0,this.position>0&&this.position--,this.buffer=[];for(var a=this.errorPos.length;a>0;a--){var b=this.errorPos[a-1];if(b<this.position)break}this.errorPos.splice(a)},a.prototype.advance=function(a){var b=3,c=this.text.charCodeAt(this.position);if(0==this.buffer.length){if(c==a)return this.hit(c),this.measureTime(c),this.position++,!0;this.errors++,this.errorPos.push(this.position)}this.lastKeyTime=0,this.buffer.push(a);var d;if(this.position+b<this.text.length&&this.buffer.length==b&&this.isSkipped()){for(this.miss(c),d=0;d<this.buffer.length;d++)this.hit(this.buffer[d]);return this.buffer=[],this.position+=b+1,this.lastKeyTime=Kb(),null}if(this.position+b<this.text.length&&this.buffer.length==b+1&&this.isReplaced()){for(this.miss(c),d=1;d<this.buffer.length;d++)this.hit(this.buffer[d]);return this.buffer=[],this.position+=b+1,this.lastKeyTime=Kb(),null}if(c==a){for(d=0;d<this.buffer.length-1;d++)this.miss(c);return this.hit(c),this.buffer=[],this.position++,this.lastKeyTime=Kb(),!0}return!1},a.prototype.isSkipped=function(){for(var a=0;a<this.buffer.length;a++){var b=this.text.charCodeAt(this.position+1+a);if(b!=this.buffer[a])return!1}return!0},a.prototype.isReplaced=function(){for(var a=1;a<this.buffer.length;a++){var b=this.text.charCodeAt(this.position+a);if(b!=this.buffer[a])return!1}return!0},a.prototype.hit=function(a){var b=this.histogram[a];null==b&&(this.histogram[a]=b={h:0,m:0,t:0}),b.h++},a.prototype.miss=function(a){var b=this.histogram[a];null==b&&(this.histogram[a]=b={h:0,m:0,t:0}),b.m++},a.prototype.measureTime=function(a){var b=Kb();if(this.lastKeyTime>0){var c=this.keyTimesMap[a];null==c&&(this.keyTimesMap[a]=c=[]),c.push(b-this.lastKeyTime)}this.lastKeyTime=b},a}(),Ub=function(){function a(a,b){this.lesson=a,this.fragment=b,this.$root=D.el("div",["fragment"]),this.$item=[];for(var c=this.fragment.text,d=0;d<c.length;d++){var e=c.charCodeAt(d);if(10==e)this.$root.appendChild(this.$item[d]=D.el("span",["item","new-line"],"↵")),this.$root.appendChild(D.el("br",null,null));else if(32==e)this.$root.appendChild(this.$item[d]=D.el("span",["item","space"],"␣")),this.$root.appendChild(D.el("span",null," "));else{var f=["item"];this.lesson.boost&&e==this.lesson.boost.charCode&&f.push("boosted"),this.$root.appendChild(this.$item[d]=D.el("span",f,String.fromCharCode(e)))}}this.updateUi()}return a.prototype.attach=function(a){a.appendChild(this.$root)},a.prototype.detach=function(){this.$root.parentNode.removeChild(this.$root)},a.prototype.updateUi=function(){var a,b,c,d=this.fragment.text,e=this.fragment.position,f=this.fragment.errorPos,g=-1;for(a=0;e>a;a++)c=this.$item[a],c.classList.add("down"),c.classList.remove("cursor");for(a=e;a<d.length;a++)c=this.$item[a],c.classList.remove("down"),a==e?c.classList.add("cursor"):c.classList.remove("cursor");for(a=0,b=0;a<d.length;a++){if(c=this.$item[a],a>g)for(;b<f.length&&(g=f[b],!(g>=a));b++);g==a&&g!=e?c.classList.add("error"):c.classList.remove("error")}},a.prototype.createAnimation=function(){return new Jb(this.$item)},a}(),Vb=function(){function c(){o.text("0"),p.text("0"),q.text("0"),r.text("0"),s.text("0"),t.text("0"),n.empty(),u.text("-"),v.text("-")}function e(a,c){0>c?(c=b(c,1e3),a.text(c),a.removeClass("more"),a.addClass("less")):(c=b(c,1e3),a.text("+"+c),a.removeClass("less"),a.addClass("more"))}function f(a){if(n.empty(),a)for(var b=0;b<a.list.length;b++){var c=a.list[b],d=$("<div></div>").addClass("badge");d.attr("title",c),d.addClass(c.id),d.addClass(c.value),d.addClass("animated"),d.addClass("shake"),n.append(d)}}function g(a){if(u.empty(),0==a.length)u.text("-");else for(var c=0;c<a.length;c++){var d=a[c];if(d.charCode>32){var e=$("<span></span>").addClass("name").text(k(d)+":"),f=$("<span></span>").addClass("value"),g=String(b(d.delta,1));d.delta<0?(f.addClass("less"),f.text(g)):(f.addClass("more"),f.text("+"+g));var h=$("<span></span>").addClass("key");h.append(e),h.append(f),u.append(h)}}}function h(a,b){new Sb(v).update(a,b)}function i(a,b,c){this.settings=a,this.database=b,this.lesson=c,this.data=b.get(this.settings.modeKey),this.forecast=new Ob(this.lesson.letters,this.data),this.analyzer=new Hb,this.analyzer.analyze(this.data)}function j(a){this.settings=a,this.database=new Bb(global.auth.id)}var l=(document.getElementById("game"),document.getElementById("text")),m=document.getElementById("keyboard"),n=$("#g-achievements"),o=$("#g-speed"),p=$("#g-speed-gain"),q=$("#g-errors"),r=$("#g-errors-gain"),s=$("#g-score"),t=$("#g-score-gain"),u=$("#g-key-times-gain"),v=$("#g-lesson-details");return i.prototype={update:function(){this.lesson.update(this.forecast),h(this.forecast,this.lesson)},add:function(a,b){for(var c=Mb.statistics(this.data),d=[],h=0;h<this.lesson.letters.length;h++){var i=this.lesson.letters[h],j=this.forecast.map[i.charCode],k=a.histogram[i.charCode];if(k&&k.t>0){var l=k.t,m=j.meanTime();l&&m&&d.push({charCode:i.charCode,delta:m-l})}}d.sort(function(a,b){return b.delta-a.delta}),this.forecast.add(a);var n=this.analyzer.add(a),u=this.settings.speedUnit,v=a.speed-c.avgSpeed,w=a.score-c.avgScore,x=-(a.errors-c.avgErrors);o.text(Math.round(u.measure(a.speed))),q.text(Math.round(a.errors)),s.text(Math.round(a.score)),e(p,u.measure(v)),e(t,w),e(r,x),f(n),g(d),n&&n.list.length?Ab.play("tada"):0==a.errors&&Ab.play("correct"),this.database.add(a,function(){b()})}},j.prototype={settings:null,database:null,lesson:null,fragment:null,progressNotifier:null,handler:null,keyboardUi:null,fragmentUi:null,active:!1,shake:null,init:function(a){var b=this;window.setInterval(function(){l.classList.toggle("blink")},300),window.addEventListener("blur",function(){b.reset(),document.body.classList.add("pause")}),window.addEventListener("focus",function(){b.reset(),document.body.classList.remove("pause")}),document.addEventListener("keydown",function(a){b.active&&b.keyDown(new G(a))
},!0),document.addEventListener("keyup",function(a){b.active&&b.keyUp(new G(a))},!0),document.addEventListener("reveal-page",function(a){"#game"==a.detail.url?b.unpause():b.pause()}),this.keyboardUi=new fb(m),this.database.open(function(){a()})},start:function(a){this.lesson=a,this.settings.layout.configure(this.settings),this.keyboardUi.init(this.settings.layout,!0),this.progressNotifier=new i(this.settings,this.database,this.lesson),Ab.init(this.settings),this.next()},reset:function(){this.fragment&&(this.fragment.reset(),this._update(this.fragment))},next:function(){this._update(null)},_update:function(a){var b=this;this.progressNotifier.update(),this.fragment=a?a:new Tb(this.settings.modeKey,this.lesson);var c=function(a){b.fragment.put(a)};this.handler=this.settings.layout.createEventHandler(c),this.fragmentUi&&this.fragmentUi.detach(),this.fragmentUi=new Ub(this.lesson,this.fragment),this.fragmentUi.attach(l),this.keyboardUi.reset(),this.highlight(),this.delayShake()},completed:function(b){var c=this;b.time>0&&b.time<=6e4&&(this.progressNotifier.add(b,function(){c.next()}),document.dispatchEvent(a("fragment-complete",{detail:{result:b},bubbles:!0,cancelable:!1})))},highlight:function(){this.keyboardUi.highlight(this.fragment.nextChar())},pause:function(){this.active=!1,this.cancelShake()},unpause:function(){this.active=!0,c(),this.reset()},timeoutId:null,delayShake:function(){var a=this;this.cancelShake(),this.timeoutId=window.setTimeout(function(){a.kickShake()},3e4)},kickShake:function(){this.cancelShake(),document.body.classList.add("shake"),this.shake=new Ib([this.keyboardUi.createAnimation(),this.fragmentUi.createAnimation()]),this.shake.start()},cancelShake:function(){this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),document.body.classList.remove("shake"),this.shake&&(this.shake.cancel(),this.shake=null)},lastKeyCode:-1,keyDown:function(a){this.lastKeyCode!=a.keyCode&&(this.lastKeyCode=a.keyCode,this.shake?(this.cancelShake(),this.reset()):(this.keyboardUi.keyDown(a),27==a.keyCode?this.kickShake():37==a.keyCode&&a.ctrlKey?(this.reset(),a.preventDefault(),a.stopPropagation()):39==a.keyCode&&a.ctrlKey?(this.next(),a.preventDefault(),a.stopPropagation()):d(a)||(this.handler.keyDown(a),this.fragmentUi.updateUi(),this.highlight(),this.fragment.isCompleted()&&this.completed(this.fragment.result),this.delayShake(),a.preventDefault(),a.stopPropagation())))},keyUp:function(a){this.lastKeyCode==a.keyCode&&(this.lastKeyCode=-1),this.keyboardUi.keyUp(a),this.handler.keyUp(a)}},j}(),Wb=function(){function a(a,b){this.letters=a,this.data=b,this.map=Object.create(null),this.minh=null,this.maxh=0,this.minm=null,this.maxm=0,this.minr=null,this.maxr=0,this.count=0;for(var c=0;c<this.letters.length;c++){var d=this.letters[c];this.map[d.charCode]={h:0,m:0,r:0}}for(var c=0;c<this.data.length;c++)this.add(this.data[c])}return a.prototype.add=function(a){for(var b=0;b<this.letters.length;b++){var c=this.letters[b],d=this.map[c.charCode],e=a.histogram[c.charCode];e&&(d.h+=0|e.h,d.m+=0|e.m,d.r=d.m/d.h,this.maxh=Math.max(this.maxh,d.h),this.maxm=Math.max(this.maxm,d.m),this.maxr=Math.max(this.maxr,d.r),0==this.count?(this.minh=d.h,this.minm=d.m,this.minr=d.r):(this.minh=Math.min(this.minh,d.h),this.minm=Math.min(this.minm,d.m),this.minr=Math.min(this.minr,d.r)))}this.count++},a}(),Xb=function(){function a(a,b,c,d,e){this.size=a,this.top=b,this.right=c,this.bottom=void 0!==d?d:b,this.left=void 0!==e?e:c,this.width=this.size.width-this.left-this.right,this.height=this.size.height-this.top-this.bottom}return a.prototype.x=function(a){return a+this.left},a.prototype.y=function(a){return a+this.top},a}();!function(a){function b(a){k&&(k.remove(),k=null),$(h).append(a),k=a,setTimeout(function(){a==k&&(k.remove(),k=null)},1500)}function c(){return"ws://"+window.location.hostname+":8080/game?u="+encodeURIComponent([global.auth.id,global.auth.external_id,global.auth.name].join("|"))}function d(a){switch(a.keyCode){case 8:return 8;case 9:return 9;case 13:return 10}switch(a.charCode){case 13:return 10}return a.charCode}function e(a){return 10==a?32:a}var f,g=document.getElementById("mmo-ticker"),h=document.getElementById("mmo-flasher"),i=document.getElementById("mmo-track"),j=document.getElementById("mmo-text"),k=null,l=17,m=18,n=33,o=34,p=35,q=33;!function(a){a[a.INITIALIZING=-1]="INITIALIZING",a[a.WAITING=0]="WAITING",a[a.STARTING=1]="STARTING",a[a.RUNNING=2]="RUNNING",a[a.FINISHED=3]="FINISHED"}(f||(f={}));var r=function(){function a(a){this.id=a.id,this.user=a.user,this.reset()}return a.prototype.reset=function(){this.ghost=!1,this.finished=!1,this.position=0,this.offset=0,this.velocity=0,this.distance=0,this.tSpeed=0,this.tErrors=0},a.prototype.avatar=function(){return this.user.link?"https://graph.facebook.com/"+this.user.link+"/picture?type=small":"/res/image/person.png"},a.prototype.buildPlayer=function(){var a=this.id%5+1,b=D.el("img");b.src=this.avatar();var c=D.el("span");return c.textContent=this.user.name,this.$indicator=D.el("span",["indicator"]),this.$indicator.appendChild(b),this.$indicator.appendChild(c),this.$car=D.el("span",["car","car"+a]),this.$lane=D.el("div",["lane","lane"+a]),this.$lane.appendChild(this.$car),this.$player=D.el("div","player"),this.$player.appendChild(this.$indicator),this.$player.appendChild(this.$lane),this.$player},a.prototype.updatePlayer=function(a){this.ghost?this.$player.classList.add("ghost"):this.$player.classList.remove("ghost"),this.finished?this.$player.classList.add("finished"):this.$player.classList.remove("finished"),a==this?this.$player.classList.add("me"):this.$player.classList.remove("me")},a.prototype.movePlayer=function(a){var b=(this.$lane.offsetWidth-this.$car.offsetWidth)*a;this.$car.style.left=b+"px"},a}(),s=function(){function a(){var a=this;window.setInterval(function(){j.classList.toggle("blink")},300),window.addEventListener("blur",function(){a.ws}),window.addEventListener("focus",function(){a.ws}),window.addEventListener("resize",function(){a.ws&&a.updateTrack()}),document.addEventListener("keydown",function(b){a.ws&&a.me&&a.keyDown(b)},!0),document.addEventListener("keyup",function(b){a.ws&&a.me&&a.keyUp(b)},!0),document.addEventListener("keypress",function(b){a.ws&&a.me&&a.keyPress(b)},!0)}return a.prototype.init=function(){this.ws&&this.ws.close(),this.connect()},a.prototype.destroy=function(){this.ws&&this.ws.close()},a.prototype.connect=function(){var a=this,b=new WebSocket(c());b.binaryType="arraybuffer",b.onopen=function(){console.log("WebSocket connected"),document.body.classList.remove("offline"),document.body.classList.add("online"),a.ws=b,a.reset()},b.onclose=function(b){console.log("WebSocket closed; code="+b.code+", reason='"+b.reason+"'"),document.body.classList.remove("online"),document.body.classList.add("offline"),a.ws=null,a.reset()},b.onerror=function(a){console.log("WebSocket error",a.error)},b.onmessage=function(b){a.handle(b.data)}},a.prototype.handle=function(a){var b=new J.IO.Reader(a),c=b.getInt8();switch(c){case l:this.handlePlayerJoin(b);break;case m:this.handlePlayerLeave(b);break;case n:this.handleGameConfig(b);break;case o:this.handleGameReady(b);break;case p:this.handleGameWorld(b);break;default:this.ws.close(1003,"Unrecognized message "+c)}},a.prototype.handlePlayerJoin=function(a){for(var b=a.getInt32(),c=[],d=a.getInt8();d>0;d--)c.push({id:a.getInt32(),user:{id:a.getInt32(),link:a.getString(),name:a.getString()}});var e=0==Object.keys(this.players).length;this.sync(c),e&&(this.me=this.players[b]),this.buildTrack()},a.prototype.handlePlayerLeave=function(a){for(var b=a.getInt32(),c=[],d=a.getInt8();d>0;d--)c.push({id:a.getInt32(),user:{id:a.getInt32(),link:a.getString(),name:a.getString()}});this.sync(c),this.buildTrack(),this.me.id==b&&(console.log("Player was kicked out of the game"),this.me=null)},a.prototype.handleGameConfig=function(a){this.text=a.getString(),this.position=0},a.prototype.handleGameReady=function(a){var c=a.getInt8(),d=a.getInt8();switch(c){case 0:if(0!=this.state){this.state=0;for(var e in this.players){var f=this.players[e];f.reset()}this.updateTrack(),this.fragmentUi=new t("",j),this.fragmentUi.update(-1),$(g).text("Waiting for more players...")}break;case 1:if(1!=this.state){this.state=1;for(var e in this.players){var f=this.players[e];f.reset()}this.updateTrack(),this.fragmentUi=new t(this.text,j),this.fragmentUi.update(this.position)}$(g).text("Start in "+d),b($('<div class="bounce-in">'+d+"</div>"));break;case 2:2!=this.state&&(1==this.state?($(g).text("GO!"),b($('<div class="bounce-in">GO!</div>'))):$(g).text("Please wait, you will join the next race"),this.state=2,this.started=Date.now(),null==this.fragmentUi&&(this.fragmentUi=new t(this.text,j),this.fragmentUi.update(this.text.length)));break;case 3:3!=this.state&&(this.state=3,null==this.fragmentUi&&(this.fragmentUi=new t(this.text,j),this.fragmentUi.update(this.text.length)),$(g).text("Race finished"))}},a.prototype.handleGameWorld=function(a){for(var b=(a.getInt32(),a.getInt8());b>0;b--){var c={id:a.getInt32(),flags:a.getInt8(),position:a.getInt8(),offset:a.getInt16(),velocity:a.getFloat32(),distance:a.getFloat32(),tSpeed:a.getInt16(),tErrors:a.getInt16()},d=this.players[c.id];null!=d&&(d.ghost=!!(1&c.flags),d.finished=!!(2&c.flags),d.position=c.position,d.offset=c.offset,d.velocity=c.velocity,d.distance=c.distance,d.tSpeed=c.tSpeed,d.tErrors=c.tErrors)}this.updateTrack()},a.prototype.keyDown=function(a){if(!(a.ctrlKey||a.altKey||a.metaKey)&&2==this.state)switch(a.keyCode){case 8:case 27:a.stopPropagation(),a.preventDefault()}},a.prototype.keyUp=function(){},a.prototype.keyPress=function(a){if(!(a.ctrlKey||a.altKey||a.metaKey)&&2==this.state){var b=Date.now()-this.started,c=d(a);c>0&&(this.me.ghost||(this.progress(b,c),this.position<this.text.length&&e(this.text.charCodeAt(this.position))==e(c)&&this.position++,this.fragmentUi.update(this.position)),a.stopPropagation(),a.preventDefault())}},a.prototype.progress=function(a,b){var c=new J.IO.Writer;c.putUint8(q),c.putUint32(a),c.putUint16(b),this.ws.send(c.get())},a.prototype.reset=function(){this.state=-1,this.me=null,this.players=Object.create(null),this.buildTrack()},a.prototype.sync=function(a){var b=this,c=a.map(function(a){return a.id});for(var d in this.players){var e=this.players[d];-1==c.indexOf(e.id)&&delete this.players[d]}a.forEach(function(a){null==b.players[a.id]&&(b.players[a.id]=new r(a))})},a.prototype.buildTrack=function(){for(;i.firstChild;)i.removeChild(i.firstChild);var a=0;for(var b in this.players){var c=this.players[b];i.appendChild(c.buildPlayer()),a++}for(;5>a;)i.appendChild(D.el("div","player")),a++;this.updateTrack()},a.prototype.updateTrack=function(){for(var a in this.players){var b=this.players[a];b.updatePlayer(this.me),b.movePlayer(2===this.state||3===this.state?b.offset/this.text.length:0)}},a}(),t=function(){function a(a,b){this.text=a,this.$root=D.el("div",["fragment"]),this.$item=[];for(var a=this.text,c=0;c<a.length;c++){var d=a.charCodeAt(c);10==d?(this.$root.appendChild(this.$item[c]=D.el("span",["item","new-line"],"↵")),this.$root.appendChild(D.el("br",null,null))):32==d?(this.$root.appendChild(this.$item[c]=D.el("span",["item","space"],"␣")),this.$root.appendChild(D.el("span",null," "))):this.$root.appendChild(this.$item[c]=D.el("span",["item"],String.fromCharCode(d)))}for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(this.$root)}return a.prototype.update=function(a){var b,c;if(a>=0&&a<this.text.length){for(b=0;a>b;b++)c=this.$item[b],c.classList.add("down"),c.classList.remove("cursor");for(b=a;b<this.text.length;b++)c=this.$item[b],c.classList.remove("down"),b==a?c.classList.add("cursor"):c.classList.remove("cursor")}else for(b=0;b<this.text.length;b++)c=this.$item[b],c.classList.remove("down"),c.classList.remove("cursor")},a}();a.webSocketUrl=c;var u=new s;document.addEventListener("reveal-page",function(a){"#mmo"==a.detail.url?u.init():u.destroy()})}(ib||(ib={}));var Yb;!function(a){function b(){a.FACEBOOK=f.create(),a.PERSONA=g.create()}function c(a){return a.login().done(function(){window.location.reload()}).fail(function(a){console.error(a.message,a)})}function d(){a.FACEBOOK.logout().always(function(){a.PERSONA.logout().always(function(){window.location.href="/auth/logout"})})}var e={enabled:!1,login:function(){return P.resolve(null)},logout:function(){return P.resolve(null)}};a.FACEBOOK=e,a.PERSONA=e;var f=function(){function a(){this.enabled=!0,console.log("Init Facebook API"),FB.init({appId:global.facebook.appId,status:!1,cookie:!0,version:"v2.0"})}return a.create=function(){return"object"==typeof FB&&null!=FB?new a:(console.error("Facebook API not loaded"),e)},a.prototype.login=function(){var a=this;console.log("Performing Facebook login");var b=P.defer();return FB.getLoginStatus(function(c){"connected"==c.status?a.completeLogin(c,b):FB.login(function(c){"connected"==c.status&&a.completeLogin(c,b)},{scope:"email"})}),b.promise()},a.prototype.logout=function(){console.log("Performing Facebook logout");var a=P.defer();return FB.getLoginStatus(function(b){"connected"==b.status?FB.logout(function(){a.resolve(null)}):a.resolve(null)}),a.promise()},a.prototype.completeLogin=function(a,b){$.ajax({type:"POST",url:"/auth/facebook_login",data:{response:a.authResponse},success:function(a){"ok"==a.status?b.resolve(null):b.reject({message:"Facebook login failure",response:a})},error:function(a,c,d){b.reject({message:"Facebook login failure",status:c,error:d})}})},a}(),g=function(){function a(){this.enabled=!0,console.log("Init Persona API")}return a.create=function(){return"object"==typeof navigator.id&&null!=navigator.id?new a:(console.error("Mozilla Persona API not loaded"),e)},a.prototype.login=function(){var a=this;console.log("Performing Persona login");var b=P.defer();return navigator.id.watch({loggedInUser:global.auth.email,onlogin:function(c){a.completeLogin(c,b)},onlogout:function(){}}),navigator.id.request(),b.promise()},a.prototype.logout=function(){console.log("Performing Persona logout");var a=P.defer();return navigator.id.watch({loggedInUser:global.auth.email,onlogin:function(){},onlogout:function(){a.resolve(null)}}),navigator.id.logout(),a.promise()},a.prototype.completeLogin=function(a,b){$.ajax({type:"POST",url:"/auth/persona_login",data:{assertion:a},success:function(a){"ok"==a.status?b.resolve(null):b.reject({message:"Persona login failure",response:a})},error:function(a,c,d){b.reject({message:"Persona login failure",status:c,error:d})}})},a}();a.init=b,a.login=c,a.logout=d}(Yb||(Yb={}));var Zb=null;window.onerror=y,function(){console.log(["","      ___      __   __     __   __        ","|__/ |__  \\ / |__) |__)   /    /  \\  |\\/|","|  \\ |___  |  |__) |  \\ . \\__  \\__/  |  |",""].join("\n"));try{var a=window.document.domain;"string"==typeof a&&a.startsWith("www.")&&(E.defaults.domain=window.document.domain=a=a.substring(4))}catch(b){console.log(b)}if(window.navigator.cookieEnabled===!1)z(['<p class="h1">Local Storage Not Available</p>',"<p>Local data storage is disabled in your browser privacy settings.</p>","<p>This application uses browser local storage to keep user preferences and typing data.</p>","<p>Please allow storing cookies and any other local data in the browser settings.</p>"].join("\n"));else try{var c=h(),d=new M;x(c,d)}catch(b){throw z(['<p class="h1">JavaScript Error</p>',"<p>Cannot initialize application because of JavaScript error:</p>",["<p>",A(b.message),"</p>"].join("")].join("\n")),b}}()}();
//# sourceMappingURL=js.min.js.map